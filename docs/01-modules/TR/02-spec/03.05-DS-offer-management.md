# Data Specification - Offer Management

**Version**: 1.0  
**Last Updated**: 2025-12-16  
**Module**: Total Rewards (TR) - Offer Management  
**Status**: Draft

---

## Document Information

- **Purpose**: Define data validation rules and constraints for Offer Management entities
- **Audience**: Backend Developers, Database Administrators, QA Engineers
- **Scope**: Offer templates, packages, components, approvals, and history
- **Related Documents**:
  - [TR Ontology](../../00-ontology/tr-ontology.yaml) - Entity definitions
  - [API Specification](./02-api-specification.md) - API contracts
  - [Business Rules](./04-business-rules.md) - Business logic

---

## Table of Contents

1. [Offer Template Entities](#offer-template-entities)
2. [Offer Package Entities](#offer-package-entities)
3. [Offer Workflow Entities](#offer-workflow-entities)
4. [Common Validation Patterns](#common-validation-patterns)
5. [Enumeration Definitions](#enumeration-definitions)

---

# Offer Template Entities

## OfferTemplate

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `code` | String | Yes | Unique, max 50 chars, pattern: `^[A-Z0-9_]+$` | Unique code |
| `name` | String | Yes | Max 200 chars | Template name |
| `description` | String | No | Max 500 chars | Optional description |
| `jobLevel` | String | No | Max 100 chars | Target job level |
| `country` | String | Yes | ISO 3166-1 alpha-2 | Country code |
| `currency` | String | Yes | ISO 4217 | Currency code |
| `templateContent` | JSON | Yes | - | Template structure |
| `isActive` | Boolean | Yes | - | Default: true |
| `createdBy` | UUID | Yes | Must exist in User | Creator |
| `createdAt` | Timestamp | Yes | - | System-generated |
| `updatedAt` | Timestamp | Yes | >= createdAt | System-generated |

### Cross-Field Rules

**Rule 1: Country-Currency Alignment**
- If `country` = VN, then `currency` should be VND
- If `country` = US, then `currency` should be USD
- If `country` = SG, then `currency` should be SGD

**Rule 2: Template Content Structure**
- `templateContent` must include sections: compensation, benefits, equity, perks
- Each section defines available components and defaults

### Business Validations

**Template Completeness**
- Template should cover all required offer components
- Include legal disclaimers and terms

---

# Offer Package Entities

## OfferPackage

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `offerNumber` | String | Yes | Unique, auto-generated | Offer number |
| `candidateId` | UUID | Yes | Must exist in Candidate | Candidate |
| `positionId` | UUID | Yes | Must exist in Position | Position |
| `templateId` | UUID | No | Must exist in OfferTemplate | Template used |
| `jobTitle` | String | Yes | Max 200 chars | Job title |
| `department` | String | Yes | Max 200 chars | Department |
| `reportingTo` | String | Yes | Max 200 chars | Manager name |
| `startDate` | Date | Yes | >= today | Proposed start date |
| `totalCompensation` | Decimal | Yes | > 0 | Total annual comp |
| `currency` | String | Yes | ISO 4217 | Currency code |
| `status` | Enum | Yes | See OfferStatus | Offer status |
| `expirationDate` | Date | Yes | > today | Offer expiration |
| `sentAt` | Timestamp | No | - | Sent timestamp |
| `acceptedAt` | Timestamp | No | - | Acceptance timestamp |
| `declinedAt` | Timestamp | No | - | Decline timestamp |
| `declineReason` | String | No | Max 500 chars | Decline reason |
| `createdBy` | UUID | Yes | Must exist in User | Creator |
| `createdAt` | Timestamp | Yes | - | System-generated |
| `updatedAt` | Timestamp | Yes | >= createdAt | System-generated |

### Cross-Field Rules

**Rule 1: Status Transitions**
- DRAFT → PENDING_APPROVAL → APPROVED → SENT → ACCEPTED/DECLINED/EXPIRED
- If `status` = SENT, then `sentAt` is required
- If `status` = ACCEPTED, then `acceptedAt` is required
- If `status` = DECLINED, then `declinedAt` and `declineReason` are required

**Rule 2: Expiration Date**
- `expirationDate` typically 7-14 days from sent date
- Cannot accept offer after expiration

**Rule 3: Total Compensation**
- Sum of all component amounts should equal `totalCompensation`
- Includes base salary, bonuses, equity value, benefits value

### Business Validations

**Approval Workflow**
- Offers above certain threshold require executive approval
- Track approval chain

**Competitive Analysis**
- Compare offer to market data
- Flag if outside acceptable range

---

## OfferComponent

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `offerPackageId` | UUID | Yes | Must exist in OfferPackage | Offer package |
| `componentType` | Enum | Yes | See OfferComponentType | Component type |
| `componentName` | String | Yes | Max 200 chars | Component name |
| `amount` | Decimal | Yes | >= 0 | Component amount |
| `frequency` | Enum | Conditional | See PayFrequency | Required if recurring |
| `description` | String | No | Max 500 chars | Component description |
| `isGuaranteed` | Boolean | Yes | - | Default: false |
| `createdAt` | Timestamp | Yes | - | System-generated |

### Cross-Field Rules

**Rule 1: Frequency Requirement**
- If `componentType` = SALARY or ALLOWANCE, then `frequency` is required
- If `componentType` = BONUS or EQUITY, then `frequency` may be null

**Rule 2: Component Type Rules**
- SALARY: Recurring, guaranteed
- BONUS: May be variable, not guaranteed
- EQUITY: Grant value, vesting schedule
- BENEFITS: Employer contribution value
- PERKS: Additional perks value

---

# Offer Workflow Entities

## OfferApproval

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `offerPackageId` | UUID | Yes | Must exist in OfferPackage | Offer package |
| `approverLevel` | Integer | Yes | >= 1 | Approval level |
| `approverId` | UUID | Yes | Must exist in User | Approver |
| `status` | Enum | Yes | See ApprovalStatus | Approval status |
| `comments` | String | No | Max 1000 chars | Approver comments |
| `approvedAt` | Timestamp | No | - | Approval timestamp |
| `rejectedAt` | Timestamp | No | - | Rejection timestamp |
| `createdAt` | Timestamp | Yes | - | System-generated |

### Cross-Field Rules

**Rule 1: Status Timestamps**
- If `status` = APPROVED, then `approvedAt` is required
- If `status` = REJECTED, then `rejectedAt` is required

**Rule 2: Approval Sequence**
- Approvals must be sequential by level
- Level 2 cannot approve before Level 1

**Rule 3: Final Approval**
- All required approval levels must approve before offer can be sent
- Any rejection stops the workflow

---

## OfferHistory

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `offerPackageId` | UUID | Yes | Must exist in OfferPackage | Offer package |
| `versionNumber` | Integer | Yes | >= 1 | Version number |
| `changeType` | Enum | Yes | See ChangeType | Change type |
| `changedBy` | UUID | Yes | Must exist in User | User who made change |
| `changeDescription` | String | Yes | Max 1000 chars | Change description |
| `previousValue` | JSON | No | - | Previous values |
| `newValue` | JSON | No | - | New values |
| `changedAt` | Timestamp | Yes | - | Change timestamp |

### Cross-Field Rules

**Rule 1: Version Increment**
- `versionNumber` increments with each change
- First version = 1

**Rule 2: Change Tracking**
- `previousValue` and `newValue` capture before/after state
- Track all material changes to offer

**Rule 3: Change Types**
- CREATED: Initial offer creation
- MODIFIED: Offer modified
- APPROVED: Approval granted
- REJECTED: Approval rejected
- SENT: Offer sent to candidate
- ACCEPTED: Candidate accepted
- DECLINED: Candidate declined
- WITHDRAWN: Offer withdrawn

---

# Common Validation Patterns

## Date Validations

**Future Date Check**
```
startDate >= today
expirationDate > today
```

**Date Range**
```
expirationDate > sentAt
```

## Amount Validations

All amounts:
- Precision: 2 decimal places
- Rounding: HALF_UP
- Must be non-negative

## Total Compensation Calculation

```
totalCompensation = sum of all component amounts (annualized)
```
- Include base salary
- Include guaranteed bonuses
- Include equity grant value (annualized)
- Include benefits value

---

# Enumeration Definitions

## OfferStatus

```
DRAFT               - Draft offer
PENDING_APPROVAL    - Awaiting approval
APPROVED            - Approved
SENT                - Sent to candidate
ACCEPTED            - Candidate accepted
DECLINED            - Candidate declined
EXPIRED             - Offer expired
WITHDRAWN           - Offer withdrawn
```

## OfferComponentType

```
SALARY          - Base salary
BONUS           - Bonus (signing, annual, etc.)
EQUITY          - Equity grant
BENEFITS        - Benefits package value
ALLOWANCE       - Allowances
PERKS           - Additional perks
```

## ApprovalStatus

```
PENDING         - Pending approval
APPROVED        - Approved
REJECTED        - Rejected
```

## ChangeType

```
CREATED         - Offer created
MODIFIED        - Offer modified
APPROVED        - Approval granted
REJECTED        - Approval rejected
SENT            - Offer sent
ACCEPTED        - Offer accepted
DECLINED        - Offer declined
WITHDRAWN       - Offer withdrawn
```

## PayFrequency

```
HOURLY          - Hourly rate
MONTHLY         - Monthly payment
ANNUAL          - Annual amount
ONE_TIME        - One-time payment
```

---

## Document Status

**Status**: Complete - All Offer Management entities documented  
**Coverage**:
- ✅ Offer Template Entities (1 entity)
- ✅ Offer Package Entities (2 entities)
- ✅ Offer Workflow Entities (2 entities)

**Total Entities**: 5 entities with complete validation rules  
**Total Lines**: ~250 lines

**Last Updated**: 2025-12-16  
**Next**: 03.06-DS-tr-statement.md
