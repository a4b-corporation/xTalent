# Data Specification - Recognition

**Version**: 1.0  
**Last Updated**: 2025-12-16  
**Module**: Total Rewards (TR) - Recognition  
**Status**: Draft

---

## Document Information

- **Purpose**: Define data validation rules and constraints for Recognition entities
- **Audience**: Backend Developers, Database Administrators, QA Engineers
- **Scope**: Recognition programs, events, point accounts, perks, and redemptions
- **Related Documents**:
  - [TR Ontology](../../00-ontology/tr-ontology.yaml) - Entity definitions
  - [API Specification](./02-api-specification.md) - API contracts
  - [Business Rules](./04-business-rules.md) - Business logic

---

## Table of Contents

1. [Recognition Program Entities](#recognition-program-entities)
2. [Recognition Event Entities](#recognition-event-entities)
3. [Point & Redemption Entities](#point--redemption-entities)
4. [Perk Catalog Entities](#perk-catalog-entities)
5. [Common Validation Patterns](#common-validation-patterns)
6. [Enumeration Definitions](#enumeration-definitions)

---

# Recognition Program Entities

## RecognitionEventType

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `code` | String | Yes | Unique, max 50 chars, pattern: `^[A-Z0-9_]+$` | Unique code |
| `name` | String | Yes | Max 200 chars | Display name |
| `description` | String | No | Max 500 chars | Optional description |
| `category` | Enum | Yes | See RecognitionCategory | Event category |
| `pointValue` | Integer | Yes | >= 0 | Points awarded |
| `requiresApproval` | Boolean | Yes | - | Default: false |
| `approvalThreshold` | Integer | Conditional | > 0 | Required if requiresApproval=true |
| `maxFrequencyPerYear` | Integer | No | > 0 | Max times per year |
| `isActive` | Boolean | Yes | - | Default: true |
| `createdAt` | Timestamp | Yes | - | System-generated |

### Cross-Field Rules

**Rule 1: Approval Threshold**
- If `requiresApproval` = true, then `approvalThreshold` is required
- If `requiresApproval` = false, then `approvalThreshold` must be null

**Rule 2: Point Value Limits**
- `pointValue` typically 100-10,000 points
- Higher values may require approval

**Rule 3: Frequency Limits**
- If `maxFrequencyPerYear` is set, enforce limit per employee per year
- Prevent abuse of recognition system

### Business Validations

**Budget Impact**
- Track total points awarded against program budget
- Alert if approaching budget limits

**Approval Workflow**
- If points exceed threshold, route to manager for approval
- Track approval history

---

# Recognition Event Entities

## RecognitionEvent

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `eventTypeId` | UUID | Yes | Must exist in RecognitionEventType | Event type |
| `recipientId` | UUID | Yes | Must exist in Worker | Recipient employee |
| `nominatorId` | UUID | Yes | Must exist in Worker | Nominator |
| `eventDate` | Date | Yes | <= today | Event date |
| `description` | String | Yes | Max 1000 chars | Recognition description |
| `pointsAwarded` | Integer | Yes | >= 0 | Points awarded |
| `status` | Enum | Yes | See RecognitionStatus | Event status |
| `approvedBy` | UUID | No | Must exist if approved | Approver |
| `approvedAt` | Timestamp | No | - | Approval timestamp |
| `rejectionReason` | String | No | Max 500 chars | Rejection reason |
| `isPublic` | Boolean | Yes | - | Default: true |
| `createdAt` | Timestamp | Yes | - | System-generated |

### Cross-Field Rules

**Rule 1: Self-Nomination**
- `recipientId` must be != `nominatorId`
- Cannot nominate yourself

**Rule 2: Points Validation**
- `pointsAwarded` should match event type's `pointValue`
- Can be adjusted by approver

**Rule 3: Status Transitions**
- PENDING → APPROVED/REJECTED
- If `status` = APPROVED, then approvedBy and approvedAt are required
- If `status` = REJECTED, then rejectionReason is required

**Rule 4: Approval Requirements**
- If event type requires approval, status starts as PENDING
- If no approval required, status starts as APPROVED

### Business Validations

**Frequency Check**
- Check if recipient has exceeded max frequency for this event type
- Warn or block if limit reached

**Budget Check**
- Verify program has sufficient budget for points
- Track budget consumption

---

# Point & Redemption Entities

## PointAccount

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `employeeId` | UUID | Yes | Unique, must exist in Worker | Employee |
| `totalEarned` | Integer | Yes | >= 0 | Total points earned |
| `totalRedeemed` | Integer | Yes | >= 0, <= totalEarned | Total points redeemed |
| `totalExpired` | Integer | Yes | >= 0 | Total points expired |
| `currentBalance` | Integer | Yes | >= 0 | Current available points |
| `asOfDate` | Date | Yes | - | Balance snapshot date |
| `createdAt` | Timestamp | Yes | - | System-generated |
| `updatedAt` | Timestamp | Yes | >= createdAt | System-generated |

### Cross-Field Rules

**Rule 1: Balance Formula**
```
currentBalance = totalEarned - totalRedeemed - totalExpired
```

**Rule 2: Balance Consistency**
- `totalRedeemed` + `totalExpired` <= `totalEarned`
- `currentBalance` >= 0

**Rule 3: Uniqueness**
- One point account per employee
- `employeeId` is unique

---

## RewardPointTransaction

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `employeeId` | UUID | Yes | Must exist in Worker | Employee |
| `transactionType` | Enum | Yes | See TransactionType | Transaction type |
| `points` | Integer | Yes | != 0 | Points (positive or negative) |
| `transactionDate` | Date | Yes | - | Transaction date |
| `expirationDate` | Date | Conditional | > transactionDate | Required if EARN |
| `sourceId` | UUID | No | - | Source reference |
| `sourceType` | String | No | - | Source entity type |
| `description` | String | Yes | Max 500 chars | Transaction description |
| `createdAt` | Timestamp | Yes | - | System-generated |

### Cross-Field Rules

**Rule 1: Transaction Type Rules**
- EARN: `points` > 0, `expirationDate` required
- REDEEM: `points` < 0
- EXPIRE: `points` < 0
- ADJUSTMENT: Can be positive or negative

**Rule 2: Expiration Date**
- If `transactionType` = EARN, then `expirationDate` is required
- Typically 12-24 months from transaction date

**Rule 3: Source Reference**
- If `transactionType` = EARN, `sourceId` references RecognitionEvent
- If `transactionType` = REDEEM, `sourceId` references PerkRedemption

**Rule 4: Balance Check**
- For REDEEM transactions, verify sufficient balance
- Cannot redeem more than current balance

### Business Validations

**FIFO Expiration**
- Points expire in FIFO order (first earned, first expired)
- Process expiration automatically

**Balance Update**
- Update PointAccount balance after each transaction
- Maintain balance consistency

---

## PerkRedemption

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `employeeId` | UUID | Yes | Must exist in Worker | Employee |
| `perkId` | UUID | Yes | Must exist in PerkCatalog | Perk |
| `quantity` | Integer | Yes | > 0 | Quantity |
| `pointsCost` | Integer | Yes | > 0 | Total points cost |
| `redemptionDate` | Date | Yes | - | Redemption date |
| `status` | Enum | Yes | See RedemptionStatus | Redemption status |
| `deliveryAddress` | JSON | Conditional | - | Required if physical item |
| `deliveryStatus` | Enum | No | See DeliveryStatus | Delivery status |
| `fulfilledAt` | Timestamp | No | - | Fulfillment timestamp |
| `cancelledAt` | Timestamp | No | - | Cancellation timestamp |
| `cancellationReason` | String | No | Max 500 chars | Cancellation reason |
| `createdAt` | Timestamp | Yes | - | System-generated |

### Cross-Field Rules

**Rule 1: Points Cost Calculation**
```
pointsCost = perk.pointValue * quantity
```

**Rule 2: Status Transitions**
- PENDING → PROCESSING → FULFILLED/CANCELLED
- If `status` = FULFILLED, then `fulfilledAt` is required
- If `status` = CANCELLED, then `cancelledAt` and `cancellationReason` are required

**Rule 3: Delivery Address**
- If perk type = PHYSICAL_ITEM, then `deliveryAddress` is required
- If perk type = DIGITAL or EXPERIENCE, then `deliveryAddress` must be null

**Rule 4: Balance Deduction**
- Deduct points from employee's account when status = PROCESSING
- Refund points if status = CANCELLED

### Business Validations

**Inventory Check**
- Verify perk is in stock before redemption
- Update inventory after redemption

**Delivery Tracking**
- Track delivery status for physical items
- Update delivery status as items ship

---

# Perk Catalog Entities

## PerkCategory

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `code` | String | Yes | Unique, max 50 chars | Unique code |
| `name` | String | Yes | Max 200 chars | Category name |
| `description` | String | No | Max 500 chars | Optional description |
| `displayOrder` | Integer | Yes | >= 1 | Display order |
| `isActive` | Boolean | Yes | - | Default: true |
| `createdAt` | Timestamp | Yes | - | System-generated |

### Cross-Field Rules

**Rule 1: Display Order**
- `displayOrder` should be unique within active categories
- Used for UI sorting

---

## PerkCatalog

### Field Validations

| Field | Type | Required | Constraints | Validation |
|-------|------|----------|-------------|------------|
| `id` | UUID | Yes | - | System-generated |
| `code` | String | Yes | Unique, max 50 chars | Unique code |
| `name` | String | Yes | Max 200 chars | Perk name |
| `description` | String | Yes | Max 1000 chars | Perk description |
| `categoryId` | UUID | Yes | Must exist in PerkCategory | Category |
| `perkType` | Enum | Yes | See PerkType | Perk type |
| `pointValue` | Integer | Yes | > 0 | Points required |
| `imageUrl` | String | No | Valid URL | Perk image |
| `stockQuantity` | Integer | Conditional | >= 0 | Required if PHYSICAL_ITEM |
| `isUnlimited` | Boolean | Yes | - | Default: false |
| `isActive` | Boolean | Yes | - | Default: true |
| `effectiveDate` | Date | Yes | >= today (unless retroactive) | Start date |
| `endDate` | Date | No | > effectiveDate | End date |
| `createdAt` | Timestamp | Yes | - | System-generated |
| `updatedAt` | Timestamp | Yes | >= createdAt | System-generated |

### Cross-Field Rules

**Rule 1: Stock Quantity**
- If `perkType` = PHYSICAL_ITEM, then `stockQuantity` is required
- If `isUnlimited` = true, then `stockQuantity` is ignored

**Rule 2: Availability**
- Perk is available if:
  - `isActive` = true
  - Current date between `effectiveDate` and `endDate`
  - `stockQuantity` > 0 OR `isUnlimited` = true

**Rule 3: Perk Type Rules**
- PHYSICAL_ITEM: Requires inventory tracking
- DIGITAL: No inventory, instant delivery
- EXPERIENCE: May require booking/scheduling
- GIFT_CARD: Requires code generation

### Business Validations

**Inventory Management**
- Track stock levels for physical items
- Alert when stock is low
- Prevent redemption when out of stock

**Point Value Reasonableness**
- Point values should align with item value
- Typical range: 1,000 - 100,000 points

---

# Common Validation Patterns

## Date Validations

**Past Date Check**
```
date <= today (for historical events)
```

**Expiration Date**
```
expirationDate > transactionDate
```

## Integer Validations

Points and quantities:
- Must be non-negative (except for deductions)
- No fractional points
- Example: 1000, 5000, 10000

## Balance Calculations

```
currentBalance = totalEarned - totalRedeemed - totalExpired
```
- Always maintain balance >= 0
- Update in real-time

---

# Enumeration Definitions

## RecognitionCategory

```
PERFORMANCE     - Performance excellence
TEAMWORK        - Teamwork and collaboration
INNOVATION      - Innovation and creativity
VALUES          - Living company values
MILESTONE       - Service milestone
```

## RecognitionStatus

```
PENDING         - Pending approval
APPROVED        - Approved
REJECTED        - Rejected
```

## TransactionType

```
EARN            - Points earned
REDEEM          - Points redeemed
EXPIRE          - Points expired
ADJUSTMENT      - Manual adjustment
```

## RedemptionStatus

```
PENDING         - Pending processing
PROCESSING      - Processing redemption
FULFILLED       - Redemption fulfilled
CANCELLED       - Redemption cancelled
```

## DeliveryStatus

```
PENDING         - Pending shipment
SHIPPED         - Shipped
DELIVERED       - Delivered
FAILED          - Delivery failed
```

## PerkType

```
PHYSICAL_ITEM   - Physical item (requires shipping)
DIGITAL         - Digital item (instant delivery)
EXPERIENCE      - Experience (event, activity)
GIFT_CARD       - Gift card
```

---

## Document Status

**Status**: Complete - All Recognition entities documented  
**Coverage**:
- ✅ Recognition Program Entities (1 entity)
- ✅ Recognition Event Entities (1 entity)
- ✅ Point & Redemption Entities (3 entities)
- ✅ Perk Catalog Entities (2 entities)

**Total Entities**: 7 entities with complete validation rules  
**Total Lines**: ~400 lines

**Last Updated**: 2025-12-16  
**Next**: 03.05-DS-offer-management.md
