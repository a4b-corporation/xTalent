# 7. Deductions Rules

**Total Rules**: 32  
**Priority**: HIGH: 20 rules, MEDIUM: 12 rules

---

## Category: Deduction Setup

### BR-TR-DED-001: Deduction Code Uniqueness

**Priority**: HIGH

**Description**:
Deduction codes must be unique across the system.

**Conditions**:
```
WHEN creating or updating deduction
THEN validate code uniqueness
```

**Rules**:
1. Deduction code must be unique (case-insensitive)
2. Code format: Alphanumeric with underscores only
3. Code length: 3-50 characters
4. System deductions cannot be deleted or modified
5. Code cannot be changed after creation

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_001`: "Deduction code '{code}' already exists."

**Related Requirements**: FR-TR-DED-001

**Related Entities**: Deduction

---

### BR-TR-DED-002: Deduction Type Validation

**Priority**: HIGH

**Description**:
Deduction type determines tax treatment and processing rules.

**Conditions**:
```
WHEN creating deduction
THEN validate type and tax treatment
```

**Rules**:
1. Valid types: PRE_TAX, POST_TAX, COURT_ORDERED, EMPLOYER_PAID
2. PRE_TAX: Reduces taxable income (401k, HSA, FSA)
3. POST_TAX: Deducted after tax calculation (Roth, loans)
4. COURT_ORDERED: Highest priority (garnishments, child support)
5. EMPLOYER_PAID: No employee deduction (employer contribution)
6. Type cannot be changed after transactions exist

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_002`: "Invalid deduction type: {type}."

**Related Requirements**: FR-TR-DED-002

**Related Entities**: Deduction

---

### BR-TR-DED-003: Deduction Category Assignment

**Priority**: MEDIUM

**Description**:
Categorize deductions for reporting and grouping.

**Conditions**:
```
WHEN creating deduction
THEN assign to category
```

**Rules**:
1. Categories: RETIREMENT, INSURANCE, LOAN, GARNISHMENT, ADVANCE, OTHER
2. Category determines reporting group
3. Multiple deductions can share same category
4. Category affects statement display
5. Category required for all deductions

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_003`: "Deduction category is required."

**Related Requirements**: FR-TR-DED-003

**Related Entities**: Deduction, DeductionCategory

---

### BR-TR-DED-004: Deduction Frequency Configuration

**Priority**: MEDIUM

**Description**:
Configure deduction frequency and timing.

**Conditions**:
```
WHEN setting up deduction
THEN configure frequency
```

**Rules**:
1. Frequencies: ONCE, WEEKLY, BI_WEEKLY, SEMI_MONTHLY, MONTHLY, QUARTERLY, ANNUAL
2. Frequency must align with payroll schedule
3. Start date required
4. End date optional (for installments)
5. Installment count for fixed-term deductions

**Exceptions**:
- COURT_ORDERED: Frequency mandated by court order

**Error Messages**:
- `ERR_DED_004`: "Deduction frequency must align with payroll schedule."

**Related Requirements**: FR-TR-DED-004

**Related Entities**: Deduction, PayrollSchedule

---

### BR-TR-DED-005: Deduction Effective Dates

**Priority**: HIGH

**Description**:
Validate deduction effective dates.

**Conditions**:
```
WHEN setting deduction dates
THEN validate date logic
```

**Rules**:
1. Start date required
2. Start date cannot be in past (except for corrections)
3. End date must be after start date if provided
4. Effective dates determine when deduction is active
5. Deduction not processed outside effective dates

**Exceptions**:
- HR can backdate for corrections with reason

**Error Messages**:
- `ERR_DED_005`: "End date must be after start date."

**Related Requirements**: FR-TR-DED-005

**Related Entities**: Deduction

---

### BR-TR-DED-006: Deduction Priority Ordering

**Priority**: HIGH

**Description**:
Establish priority order for deduction processing.

**Conditions**:
```
WHEN multiple deductions exist
THEN process by priority order
```

**Rules**:
1. Priority levels: 1 (highest) to 999 (lowest)
2. COURT_ORDERED: Always priority 1-10
3. PRE_TAX: Priority 11-50
4. POST_TAX: Priority 51-100
5. Lower number = higher priority
6. Same priority: Process alphabetically by code

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_006`: "Court-ordered deductions must have priority 1-10."

**Related Requirements**: FR-TR-DED-006

**Related Entities**: Deduction

---

### BR-TR-DED-007: Deduction Maximum Limits

**Priority**: MEDIUM

**Description**:
Set maximum deduction amounts and percentages.

**Conditions**:
```
WHEN configuring deduction
THEN set maximum limits
```

**Rules**:
1. Max amount per period (optional)
2. Max percentage of gross pay (optional)
3. Annual maximum (optional)
4. Lifetime maximum (optional)
5. Limits prevent over-deduction

**Exceptions**:
- COURT_ORDERED: No maximum limits

**Error Messages**:
- `ERR_DED_007`: "Deduction exceeds maximum limit: {limit}."

**Related Requirements**: FR-TR-DED-007

**Related Entities**: Deduction

---

### BR-TR-DED-008: Employer Matching Configuration

**Priority**: MEDIUM

**Description**:
Configure employer matching for retirement deductions.

**Conditions**:
```
IF deduction has employer match
THEN configure match rules
```

**Rules**:
1. Match percentage (e.g., 100% up to 5% of salary)
2. Match cap amount
3. Vesting schedule for employer match
4. Match calculated on employee contribution
5. Match recorded as separate transaction

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_008`: "Employer match percentage required for matched deductions."

**Related Requirements**: FR-TR-DED-008

**Related Entities**: Deduction, EmployerContribution

---

## Category: Deduction Processing

### BR-TR-DED-009: Employee Enrollment Validation

**Priority**: HIGH

**Description**:
Validate employee enrollment in deduction.

**Conditions**:
```
WHEN employee enrolls in deduction
THEN validate eligibility
```

**Rules**:
1. Employee must be active
2. Employee must meet eligibility criteria
3. Deduction must be active
4. Enrollment date within effective dates
5. No duplicate enrollments for same deduction

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_009`: "Employee not eligible for deduction: {reason}."

**Related Requirements**: FR-TR-DED-009

**Related Entities**: EmployeeDeduction, Employee

---

### BR-TR-DED-010: Deduction Amount Calculation

**Priority**: HIGH

**Description**:
Calculate deduction amount based on configuration.

**Conditions**:
```
deduction_amount = FIXED or (gross_pay × percentage)
```

**Rules**:
1. Fixed amount: Use configured amount
2. Percentage: Calculate from gross pay
3. Apply minimum and maximum limits
4. Round to 2 decimal places
5. Validate sufficient funds available

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_010`: "Deduction calculation failed: {reason}."

**Related Requirements**: FR-TR-DED-010

**Related Entities**: DeductionTransaction

---

### BR-TR-DED-011: Deduction Proration Rules

**Priority**: MEDIUM

**Description**:
Prorate deductions for partial pay periods.

**Conditions**:
```
IF partial pay period
THEN prorate deduction amount
```

**Rules**:
1. Proration method: Calendar days or working days
2. New hires: Prorate first period
3. Terminations: Prorate final period
4. Leave without pay: Prorate or skip
5. Fixed deductions: Prorate by days
6. Percentage deductions: Auto-prorated (based on gross)

**Exceptions**:
- COURT_ORDERED: No proration, full amount required

**Error Messages**:
- None

**Related Requirements**: FR-TR-DED-011

**Related Entities**: DeductionTransaction

---

### BR-TR-DED-012: Priority-Based Processing

**Priority**: HIGH

**Description**:
Process deductions in priority order until funds exhausted.

**Conditions**:
```
WHEN processing payroll
THEN deduct in priority order
```

**Rules**:
1. Sort deductions by priority (ascending)
2. Process highest priority first
3. Check available funds before each deduction
4. Stop if insufficient funds (except COURT_ORDERED)
5. Log skipped deductions

**Exceptions**:
- COURT_ORDERED: Always processed, even if insufficient funds

**Error Messages**:
- `WARN_DED_012`: "Insufficient funds for deduction: {code}."

**Related Requirements**: FR-TR-DED-012

**Related Entities**: DeductionTransaction

---

### BR-TR-DED-013: Insufficient Funds Handling

**Priority**: HIGH

**Description**:
Handle cases where employee has insufficient funds for deductions.

**Conditions**:
```
IF net_pay < total_deductions
THEN handle insufficient funds
```

**Rules**:
1. Calculate available funds: gross_pay - taxes - higher_priority_deductions
2. COURT_ORDERED: Always deduct, even if negative net pay
3. Other deductions: Skip if insufficient funds
4. Log skipped deductions with reason
5. Notify employee and HR
6. Carry forward to next period (configurable)

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_013`: "Insufficient funds for deduction: {code}. Available: {amount}."

**Related Requirements**: FR-TR-DED-013

**Related Entities**: DeductionTransaction

---

### BR-TR-DED-014: Court-Ordered Deduction Processing

**Priority**: HIGH

**Description**:
Process court-ordered deductions (garnishments, child support).

**Conditions**:
```
IF deduction type = COURT_ORDERED
THEN apply special rules
```

**Rules**:
1. Always highest priority (1-10)
2. Always processed, even if insufficient funds
3. Exact amount as specified in court order
4. No proration or reduction allowed
5. Court order document required
6. Expiration date from court order
7. Remit to specified agency/recipient

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_014`: "Court order document required for garnishment."

**Related Requirements**: FR-TR-DED-014

**Related Entities**: CourtOrderedDeduction, DeductionTransaction

---

### BR-TR-DED-015: Loan Repayment Processing

**Priority**: MEDIUM

**Description**:
Process employee loan repayments.

**Conditions**:
```
WHEN processing loan deduction
THEN calculate installment
```

**Rules**:
1. Fixed installment amount or percentage
2. Total loan amount tracked
3. Principal and interest separated (if applicable)
4. Remaining balance calculated
5. Auto-terminate when fully repaid
6. Early payoff allowed

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_015`: "Loan repayment amount exceeds remaining balance."

**Related Requirements**: FR-TR-DED-015

**Related Entities**: LoanDeduction, DeductionTransaction

---

### BR-TR-DED-016: Advance Recovery Processing

**Priority**: MEDIUM

**Description**:
Recover salary advances through payroll deductions.

**Conditions**:
```
WHEN recovering advance
THEN deduct installments
```

**Rules**:
1. Advance amount and recovery schedule defined
2. Fixed installments over specified periods
3. Track remaining balance
4. Auto-terminate when fully recovered
5. Handle termination (recover from final pay)

**Exceptions**:
- Termination: Recover full remaining balance from final pay

**Error Messages**:
- `ERR_DED_016`: "Advance recovery failed: {reason}."

**Related Requirements**: FR-TR-DED-016

**Related Entities**: AdvanceDeduction, DeductionTransaction

---

### BR-TR-DED-017: Deduction Suspension Rules

**Priority**: MEDIUM

**Description**:
Suspend deductions temporarily.

**Conditions**:
```
WHEN employee on leave or suspension requested
THEN suspend deductions
```

**Rules**:
1. Suspension reasons: Leave without pay, employee request, HR action
2. Suspension start and end dates
3. Suspended deductions not processed
4. Resume automatically after suspension period
5. Catch-up option for missed deductions

**Exceptions**:
- COURT_ORDERED: Cannot be suspended

**Error Messages**:
- `ERR_DED_017`: "Court-ordered deductions cannot be suspended."

**Related Requirements**: FR-TR-DED-017

**Related Entities**: EmployeeDeduction

---

### BR-TR-DED-018: Deduction Catch-Up Processing

**Priority**: MEDIUM

**Description**:
Process catch-up deductions for missed periods.

**Conditions**:
```
IF deduction was suspended or skipped
AND catch-up enabled
THEN process catch-up
```

**Rules**:
1. Track missed deduction amounts
2. Catch-up over specified periods
3. Catch-up amount added to regular deduction
4. Validate sufficient funds for catch-up
5. Catch-up priority same as original deduction

**Exceptions**:
- None

**Error Messages**:
- `WARN_DED_018`: "Catch-up deduction skipped due to insufficient funds."

**Related Requirements**: FR-TR-DED-018

**Related Entities**: DeductionTransaction

---

### BR-TR-DED-019: Deduction Termination Rules

**Priority**: MEDIUM

**Description**:
Terminate deductions when conditions met.

**Conditions**:
```
WHEN termination condition met
THEN stop deduction
```

**Rules**:
1. Termination triggers: End date reached, loan paid off, employee termination, manual termination
2. Final deduction processed in last applicable period
3. Remaining balance handled per deduction type
4. Termination reason documented
5. Employee notified

**Exceptions**:
- None

**Error Messages**:
- None

**Related Requirements**: FR-TR-DED-019

**Related Entities**: EmployeeDeduction

---

### BR-TR-DED-020: Deduction Reversal Rules

**Priority**: MEDIUM

**Description**:
Reverse deductions for corrections.

**Conditions**:
```
IF deduction error identified
THEN reverse transaction
```

**Rules**:
1. Reversal reason required
2. Original transaction marked as reversed
3. Reversal transaction created (negative amount)
4. Refund to employee via next payroll or check
5. Approval required for reversals
6. Audit trail maintained

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_020`: "Deduction reversal requires approval."

**Related Requirements**: FR-TR-DED-020

**Related Entities**: DeductionTransaction

---

## Category: Integration & Reporting

### BR-TR-DED-021: Payroll Integration

**Priority**: HIGH

**Description**:
Integrate deductions with payroll processing.

**Conditions**:
```
WHEN payroll runs
THEN send deductions to payroll
```

**Rules**:
1. Deductions calculated before payroll run
2. Deduction amounts sent to payroll module
3. Payroll validates and processes
4. Results returned to TR module
5. Transaction status updated

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_021`: "Payroll integration failed: {reason}."

**Related Requirements**: FR-TR-DED-021

**Related Entities**: DeductionTransaction, PayrollRun

---

### BR-TR-DED-022: Tax Reporting Integration

**Priority**: HIGH

**Description**:
Report deductions for tax purposes.

**Conditions**:
```
WHEN generating tax forms
THEN include deduction data
```

**Rules**:
1. PRE_TAX deductions reduce taxable income
2. Report on W-2 (Box 12 for 401k, Box 14 for others)
3. POST_TAX deductions reported separately
4. Annual totals calculated
5. Tax year alignment

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_022`: "Tax reporting failed for deduction: {code}."

**Related Requirements**: FR-TR-DED-022

**Related Entities**: DeductionTransaction, TaxForm

---

### BR-TR-DED-023: Deduction Reconciliation

**Priority**: HIGH

**Description**:
Reconcile deductions with third parties.

**Conditions**:
```
WHEN period ends
THEN reconcile deductions
```

**Rules**:
1. Compare deducted amounts with expected amounts
2. Identify variances
3. Reconcile with third-party providers (insurance, 401k)
4. Generate reconciliation report
5. Resolve discrepancies

**Exceptions**:
- None

**Error Messages**:
- `WARN_DED_023`: "Deduction variance detected: {amount}."

**Related Requirements**: FR-TR-DED-023

**Related Entities**: DeductionTransaction, ReconciliationReport

---

### BR-TR-DED-024: Employee Deduction Statement

**Priority**: MEDIUM

**Description**:
Provide deduction statements to employees.

**Conditions**:
```
WHEN employee requests or period ends
THEN generate deduction statement
```

**Rules**:
1. Statement shows all active deductions
2. Current period amounts
3. Year-to-date totals
4. Remaining balances (for loans, advances)
5. Accessible via employee portal

**Exceptions**:
- None

**Error Messages**:
- None

**Related Requirements**: FR-TR-DED-024

**Related Entities**: DeductionStatement, Employee

---

### BR-TR-DED-025: Deduction Audit Trail

**Priority**: HIGH

**Description**:
Maintain complete audit trail for deductions.

**Conditions**:
```
WHEN deduction activity occurs
THEN log to audit trail
```

**Rules**:
1. Log events: Setup, Enrollment, Transaction, Suspension, Termination, Reversal
2. Audit record: User, Timestamp, Action, Before/After values
3. Immutable audit logs
4. Retention: 7 years
5. Searchable and reportable

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_025`: "Audit log write failed: {reason}."

**Related Requirements**: FR-TR-DED-025

**Related Entities**: AuditLog, Deduction

---

### BR-TR-DED-026: Compliance Reporting

**Priority**: HIGH

**Description**:
Generate compliance reports for deductions.

**Conditions**:
```
WHEN compliance report requested
THEN generate report
```

**Rules**:
1. Court-ordered deduction compliance
2. Retirement plan compliance (401k limits)
3. Garnishment remittance tracking
4. Regulatory reporting (DOL, IRS)
5. Audit-ready reports

**Exceptions**:
- None

**Error Messages**:
- None

**Related Requirements**: FR-TR-DED-026

**Related Entities**: ComplianceReport, Deduction

---

### BR-TR-DED-027: Year-End Processing

**Priority**: HIGH

**Description**:
Process year-end deduction activities.

**Conditions**:
```
WHEN year ends
THEN perform year-end processing
```

**Rules**:
1. Calculate annual totals
2. Generate tax forms (W-2, 1099)
3. Reset annual limits for new year
4. Archive year-end data
5. Reconcile with providers

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_027`: "Year-end processing failed: {reason}."

**Related Requirements**: FR-TR-DED-027

**Related Entities**: DeductionTransaction, TaxForm

---

### BR-TR-DED-028: Deduction Analytics

**Priority**: MEDIUM

**Description**:
Provide analytics on deduction activity.

**Conditions**:
```
WHEN analytics requested
THEN generate deduction metrics
```

**Rules**:
1. Participation rates by deduction type
2. Average deduction amounts
3. Trends over time
4. Insufficient funds frequency
5. Employer cost analysis (for matched deductions)

**Exceptions**:
- None

**Error Messages**:
- None

**Related Requirements**: FR-TR-DED-028

**Related Entities**: DeductionAnalytics, DeductionTransaction

---

### BR-TR-DED-029: Third-Party Remittance

**Priority**: HIGH

**Description**:
Remit deducted amounts to third parties.

**Conditions**:
```
WHEN deductions processed
THEN remit to third parties
```

**Rules**:
1. Aggregate deductions by recipient
2. Generate remittance file
3. Send to third party (insurance, 401k, court)
4. Track remittance status
5. Reconcile confirmations

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_029`: "Remittance failed for {recipient}: {reason}."

**Related Requirements**: FR-TR-DED-029

**Related Entities**: DeductionRemittance, ThirdParty

---

### BR-TR-DED-030: Deduction File Export

**Priority**: MEDIUM

**Description**:
Export deduction data for external systems.

**Conditions**:
```
WHEN export requested
THEN generate deduction file
```

**Rules**:
1. Export formats: CSV, XML, EDI
2. Include: Employee ID, Deduction code, Amount, Period
3. Validate data completeness
4. Encrypt sensitive data
5. Track export history

**Exceptions**:
- None

**Error Messages**:
- `ERR_DED_030`: "Deduction export failed: {reason}."

**Related Requirements**: FR-TR-DED-030

**Related Entities**: DeductionExport

---

### BR-TR-DED-031: Deduction Notification Rules

**Priority**: MEDIUM

**Description**:
Notify employees and stakeholders about deduction events.

**Conditions**:
```
WHEN deduction event occurs
THEN send notifications
```

**Rules**:
1. Enrollment confirmation to employee
2. Insufficient funds alert to employee and HR
3. Loan payoff notification
4. Court order expiration alert
5. Annual deduction summary

**Exceptions**:
- None

**Error Messages**:
- None

**Related Requirements**: FR-TR-DED-031

**Related Entities**: Notification, EmployeeDeduction

---

### BR-TR-DED-032: Deduction Data Retention

**Priority**: MEDIUM

**Description**:
Define retention policy for deduction data.

**Conditions**:
```
WHEN data older than retention period
THEN archive or delete per policy
```

**Rules**:
1. Retention period: 7 years (default)
2. Active employees: All data retained
3. Terminated employees: Retain per legal requirements
4. Archived data: Read-only
5. Deletion requires approval

**Exceptions**:
- Legal hold: Retain indefinitely
- Court-ordered: Retain until court releases

**Error Messages**:
- None

**Related Requirements**: FR-TR-DED-032

**Related Entities**: Deduction, RetentionPolicy

---

## Summary: Deductions Rules

**Total Rules**: 32  
**Priority Breakdown**:
- HIGH: 20 rules (63%)
- MEDIUM: 12 rules (37%)

**Categories**:
1. Deduction Setup (8 rules)
2. Deduction Processing (12 rules)
3. Integration & Reporting (12 rules)

**Key Highlights**:
- Pre-tax vs post-tax deduction handling
- Court-ordered deduction priority (always processed)
- Insufficient funds handling with priority-based processing
- Payroll and tax reporting integration
- Loan and advance recovery
- Complete audit trail and compliance reporting

---

**Status**: ✅ Deductions Rules Complete (32/32)
