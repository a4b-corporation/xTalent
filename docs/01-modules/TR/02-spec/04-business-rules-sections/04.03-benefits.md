# 3. Benefits Rules

## Category: Benefit Plan Setup

### BR-TR-BEN-001: Benefit Plan Code Uniqueness

**Priority**: HIGH

**Description**:
Each benefit plan must have a unique code within the legal entity.

**Conditions**:
```
IF creating BenefitPlan
AND code exists in same legal entity
THEN reject
```

**Rules**:
1. Code unique per legal entity
2. Format: uppercase with underscores
3. Maximum 50 characters
4. Cannot be changed once created
5. Descriptive naming (e.g., MEDICAL_VN_2025, DENTAL_PREMIUM)

**Exceptions**:
- None

**Error Messages**:
- `ERR_BEN_001`: "Benefit plan code '{code}' already exists in legal entity '{entity}'."

**Related Requirements**:
- FR-TR-BEN-001

**Related Entities**:
- BenefitPlan

---

### BR-TR-BEN-002: Benefit Plan Category Validation

**Priority**: HIGH

**Description**:
Benefit plan category determines plan type and configuration requirements.

**Conditions**:
```
IF creating BenefitPlan
THEN category must be valid
```

**Rules**:
1. Valid categories:
   - MEDICAL: health insurance
   - DENTAL: dental insurance
   - VISION: vision insurance
   - LIFE: life insurance
   - DISABILITY: short/long-term disability
   - RETIREMENT: 401k, pension
   - WELLNESS: gym, wellness programs
   - PERK: perks and benefits
   - EDUCATION: tuition reimbursement
   - TRANSPORTATION: commuter benefits
2. Category determines required fields
3. Category affects tax treatment
4. Cannot change category after enrollments exist

**Exceptions**:
- Category change requires new plan creation

**Error Messages**:
- `ERR_BEN_002`: "Invalid benefit plan category '{category}'."

**Related Requirements**:
- FR-TR-BEN-001

**Related Entities**:
- BenefitPlan

---

### BR-TR-BEN-003: Coverage Option Configuration

**Priority**: HIGH

**Description**:
Configure coverage options (tiers) for benefit plans.

**Conditions**:
```
IF plan has coverage options
THEN define valid coverage tiers
```

**Rules**:
1. Common coverage options:
   - EMPLOYEE_ONLY: employee only
   - EMPLOYEE_SPOUSE: employee + spouse
   - EMPLOYEE_CHILDREN: employee + children
   - EMPLOYEE_FAMILY: employee + spouse + children
2. Each option has:
   - Unique code
   - Display name
   - Premium amount
   - Dependent coverage rules
3. At least one option required
4. Maximum 10 options per plan

**Exceptions**:
- Some plans may have single coverage option only

**Error Messages**:
- `ERR_BEN_003`: "Coverage option code '{code}' already exists in plan."

**Examples**:
```yaml
Example: Medical plan coverage options
  Input:
    plan: MEDICAL_VN_2025
    options:
      - code: EE_ONLY
        name: "Employee Only"
        employee_premium: 500000
        employer_premium: 2000000
      - code: EE_FAMILY
        name: "Employee + Family"
        employee_premium: 1500000
        employer_premium: 4000000
  
  Validation:
    BR-BEN-003: PASS
  
  Output:
    2 coverage options configured
```

**Related Requirements**:
- FR-TR-BEN-002

**Related Entities**:
- BenefitOption

---

### BR-TR-BEN-004: Premium Calculation Method

**Priority**: HIGH

**Description**:
Define premium calculation method for benefit plans.

**Conditions**:
```
IF defining premium
THEN calculation method must be valid
```

**Rules**:
1. Calculation methods:
   - FLAT_AMOUNT: fixed amount per period
   - PERCENTAGE_SALARY: percentage of base salary
   - AGE_BANDED: rates by age brackets
   - SALARY_BANDED: rates by salary brackets
2. Method determines required parameters
3. Employee and employer portions defined separately
4. Total premium = employee + employer portions

**Exceptions**:
- Fully employer-paid: employee portion = 0

**Error Messages**:
- `ERR_BEN_004`: "Invalid premium calculation method '{method}'."

**Examples**:
```yaml
Example 1: Flat amount
  Input:
    method: FLAT_AMOUNT
    employee_premium: 500000 VND/month
    employer_premium: 2000000 VND/month
  
  Calculation:
    total_premium: 2,500,000 VND/month
  
  Validation:
    BR-BEN-004: PASS

Example 2: Age-banded
  Input:
    method: AGE_BANDED
    age_bands:
      - age: 18-29, rate: 1500000
      - age: 30-39, rate: 2000000
      - age: 40-49, rate: 2500000
      - age: 50+, rate: 3000000
    employee_age: 35
  
  Calculation:
    premium: 2,000,000 VND/month (30-39 band)
  
  Validation:
    BR-BEN-004: PASS
```

**Related Requirements**:
- FR-TR-BEN-002

**Related Entities**:
- BenefitOption

---

### BR-TR-BEN-005: Eligibility Rule Configuration

**Priority**: HIGH

**Description**:
Configure eligibility rules for benefit plans.

**Conditions**:
```
IF defining eligibility
THEN rules must be valid and enforceable
```

**Rules**:
1. Eligibility criteria:
   - Employment type (FULL_TIME, PART_TIME, etc.)
   - Minimum tenure (e.g., 90 days)
   - Grade/level requirements
   - Location requirements
   - Hours worked per week
2. Rules defined as JSON expressions
3. Multiple criteria combined with AND/OR
4. Eligibility evaluated at enrollment
5. Can use EligibilityProfile for reusability

**Exceptions**:
- Immediate eligibility for certain plans (e.g., life insurance)

**Error Messages**:
- `ERR_BEN_005`: "Eligibility rule syntax invalid: {error}."

**Examples**:
```yaml
Example: Medical plan eligibility
  Input:
    rule: |
      {
        "employment_type": ["FULL_TIME"],
        "min_tenure_days": 90,
        "min_hours_per_week": 30,
        "locations": ["VN", "SG"]
      }
  
  Validation:
    BR-BEN-005: PASS
  
  Eligible:
    - Full-time employees
    - 90+ days tenure
    - 30+ hours/week
    - In Vietnam or Singapore
```

**Related Requirements**:
- FR-TR-BEN-001
- FR-TR-BEN-018

**Related Entities**:
- BenefitPlan
- PlanEligibility
- EligibilityProfile

---

### BR-TR-BEN-006: Enrollment Period Configuration

**Priority**: HIGH

**Description**:
Configure enrollment periods for benefit plans.

**Conditions**:
```
IF creating enrollment period
THEN validate dates and type
```

**Rules**:
1. Enrollment period types:
   - OPEN_ENROLLMENT: annual enrollment
   - NEW_HIRE: for new employees
   - LIFE_EVENT: qualifying life events
2. Period must have:
   - Start date < end date
   - Type
   - Applicable plans
   - Status (DRAFT, OPEN, CLOSED)
3. Only one OPEN enrollment period active at a time
4. NEW_HIRE periods typically always open

**Exceptions**:
- Multiple LIFE_EVENT periods can be active

**Error Messages**:
- `ERR_BEN_006`: "Enrollment period {start} to {end} overlaps with existing period."

**Related Requirements**:
- FR-TR-BEN-003

**Related Entities**:
- EnrollmentPeriod

---

### BR-TR-BEN-007: Plan Effective Date Validation

**Priority**: HIGH

**Description**:
Benefit plan effective dates must be valid and aligned with plan year.

**Conditions**:
```
IF creating/updating plan
THEN effective_from < effective_to
AND aligned with plan year
```

**Rules**:
1. Effective from < effective to
2. Effective dates typically align with:
   - Calendar year (Jan 1 - Dec 31)
   - Fiscal year
   - Plan year (custom)
3. Cannot have gaps in plan coverage
4. Future-dated plans allowed
5. Cannot modify historical effective dates

**Exceptions**:
- Mid-year plan changes allowed with approval

**Error Messages**:
- `ERR_BEN_007`: "Plan effective dates invalid: from={from}, to={to}."

**Related Requirements**:
- FR-TR-BEN-001

**Related Entities**:
- BenefitPlan

---

### BR-TR-BEN-008: Provider Information Validation

**Priority**: MEDIUM

**Description**:
Validate insurance provider/carrier information.

**Conditions**:
```
IF plan has provider
THEN provider information must be complete
```

**Rules**:
1. Required provider fields:
   - Provider name
   - Provider code/ID
   - Contact information
   - Policy number
2. Provider must be active
3. Provider information used for:
   - Carrier file generation
   - Claims processing
   - Member ID generation
4. Multiple plans can share same provider

**Exceptions**:
- Self-insured plans may not have external provider

**Error Messages**:
- `ERR_BEN_008`: "Provider information incomplete for plan {plan_id}."

**Related Requirements**:
- FR-TR-BEN-001

**Related Entities**:
- BenefitPlan

---

### BR-TR-BEN-009: Plan Currency Validation

**Priority**: HIGH

**Description**:
Benefit plan currency must match legal entity currency or be approved.

**Conditions**:
```
IF creating plan
THEN currency must be valid for legal entity
```

**Rules**:
1. Currency must exist in Core.Currency
2. Must be active currency
3. Preferably matches legal entity default currency
4. Premium amounts in plan currency
5. Multi-currency requires approval

**Exceptions**:
- Global plans may use USD or other common currency

**Error Messages**:
- `ERR_BEN_009`: "Currency '{currency}' not valid for legal entity '{entity}'."

**Related Requirements**:
- FR-TR-BEN-001

**Related Entities**:
- BenefitPlan
- Core.Currency

---

### BR-TR-BEN-010: Plan Sponsor Validation

**Priority**: MEDIUM

**Description**:
Validate plan sponsor (legal entity offering the plan).

**Conditions**:
```
IF creating plan
THEN sponsor must be valid legal entity
```

**Rules**:
1. Sponsor must be active legal entity
2. Sponsor determines:
   - Regulatory compliance requirements
   - Tax treatment
   - Reporting requirements
3. Employees must be employed by sponsor to be eligible
4. One plan can have one sponsor only

**Exceptions**:
- Group plans may cover multiple legal entities

**Error Messages**:
- `ERR_BEN_010`: "Plan sponsor '{sponsor_id}' is not a valid legal entity."

**Related Requirements**:
- FR-TR-BEN-001

**Related Entities**:
- BenefitPlan
- Core.LegalEntity

---

### BR-TR-BEN-011: Plan Activation Rules

**Priority**: MEDIUM

**Description**:
Define rules for activating benefit plans.

**Conditions**:
```
IF activating plan
THEN plan must be complete and valid
```

**Rules**:
1. Plan activation checklist:
   - Plan details complete
   - Coverage options defined
   - Premium amounts configured
   - Eligibility rules defined
   - Enrollment period created
   - Provider information complete (if applicable)
2. Cannot activate incomplete plan
3. Activation makes plan available for enrollment
4. Can deactivate plan (no new enrollments)
5. Cannot delete plan with active enrollments

**Exceptions**:
- Draft plans can be saved incomplete

**Error Messages**:
- `ERR_BEN_011`: "Cannot activate plan: {missing_items} incomplete."

**Related Requirements**:
- FR-TR-BEN-001

**Related Entities**:
- BenefitPlan

---

**Status**: ✅ Benefits Batch 1 Complete (BR-BEN-001 to BR-BEN-011)

**Progress**: 112/~300 rules (37%)

**Next**: Benefits Batch 2 - Enrollment Management (BR-BEN-012 to BEN-022)


## Category: Enrollment Management

### BR-TR-BEN-012: Enrollment Eligibility Validation

**Priority**: HIGH

**Description**:
Validate employee eligibility before allowing enrollment.

**Conditions**:
```
IF employee attempts enrollment
THEN validate:
  - Employee meets plan eligibility rules
  - Enrollment period is active
  - Employee not already enrolled
```

**Rules**:
1. Employee must meet plan eligibility criteria
2. Enrollment period must be OPEN status
3. Employee cannot enroll twice in same plan
4. Eligibility evaluated at enrollment time
5. Eligibility changes may affect existing enrollments

**Exceptions**:
- Life events may override normal eligibility rules

**Error Messages**:
- `ERR_BEN_012`: "Employee {id} not eligible for plan {plan_code}: {reason}."
- `ERR_BEN_012_PERIOD`: "Enrollment period not active."

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment
- BenefitPlan
- EnrollmentPeriod

---

### BR-TR-BEN-013: Coverage Option Selection

**Priority**: HIGH

**Description**:
Validate coverage option selection during enrollment.

**Conditions**:
```
IF selecting coverage option
THEN option must be valid for plan
AND appropriate for dependents
```

**Rules**:
1. Coverage option must belong to selected plan
2. Coverage option must match dependents:
   - EMPLOYEE_ONLY: no dependents
   - EMPLOYEE_SPOUSE: spouse only
   - EMPLOYEE_CHILDREN: children only
   - EMPLOYEE_FAMILY: spouse and/or children
3. Cannot select family coverage without dependents
4. Must add dependents if family coverage selected

**Exceptions**:
- Can select family coverage in anticipation of future dependents

**Error Messages**:
- `ERR_BEN_013`: "Coverage option '{option}' requires dependents."

**Examples**:
```yaml
Example: Coverage validation
  Input:
    plan: MEDICAL_VN_2025
    coverage_option: EMPLOYEE_FAMILY
    dependents: []
  
  Validation:
    BR-BEN-013: FAIL (family coverage requires dependents)
  
  Output:
    Error: ERR_BEN_013

Example: Valid coverage
  Input:
    plan: MEDICAL_VN_2025
    coverage_option: EMPLOYEE_FAMILY
    dependents:
      - spouse: 1
      - children: 2
  
  Validation:
    BR-BEN_013: PASS
  
  Output:
    Enrollment allowed
```

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment
- BenefitOption

---

### BR-TR-BEN-014: Dependent Addition During Enrollment

**Priority**: HIGH

**Description**:
Validate dependents added during enrollment.

**Conditions**:
```
IF adding dependents to enrollment
THEN dependents must be:
  - Valid relationship
  - Age-eligible
  - Not already covered
```

**Rules**:
1. Valid relationships: spouse, child, domestic partner
2. Age limits:
   - Children: typically under 26
   - Spouse: no age limit
3. Dependent cannot be covered under multiple plans
4. Dependent verification may be required
5. Dependent information must be complete

**Exceptions**:
- Disabled dependents may exceed age limits

**Error Messages**:
- `ERR_BEN_014`: "Dependent {name} exceeds age limit for coverage."

**Related Requirements**:
- FR-TR-BEN-004
- FR-TR-BEN-006

**Related Entities**:
- Enrollment
- EmployeeDependent

---

### BR-TR-BEN-015: Premium Cost Calculation

**Priority**: HIGH

**Description**:
Calculate premium costs during enrollment.

**Conditions**:
```
IF enrolling in plan
THEN calculate:
  - Employee premium
  - Employer premium
  - Total premium
```

**Rules**:
1. Calculate based on premium method:
   - FLAT_AMOUNT: use configured amount
   - PERCENTAGE_SALARY: salary × percentage
   - AGE_BANDED: lookup by employee age
   - SALARY_BANDED: lookup by salary range
2. Calculate for selected coverage option
3. Show employee and employer portions separately
4. Calculate per pay period amount
5. Display annual and per-period costs

**Exceptions**:
- Fully employer-paid: employee cost = 0

**Error Messages**:
- `ERR_BEN_015`: "Premium calculation failed for plan {plan_id}."

**Examples**:
```yaml
Example: Premium calculation
  Input:
    plan: MEDICAL_VN_2025
    coverage_option: EMPLOYEE_FAMILY
    employee_premium: 1500000 VND/month
    employer_premium: 4000000 VND/month
    pay_frequency: MONTHLY
  
  Calculation:
    total_premium: 5,500,000 VND/month
    employee_cost: 1,500,000 VND/month
    employer_cost: 4,000,000 VND/month
  
  Validation:
    BR-BEN-015: PASS
  
  Output:
    Employee pays: 1.5M VND/month
    Employer pays: 4.0M VND/month
```

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment
- BenefitOption

---

### BR-TR-BEN-016: Enrollment Confirmation

**Priority**: MEDIUM

**Description**:
Confirm enrollment and create enrollment record.

**Conditions**:
```
IF employee confirms enrollment
THEN create enrollment record
WITH status = PENDING or ACTIVE
```

**Rules**:
1. Enrollment record created with:
   - Employee ID
   - Plan ID
   - Coverage option
   - Dependents (if any)
   - Premium amounts
   - Effective date
   - Status (PENDING or ACTIVE)
2. Status = PENDING if approval required
3. Status = ACTIVE if no approval needed
4. Employee receives confirmation
5. Enrollment counted against enrollment period

**Exceptions**:
- Some plans may require manager/HR approval

**Error Messages**:
- `ERR_BEN_016`: "Enrollment confirmation failed: {error}."

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment

---

### BR-TR-BEN-017: Enrollment Change Rules

**Priority**: MEDIUM

**Description**:
Define rules for changing enrollments.

**Conditions**:
```
IF changing enrollment
THEN change must be:
  - During open enrollment OR
  - Due to qualifying life event OR
  - With HR approval
```

**Rules**:
1. Changes allowed during:
   - Open enrollment period
   - Life event window (30 days)
   - With HR approval (any time)
2. Change types:
   - Add/remove dependents
   - Change coverage option
   - Cancel enrollment
3. Changes effective:
   - Next period start (open enrollment)
   - Event date (life event)
   - Approval date (HR approved)
4. Premium adjusted accordingly

**Exceptions**:
- Emergency changes may be backdated

**Error Messages**:
- `ERR_BEN_017`: "Enrollment changes not allowed outside enrollment period."

**Related Requirements**:
- FR-TR-BEN-005

**Related Entities**:
- Enrollment

---

### BR-TR-BEN-018: Enrollment Waiver Management

**Priority**: MEDIUM

**Description**:
Manage enrollment waivers when employees decline coverage.

**Conditions**:
```
IF employee declines coverage
THEN record waiver
WITH reason
```

**Rules**:
1. Waiver reasons:
   - Covered under spouse's plan
   - Covered under parent's plan
   - Individual plan purchased
   - Other coverage
   - Cannot afford
2. Waiver must be documented
3. Waiver effective for plan year
4. Can enroll later with life event
5. Waiver may affect other benefits

**Exceptions**:
- Some plans may be mandatory (no waiver allowed)

**Error Messages**:
- `ERR_BEN_018`: "Cannot waive mandatory plan {plan_code}."

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment

---

### BR-TR-BEN-019: Enrollment Deadline Enforcement

**Priority**: HIGH

**Description**:
Enforce enrollment deadlines.

**Conditions**:
```
IF enrollment period ends
THEN no new enrollments allowed
UNLESS life event or special approval
```

**Rules**:
1. Enrollments must be submitted before period end
2. Late enrollments rejected
3. Exceptions:
   - Life events (30-day window)
   - HR approved exceptions
   - System errors
4. Deadline reminders sent:
   - 2 weeks before
   - 1 week before
   - 1 day before
5. Auto-enrollment for certain plans if no action

**Exceptions**:
- New hires have 30 days from hire date

**Error Messages**:
- `ERR_BEN_019`: "Enrollment period ended on {date}. Cannot enroll."

**Related Requirements**:
- FR-TR-BEN-003

**Related Entities**:
- EnrollmentPeriod
- Enrollment

---

### BR-TR-BEN-020: Enrollment Validation Summary

**Priority**: MEDIUM

**Description**:
Provide enrollment validation summary before confirmation.

**Conditions**:
```
IF employee reviews enrollment
THEN show validation summary:
  - Plans selected
  - Coverage options
  - Dependents
  - Costs
  - Effective dates
```

**Rules**:
1. Summary includes:
   - All selected plans
   - Coverage options
   - Covered dependents
   - Premium costs (employee/employer)
   - Total annual cost
   - Effective dates
2. Highlight any warnings or issues
3. Require explicit confirmation
4. Allow changes before final submission

**Exceptions**:
- None

**Error Messages**:
- N/A (informational)

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment

---

### BR-TR-BEN-021: Duplicate Enrollment Prevention

**Priority**: HIGH

**Description**:
Prevent duplicate enrollments in same plan.

**Conditions**:
```
IF employee already enrolled in plan
AND attempting to enroll again
THEN reject
```

**Rules**:
1. One enrollment per employee per plan per period
2. Check for existing active enrollment
3. Allow enrollment if previous is:
   - CANCELLED
   - TERMINATED
   - WAIVED
4. Prevent accidental duplicate submissions
5. Allow changing existing enrollment

**Exceptions**:
- Can have multiple enrollments across different plans

**Error Messages**:
- `ERR_BEN_021`: "Already enrolled in plan {plan_code}. Use 'Change Enrollment' instead."

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment

---

### BR-TR-BEN-022: Enrollment Effective Date

**Priority**: HIGH

**Description**:
Determine enrollment effective date.

**Conditions**:
```
IF enrollment confirmed
THEN set effective_date based on:
  - Enrollment type
  - Enrollment date
  - Plan rules
```

**Rules**:
1. Effective date by enrollment type:
   - OPEN_ENROLLMENT: next plan year start (e.g., Jan 1)
   - NEW_HIRE: hire date or first of month after hire
   - LIFE_EVENT: event date or first of month after event
2. Cannot be in past (except corrections)
3. Must align with payroll periods
4. Coverage begins on effective date
5. Premium deductions start on effective date

**Exceptions**:
- Retroactive effective dates require HR approval

**Error Messages**:
- `ERR_BEN_022`: "Effective date {date} is invalid for enrollment type {type}."

**Examples**:
```yaml
Example 1: New hire enrollment
  Input:
    enrollment_type: NEW_HIRE
    hire_date: 2025-01-15
    enrollment_date: 2025-01-20
    plan_rule: "First of month after hire"
  
  Calculation:
    effective_date: 2025-02-01
  
  Validation:
    BR-BEN-022: PASS
  
  Output:
    Coverage effective: Feb 1, 2025

Example 2: Open enrollment
  Input:
    enrollment_type: OPEN_ENROLLMENT
    enrollment_date: 2024-11-15
    plan_year_start: 2025-01-01
  
  Calculation:
    effective_date: 2025-01-01
  
  Validation:
    BR-BEN-022: PASS
  
  Output:
    Coverage effective: Jan 1, 2025
```

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment

---

**Status**: ✅ Benefits Batch 2 Complete (BR-BEN-012 to BR-BEN-022)

**Progress**: 123/~300 rules (41%)

**Next**: Benefits Batch 3 - Dependents & Beneficiaries (BR-BEN-023 to BEN-033)



## Category: Dependents & Beneficiaries

### BR-TR-BEN-023: Dependent Relationship Validation

**Priority**: HIGH

**Description**:
Validate dependent relationships are legally recognized.

**Conditions**:
```
IF adding dependent
THEN relationship must be valid
AND legally recognized
```

**Rules**:
1. Valid relationships:
   - SPOUSE: legally married spouse
   - CHILD: biological or adopted child
   - DOMESTIC_PARTNER: registered domestic partner
   - STEPCHILD: spouse's child
2. Relationship determines coverage eligibility
3. Legal documentation may be required
4. Same-sex spouse recognized
5. Domestic partner rules vary by jurisdiction

**Exceptions**:
- Extended family (parents, siblings) for certain plans
- Legal guardianship for non-biological children

**Error Messages**:
- `ERR_BEN_023`: "Invalid dependent relationship '{relationship}'."

**Related Requirements**:
- FR-TR-BEN-006

**Related Entities**:
- EmployeeDependent

---

### BR-TR-BEN-024: Dependent Age Limits

**Priority**: HIGH

**Description**:
Enforce age limits for dependent coverage.

**Conditions**:
```
IF dependent age > limit
THEN coverage terminates
UNLESS exception applies
```

**Rules**:
1. Standard age limits:
   - Children: 26 years (ACA standard)
   - Disabled dependents: no limit
   - Full-time students: may extend to 26+
2. Age calculated on birthday
3. Coverage auto-terminates at age limit
4. Notification sent 60 days before termination
5. Exception process for disabled dependents

**Exceptions**:
- Disabled dependents certified by physician
- Some jurisdictions have different limits (e.g., 25 in some countries)

**Error Messages**:
- `ERR_BEN_024`: "Dependent {name} exceeds age limit of {limit} years."
- `WARN_BEN_024`: "Dependent {name} will age out on {date}."

**Examples**:
```yaml
Example: Age limit enforcement
  Input:
    dependent: John Doe
    relationship: CHILD
    date_of_birth: 1999-01-15
    current_date: 2025-01-15
    age: 26
    age_limit: 26
  
  Validation:
    BR-BEN-024: FAIL (age = limit)
  
  Action:
    Coverage terminates: 2025-01-15
    Notification sent: 2024-11-15 (60 days prior)
```

**Related Requirements**:
- FR-TR-BEN-006

**Related Entities**:
- EmployeeDependent

---

### BR-TR-BEN-025: Dependent Verification Requirements

**Priority**: MEDIUM

**Description**:
Require verification of dependent eligibility.

**Conditions**:
```
IF adding dependent
THEN verification may be required
BASED ON plan rules
```

**Rules**:
1. Verification documents:
   - Birth certificate (children)
   - Marriage certificate (spouse)
   - Adoption papers (adopted children)
   - Domestic partner affidavit
   - Court order (legal guardianship)
2. Verification timing:
   - At enrollment
   - Annually (random audit)
   - Life event changes
3. Failure to verify: coverage suspended
4. Verification deadline: typically 30 days
5. Document retention: 7 years

**Exceptions**:
- Emergency coverage pending verification (30 days)

**Error Messages**:
- `WARN_BEN_025`: "Dependent verification required by {date}."
- `ERR_BEN_025`: "Coverage suspended: verification not received."

**Related Requirements**:
- FR-TR-BEN-009

**Related Entities**:
- EmployeeDependent

---

### BR-TR-BEN-026: Beneficiary Designation

**Priority**: MEDIUM

**Description**:
Allow beneficiary designation for life insurance and retirement plans.

**Conditions**:
```
IF plan allows beneficiaries
THEN employee can designate:
  - Primary beneficiaries
  - Contingent beneficiaries
  - Allocation percentages
```

**Rules**:
1. Beneficiary types:
   - Primary: first in line to receive benefits
   - Contingent: receive if primary deceased
2. Allocation percentages must sum to 100% per type
3. Beneficiary can be:
   - Person (with relationship)
   - Trust
   - Estate
   - Charity
4. Multiple beneficiaries allowed
5. Can update anytime (no enrollment period restriction)

**Exceptions**:
- Some jurisdictions require spouse consent to name non-spouse primary beneficiary

**Error Messages**:
- `ERR_BEN_026`: "Primary beneficiary allocations sum to {sum}%, expected 100%."

**Examples**:
```yaml
Example: Beneficiary designation
  Input:
    plan: LIFE_INSURANCE_500K
    primary_beneficiaries:
      - name: Jane Doe (spouse), allocation: 60%
      - name: John Doe Jr (child), allocation: 40%
    contingent_beneficiaries:
      - name: Mary Doe (mother), allocation: 100%
  
  Validation:
    Primary sum: 60% + 40% = 100% ✓
    Contingent sum: 100% ✓
    BR-BEN-026: PASS
  
  Output:
    Beneficiaries designated successfully
```

**Related Requirements**:
- FR-TR-BEN-007

**Related Entities**:
- BenefitBeneficiary

---

### BR-TR-BEN-027: Dependent Coverage Termination

**Priority**: HIGH

**Description**:
Terminate dependent coverage when eligibility ends.

**Conditions**:
```
IF dependent no longer eligible
THEN terminate coverage
WITH proper notice
```

**Rules**:
1. Termination triggers:
   - Age limit reached
   - No longer dependent (e.g., divorce for spouse)
   - Employee coverage terminated
   - Failure to verify eligibility
   - Death of dependent
2. Termination effective date:
   - End of month (standard)
   - Specific event date (divorce, death)
3. COBRA offer (if applicable)
4. Notification to employee and dependent (if applicable)
5. Premium adjustment processed

**Exceptions**:
- Grace period (30 days) for verification issues

**Error Messages**:
- N/A (automated process with notifications)

**Related Requirements**:
- FR-TR-BEN-006

**Related Entities**:
- EmployeeDependent
- Enrollment

---

### BR-TR-BEN-028: Dependent SSN/Tax ID Requirements

**Priority**: MEDIUM

**Description**:
Require SSN or tax ID for dependents for tax reporting.

**Conditions**:
```
IF dependent is covered
THEN SSN/tax ID required for tax reporting
```

**Rules**:
1. SSN required for:
   - US dependents
   - Tax reporting (IRS Form 1095-C)
2. Tax ID alternatives:
   - ITIN (Individual Taxpayer ID)
   - Foreign tax ID (for non-US dependents)
3. Collection timing:
   - At enrollment
   - Before year-end for tax reporting
4. Validation: SSN format (XXX-XX-XXXX)
5. Secure storage (PII protection)

**Exceptions**:
- Newborns: grace period to obtain SSN (90 days)
- Non-US dependents: alternative ID acceptable

**Error Messages**:
- `WARN_BEN_028`: "SSN required for dependent {name} for tax reporting."

**Related Requirements**:
- FR-TR-BEN-006

**Related Entities**:
- EmployeeDependent

---

**Status**: ✅ Benefits Batch 3a Complete (BR-BEN-023 to BR-BEN-028)

**Progress**: 129/~300 rules (43%)

**Next**: Benefits Batch 3b (BR-BEN-029 to BEN-033)


### BR-TR-BEN-029: Dependent Address Validation

**Priority**: LOW

**Description**:
Validate dependent address information.

**Conditions**:
```
IF dependent requires separate address
THEN address must be valid
```

**Rules**:
1. Address required if dependent lives separately
2. Address validation:
   - Street address
   - City
   - State/province
   - Postal code
   - Country
3. Address used for:
   - Insurance card mailing
   - COBRA notices
   - Tax reporting
4. Can share employee address if living together

**Exceptions**:
- Minor children typically share employee address

**Error Messages**:
- `WARN_BEN_029`: "Dependent address incomplete."

**Related Requirements**:
- FR-TR-BEN-006

**Related Entities**:
- EmployeeDependent

---

### BR-TR-BEN-030: Multiple Dependent Management

**Priority**: MEDIUM

**Description**:
Manage multiple dependents efficiently.

**Conditions**:
```
IF employee has multiple dependents
THEN system must support:
  - Bulk operations
  - Individual management
  - Coverage tracking
```

**Rules**:
1. No limit on number of dependents
2. Each dependent tracked separately
3. Coverage can vary by dependent
4. Premium calculated per dependent or family tier
5. Bulk add/update/remove operations supported

**Exceptions**:
- Some plans limit number of covered dependents

**Error Messages**:
- N/A (system capability)

**Related Requirements**:
- FR-TR-BEN-006

**Related Entities**:
- EmployeeDependent

---

### BR-TR-BEN-031: Beneficiary Update Rules

**Priority**: MEDIUM

**Description**:
Allow beneficiary updates with proper validation.

**Conditions**:
```
IF updating beneficiaries
THEN validate:
  - Allocations sum to 100%
  - Beneficiary information complete
  - Changes logged
```

**Rules**:
1. Can update anytime (no enrollment period restriction)
2. Changes effective immediately
3. Previous beneficiary designation archived
4. Audit trail maintained
5. Confirmation sent to employee

**Exceptions**:
- Spousal consent may be required in some jurisdictions

**Error Messages**:
- `ERR_BEN_031`: "Beneficiary update failed: {reason}."

**Related Requirements**:
- FR-TR-BEN-007

**Related Entities**:
- BenefitBeneficiary

---

### BR-TR-BEN-032: Dependent COBRA Eligibility

**Priority**: MEDIUM

**Description**:
Determine COBRA eligibility for dependents (US).

**Conditions**:
```
IF dependent loses coverage
DUE TO qualifying event
THEN offer COBRA
```

**Rules**:
1. Dependent qualifying events:
   - Employee termination
   - Divorce/legal separation
   - Death of employee
   - Dependent aging out
   - Loss of dependent status
2. COBRA period: 36 months for dependent events
3. Dependent can elect COBRA independently
4. Premium: 102% of plan cost

**Exceptions**:
- Not applicable outside US

**Error Messages**:
- N/A (compliance process)

**Related Requirements**:
- FR-TR-BEN-016

**Related Entities**:
- EmployeeDependent
- Enrollment

---

### BR-TR-BEN-033: Dependent Premium Allocation

**Priority**: MEDIUM

**Description**:
Allocate premium costs for dependent coverage.

**Conditions**:
```
IF coverage includes dependents
THEN calculate premium:
  - Per dependent OR
  - Family tier
```

**Rules**:
1. Premium calculation methods:
   - FAMILY_TIER: flat rate for family coverage
   - PER_DEPENDENT: incremental cost per dependent
   - COMPOSITE: blended rate
2. Employee and employer portions defined
3. Premium shown on enrollment summary
4. Premium deducted from payroll

**Exceptions**:
- Some plans fully employer-paid

**Error Messages**:
- `ERR_BEN_033`: "Premium calculation failed for dependent coverage."

**Examples**:
```yaml
Example: Family tier pricing
  Input:
    coverage_option: EMPLOYEE_FAMILY
    employee_premium: 1500000 VND/month
    employer_premium: 4000000 VND/month
    number_of_dependents: 3 (spouse + 2 children)
  
  Calculation:
    total_premium: 5,500,000 VND/month (flat family rate)
    employee_pays: 1,500,000 VND/month
    employer_pays: 4,000,000 VND/month
  
  Validation:
    BR-BEN-033: PASS
  
  Output:
    Family coverage: 5.5M VND/month
```

**Related Requirements**:
- FR-TR-BEN-004

**Related Entities**:
- Enrollment
- BenefitOption

---

**Status**: ✅ Benefits Batch 3b Complete (BR-BEN-029 to BR-BEN-033)

**Progress**: 134/~300 rules (45%)

**Next**: Benefits Batch 4a - Claims & Reimbursements Part 1 (BR-BEN-034 to BEN-039)


## Category: Claims & Reimbursements

### BR-TR-BEN-034: Reimbursement Request Validation

**Priority**: HIGH

**Description**:
Validate reimbursement requests before processing.

**Conditions**:
```
IF submitting reimbursement
THEN validate:
  - Employee has active plan
  - Expense is eligible
  - Within submission deadline
  - Required documentation provided
```

**Rules**:
1. Employee must have active enrollment in plan
2. Expense must be eligible per plan rules
3. Submission deadline: typically 90 days from expense date
4. Required documents:
   - Receipt/invoice
   - Proof of payment
   - Prescription (if medical)
   - Itemized statement
5. Amount must be reasonable and match documentation

**Exceptions**:
- Late submissions with HR approval
- Emergency situations may have expedited processing

**Error Messages**:
- `ERR_BEN_034`: "Reimbursement request invalid: {reason}."
- `ERR_BEN_034_DEADLINE`: "Expense date {date} exceeds 90-day submission deadline."

**Related Requirements**:
- FR-TR-BEN-010

**Related Entities**:
- ReimbursementRequest

---

### BR-TR-BEN-035: Claim Amount Limits

**Priority**: HIGH

**Description**:
Enforce claim amount limits per plan rules.

**Conditions**:
```
IF processing claim
THEN validate against:
  - Annual maximum
  - Per-incident maximum
  - Lifetime maximum
```

**Rules**:
1. Limit types:
   - Annual maximum: per plan year
   - Per-incident maximum: per claim
   - Lifetime maximum: total over all years
2. Limits tracked by:
   - Employee
   - Dependent
   - Family aggregate
3. Limits reset annually (for annual limits)
4. Exceeding limit: claim denied or partial approval
5. Limits displayed to employee

**Exceptions**:
- Some plans have no maximum (unlimited)
- Preventive care may be exempt from limits

**Error Messages**:
- `ERR_BEN_035`: "Claim amount {amount} exceeds annual maximum {max}."

**Examples**:
```yaml
Example: Annual maximum enforcement
  Input:
    plan: DENTAL_2025
    annual_maximum: 50000000 VND
    claims_to_date: 45000000 VND
    new_claim: 10000000 VND
  
  Validation:
    total_if_approved: 45M + 10M = 55M
    exceeds_max: 55M > 50M
    BR-BEN-035: FAIL
  
  Action:
    Partial approval: 5M (remaining balance)
    Denied amount: 5M
```

**Related Requirements**:
- FR-TR-BEN-010

**Related Entities**:
- ReimbursementRequest
- BenefitPlan

---

### BR-TR-BEN-036: Claim Approval Workflow

**Priority**: MEDIUM

**Description**:
Route claims through approval workflow based on amount and type.

**Conditions**:
```
IF claim amount > threshold
OR claim type requires review
THEN route for approval
```

**Rules**:
1. Auto-approval thresholds:
   - Small claims: <5M VND
   - Standard claims: <20M VND
2. Manual review required:
   - Large claims: >20M VND
   - Unusual expenses
   - First-time claimants
3. Approval levels:
   - Benefits Admin: <50M VND
   - HR Manager: >50M VND
4. SLA: 5 business days for review
5. Notification to employee on status change

**Exceptions**:
- Emergency claims: expedited review (24 hours)

**Error Messages**:
- N/A (workflow process)

**Related Requirements**:
- FR-TR-BEN-011

**Related Entities**:
- ReimbursementRequest

---

### BR-TR-BEN-037: Reimbursement Calculation

**Priority**: HIGH

**Description**:
Calculate reimbursement amount based on plan rules.

**Conditions**:
```
IF claim approved
THEN calculate reimbursement:
  - Apply coverage percentage
  - Apply deductible
  - Apply copay
  - Enforce maximums
```

**Rules**:
1. Calculation steps:
   - Eligible amount = submitted amount (if eligible)
   - Apply deductible (if not met)
   - Apply coverage % (e.g., 80%)
   - Apply copay (if applicable)
   - Check against maximums
2. Deductible tracking:
   - Annual deductible
   - Deductible met to date
   - Remaining deductible
3. Reimbursement = MIN(calculated, remaining maximum)

**Exceptions**:
- 100% coverage for preventive care (no deductible/copay)

**Error Messages**:
- `ERR_BEN_037`: "Reimbursement calculation failed: {error}."

**Examples**:
```yaml
Example: Reimbursement calculation
  Input:
    expense_amount: 10000000 VND
    annual_deductible: 5000000 VND
    deductible_met: 3000000 VND
    coverage_percentage: 80%
    copay: 500000 VND
  
  Calculation:
    remaining_deductible: 5M - 3M = 2M
    amount_after_deductible: 10M - 2M = 8M
    covered_amount: 8M × 80% = 6.4M
    reimbursement: 6.4M - 500K = 5.9M
  
  Validation:
    BR-BEN-037: PASS
  
  Output:
    Employee reimbursed: 5.9M VND
    Employee pays: 4.1M VND (2M deductible + 1.6M coinsurance + 500K copay)
```

**Related Requirements**:
- FR-TR-BEN-010

**Related Entities**:
- ReimbursementRequest

---

### BR-TR-BEN-038: Payment Processing

**Priority**: HIGH

**Description**:
Process approved reimbursements for payment.

**Conditions**:
```
IF claim approved
THEN process payment:
  - Calculate net amount
  - Integrate with payroll OR
  - Direct deposit
```

**Rules**:
1. Payment methods:
   - Payroll: included in next paycheck
   - Direct deposit: separate transfer
   - Check: mailed to employee
2. Payment timing:
   - Payroll: next pay cycle
   - Direct deposit: 3-5 business days
   - Check: 7-10 business days
3. Tax withholding (if applicable)
4. Payment confirmation to employee
5. Payment reconciliation

**Exceptions**:
- Emergency payments: expedited processing

**Error Messages**:
- `ERR_BEN_038`: "Payment processing failed: {error}."

**Related Requirements**:
- FR-TR-BEN-010

**Related Entities**:
- ReimbursementRequest

---

### BR-TR-BEN-039: Claim Denial Reasons

**Priority**: MEDIUM

**Description**:
Document clear denial reasons for rejected claims.

**Conditions**:
```
IF claim denied
THEN provide:
  - Denial reason code
  - Detailed explanation
  - Appeal rights
```

**Rules**:
1. Common denial reasons:
   - Not eligible expense
   - Exceeds maximum
   - Missing documentation
   - Late submission
   - Duplicate claim
   - Not covered under plan
2. Denial notification includes:
   - Reason code
   - Detailed explanation
   - Appeal process
   - Appeal deadline
3. Denial logged in system
4. Employee can appeal

**Exceptions**:
- None

**Error Messages**:
- N/A (denial notification)

**Related Requirements**:
- FR-TR-BEN-011

**Related Entities**:
- ReimbursementRequest

---

### BR-TR-BEN-040: Appeal Process

**Priority**: MEDIUM

**Description**:
Allow employees to appeal denied claims.

**Conditions**:
```
IF claim denied
THEN employee can appeal
WITHIN appeal deadline
```

**Rules**:
1. Appeal deadline: 60 days from denial
2. Appeal must include:
   - Original claim reference
   - Reason for appeal
   - Additional documentation (if any)
3. Appeal review:
   - Different reviewer than original
   - 15 business days for decision
4. Appeal decision is final
5. Employee notified of outcome

**Exceptions**:
- Late appeals with exceptional circumstances

**Error Messages**:
- `ERR_BEN_040`: "Appeal deadline expired on {date}."

**Related Requirements**:
- FR-TR-BEN-011

**Related Entities**:
- ReimbursementRequest

---

### BR-TR-BEN-041: Healthcare Claim Integration

**Priority**: MEDIUM

**Description**:
Integrate with healthcare providers for direct claims (if applicable).

**Conditions**:
```
IF plan supports direct claims
THEN integrate with provider network
```

**Rules**:
1. Integration types:
   - EDI 837 (claim submission)
   - EDI 835 (payment/remittance)
2. Direct claims:
   - Provider submits to insurer
   - Employee not involved in payment
   - Employee receives EOB (Explanation of Benefits)
3. Coordination of benefits (if multiple plans)
4. Real-time eligibility verification

**Exceptions**:
- Out-of-network: employee files claim

**Error Messages**:
- `ERR_BEN_041`: "Provider claim integration failed: {error}."

**Related Requirements**:
- FR-TR-BEN-012

**Related Entities**:
- ReimbursementRequest
- BenefitPlan

---

### BR-TR-BEN-042: Claim Reconciliation

**Priority**: MEDIUM

**Description**:
Reconcile claims with plan budgets and carrier invoices.

**Conditions**:
```
IF processing claims
THEN reconcile:
  - Claims paid vs budget
  - Claims paid vs carrier invoice
```

**Rules**:
1. Reconciliation frequency: monthly
2. Reconcile:
   - Total claims paid
   - Claims by plan
   - Claims by employee
   - Carrier invoice amounts
3. Investigate variances >1%
4. Adjust accruals if needed
5. Report to finance

**Exceptions**:
- None

**Error Messages**:
- `WARN_BEN_042`: "Reconciliation variance detected: {variance}."

**Related Requirements**:
- FR-TR-BEN-015

**Related Entities**:
- ReimbursementRequest

---

### BR-TR-BEN-043: Fraud Detection

**Priority**: HIGH

**Description**:
Detect and prevent fraudulent claims.

**Conditions**:
```
IF claim exhibits fraud indicators
THEN flag for investigation
```

**Rules**:
1. Fraud indicators:
   - Duplicate claims
   - Excessive claim frequency
   - Unusual expense amounts
   - Altered documents
   - Claims for ineligible dependents
2. Automated fraud detection
3. Manual review for flagged claims
4. Investigation process
5. Consequences: denial, recovery, termination

**Exceptions**:
- False positives: manual override

**Error Messages**:
- `WARN_BEN_043`: "Claim flagged for fraud review: {reason}."

**Related Requirements**:
- FR-TR-BEN-011

**Related Entities**:
- ReimbursementRequest

---

### BR-TR-BEN-044: Claim Reporting

**Priority**: MEDIUM

**Description**:
Generate claim reports for analysis and compliance.

**Conditions**:
```
IF reporting period ends
THEN generate claim reports
```

**Rules**:
1. Standard reports:
   - Claims summary by plan
   - Claims by employee
   - Approval/denial rates
   - Average claim amount
   - Claims aging
   - Cost trends
2. Report frequency: monthly, quarterly
3. Reports for:
   - Management: cost analysis
   - Finance: budget tracking
   - Compliance: audit trail
4. Automated report generation

**Exceptions**:
- Ad-hoc reports as needed

**Error Messages**:
- `ERR_BEN_044`: "Report generation failed: {error}."

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- ReimbursementRequest

---

**Status**: ✅ Benefits Batch 4 Complete (BR-BEN-034 to BR-BEN-044)

**Progress**: 145/~300 rules (48%)

**Next**: Benefits Batch 5 - COBRA & Compliance (BR-BEN-045 to BEN-055)


## Category: COBRA & Compliance

### BR-TR-BEN-045: COBRA Eligibility Determination

**Priority**: MEDIUM

**Description**:
Determine COBRA eligibility for terminated employees and dependents (US).

**Conditions**:
```
IF qualifying event occurs
AND plan is COBRA-eligible
THEN offer COBRA continuation
```

**Rules**:
1. COBRA applies to:
   - Employers with 20+ employees
   - Group health plans
2. Qualifying events:
   - Employee: termination (except gross misconduct), hours reduction
   - Spouse: divorce, legal separation, employee death, Medicare eligibility
   - Dependent child: loss of dependent status, aging out
3. COBRA period:
   - 18 months: termination, hours reduction
   - 36 months: other qualifying events
4. Notice deadline: 14 days from qualifying event

**Exceptions**:
- Termination for gross misconduct: no COBRA
- Disability extension: additional 11 months (total 29)

**Error Messages**:
- N/A (compliance process)

**Related Requirements**:
- FR-TR-BEN-016

**Related Entities**:
- Enrollment
- LifeEvent

---

### BR-TR-BEN-046: COBRA Notice Generation

**Priority**: HIGH

**Description**:
System must automatically generate COBRA continuation coverage notices within 14 days of qualifying event.

**Conditions**:
```
IF qualifying_event occurs
AND employee has group health coverage
AND employer has 20+ employees
THEN generate COBRA notice within 14 days
```

**Rules**:
1. Notice must be sent within 14 days of qualifying event
2. Notice includes:
   - Rights and obligations
   - Coverage options
   - Premium amounts (102% of total cost)
   - Election deadline (60 days)
   - Contact information
3. Delivery methods: mail, email (with confirmation)
4. Track delivery status
5. Maintain notice history for audit

**Exceptions**:
- Termination for gross misconduct: no COBRA required
- Small employers (<20 employees): exempt

**Error Messages**:
- `ERR_BEN_046`: "COBRA notice generation failed: {error}."
- `WARN_BEN_046`: "COBRA notice deadline approaching for event {event_id}."

**Examples**:
```yaml
Example: Employee Termination
  Input:
    employee_id: EMP_001
    event_type: TERMINATION
    event_date: "2025-03-15"
    coverage: MEDICAL_FAMILY
  
  System Actions:
    1. Create LifeEvent (type: TERMINATION)
    2. Generate COBRA notice
    3. Send notice by 2025-03-29 (14 days)
    4. Set election deadline: 2025-05-14 (60 days)
  
  Notice Includes:
    - Coverage continuation rights
    - Premium: 4,500,000 VND/month (102% of 4,411,765)
    - Election period: 60 days
    - Payment due dates
  
  Validation:
    BR-TR-BEN-046: PASS
  
  Output:
    COBRA notice generated and sent
```

**Related Requirements**:
- FR-TR-BEN-016

**Related Entities**:
- LifeEvent
- Enrollment
- COBRANotice

---

### BR-TR-BEN-047: COBRA Premium Calculation

**Priority**: HIGH

**Description**:
COBRA premiums must be calculated at 102% of total cost (employee + employer portions).

**Conditions**:
```
IF employee elects COBRA
THEN premium = (employee_cost + employer_cost) × 1.02
```

**Rules**:
1. Premium = 102% of total cost (covers admin fees)
2. Includes both employee and employer portions
3. Premium can increase with plan cost changes
4. Must notify of premium changes 30 days in advance
5. Disability extension: 150% of total cost (months 19-29)

**Exceptions**:
- Disability extension: 150% premium after month 18

**Error Messages**:
- `ERR_BEN_047`: "COBRA premium calculation error: {error}."

**Examples**:
```yaml
Example: COBRA Premium Calculation
  Input:
    plan: MEDICAL_FAMILY
    employee_cost: 1,200,000 VND
    employer_cost: 3,600,000 VND
    total_cost: 4,800,000 VND
  
  Calculation:
    COBRA_premium = 4,800,000 × 1.02 = 4,896,000 VND/month
  
  Validation:
    BR-TR-BEN-047: PASS
  
  Output:
    Monthly COBRA premium: 4,896,000 VND
```

**Related Requirements**:
- FR-TR-BEN-016

**Related Entities**:
- Enrollment
- BenefitOption

---

### BR-TR-BEN-048: COBRA Payment Processing

**Priority**: HIGH

**Description**:
COBRA payments must be received by due date to maintain coverage.

**Conditions**:
```
IF COBRA payment due
AND payment not received by grace period end
THEN terminate coverage
```

**Rules**:
1. Initial payment due: 45 days from election
2. Subsequent payments: 1st of each month
3. Grace period: 30 days
4. Late payment: coverage continues during grace period
5. Non-payment: coverage terminates end of grace period
6. Retroactive termination if no payment

**Exceptions**:
- Payment disputes: hold termination pending resolution

**Error Messages**:
- `ERR_BEN_048`: "COBRA payment overdue for enrollment {id}."
- `WARN_BEN_048`: "COBRA payment due in {days} days."

**Examples**:
```yaml
Example: COBRA Payment Timeline
  Input:
    election_date: "2025-04-01"
    coverage_start: "2025-04-01"
    monthly_premium: 4,896,000 VND
  
  Payment Schedule:
    Initial Payment:
      Due: 2025-05-16 (45 days from election)
      Covers: April + May
      Amount: 9,792,000 VND
    
    June Payment:
      Due: 2025-06-01
      Grace Period: Until 2025-07-01
      Amount: 4,896,000 VND
  
  Scenario: Late Payment
    Payment Due: 2025-06-01
    Payment Received: 2025-06-25
    Status: ACTIVE (within grace period)
  
  Scenario: Non-Payment
    Payment Due: 2025-06-01
    Grace Period Ends: 2025-07-01
    No Payment Received
    Action: Terminate coverage 2025-07-01
  
  Validation:
    BR-TR-BEN-048: PASS
```

**Related Requirements**:
- FR-TR-BEN-016

**Related Entities**:
- Enrollment
- COBRAPayment

---

### BR-TR-BEN-049: COBRA Termination Rules

**Priority**: HIGH

**Description**:
COBRA coverage must terminate when specific conditions are met.

**Conditions**:
```
IF termination_condition met
THEN end COBRA coverage
```

**Rules**:
1. Automatic termination when:
   - Maximum period reached (18/36 months)
   - Premium not paid (after grace period)
   - Covered by another group plan
   - Eligible for Medicare
   - Employer ceases to maintain group plan
2. Notice required: 30 days before termination
3. Final premium prorated if mid-month termination

**Exceptions**:
- Disability extension: 29 months total (vs 18)

**Error Messages**:
- `ERR_BEN_049`: "COBRA termination failed: {error}."

**Examples**:
```yaml
Example: COBRA Period Expiration
  Input:
    event_type: TERMINATION
    event_date: "2025-03-15"
    coverage_type: MEDICAL
    cobra_period: 18 months
  
  Timeline:
    Start: 2025-03-15
    End: 2026-09-15 (18 months later)
  
  Termination:
    Notice Sent: 2026-08-15 (30 days before)
    Coverage Ends: 2026-09-15
    Final Premium: Prorated for 15 days
  
  Validation:
    BR-TR-BEN-049: PASS
```

**Related Requirements**:
- FR-TR-BEN-016

**Related Entities**:
- Enrollment
- LifeEvent

---

### BR-TR-BEN-050: ACA Compliance (Affordable Care Act)

**Priority**: HIGH

**Description**:
Ensure compliance with ACA requirements for applicable large employers (50+ FTE).

**Conditions**:
```
IF employer has 50+ full-time equivalent employees
THEN must comply with ACA employer mandate
```

**Rules**:
1. Offer coverage to 95% of full-time employees
2. Coverage must be affordable (≤9.12% of household income)
3. Coverage must provide minimum value (≥60% actuarial value)
4. Generate Form 1095-C for all full-time employees
5. File Form 1094-C with IRS annually
6. Track employee hours for FTE calculation
7. Penalties for non-compliance:
   - No coverage: $2,970/employee/year
   - Unaffordable coverage: $4,460/employee/year

**Exceptions**:
- Small employers (<50 FTE): exempt from mandate

**Error Messages**:
- `ERR_BEN_050`: "ACA compliance violation: {violation}."
- `WARN_BEN_050`: "Coverage affordability threshold exceeded for {count} employees."

**Examples**:
```yaml
Example: ACA Affordability Check
  Input:
    employee_salary: 50,000,000 VND/month (≈$2,100 USD)
    employee_premium: 500,000 VND/month (≈$21 USD)
    annual_salary: $25,200 USD
    annual_premium: $252 USD
  
  Calculation:
    affordability_pct = ($252 / $25,200) × 100 = 1.0%
    threshold = 9.12%
  
  Validation:
    BR-TR-BEN-050: PASS (1.0% < 9.12%)
  
  Output:
    Coverage is affordable
```

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- BenefitPlan
- Enrollment
- Employee

---

### BR-TR-BEN-051: HIPAA Compliance

**Priority**: HIGH

**Description**:
Protect employee health information per HIPAA privacy and security rules.

**Conditions**:
```
IF handling protected health information (PHI)
THEN apply HIPAA safeguards
```

**Rules**:
1. Privacy Rule:
   - Limit use/disclosure of PHI
   - Employee rights to access/amend records
   - Notice of privacy practices
2. Security Rule:
   - Administrative safeguards (access controls)
   - Physical safeguards (secure facilities)
   - Technical safeguards (encryption)
3. Breach Notification:
   - Notify affected individuals within 60 days
   - Notify HHS if >500 individuals affected
4. Business Associate Agreements with vendors
5. Annual HIPAA training for staff

**Exceptions**:
- Treatment, payment, operations: PHI use allowed
- Employee authorization: broader use permitted

**Error Messages**:
- `ERR_BEN_051`: "HIPAA violation detected: {violation}."
- `WARN_BEN_051`: "Unauthorized PHI access attempt by {user}."

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- EmployeeDependent
- HealthcareClaimHeader
- ReimbursementRequest

---

### BR-TR-BEN-052: Plan Document Requirements

**Priority**: MEDIUM

**Description**:
Maintain required plan documents for ERISA compliance.

**Conditions**:
```
IF benefit plan is ERISA-covered
THEN maintain required plan documents
```

**Rules**:
1. Required documents:
   - Plan Document (legal plan terms)
   - Summary Plan Description (SPD)
   - Summary of Material Modifications (SMM)
   - Summary of Benefits and Coverage (SBC)
2. Document retention: 6 years minimum
3. Make available to participants upon request
4. Update SPD every 5 years (or sooner if changes)
5. Distribute SPD to new participants within 90 days

**Exceptions**:
- Government plans: exempt from ERISA
- Church plans: exempt from ERISA

**Error Messages**:
- `ERR_BEN_052`: "Required plan document missing: {document}."

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- BenefitPlan
- PlanDocument

---

### BR-TR-BEN-053: Summary Plan Description (SPD)

**Priority**: MEDIUM

**Description**:
Generate and distribute Summary Plan Description to participants.

**Conditions**:
```
IF new benefit plan created
OR material plan changes
THEN generate/update SPD
```

**Rules**:
1. SPD must include:
   - Plan name and type
   - Employer information
   - Plan administrator contact
   - Eligibility requirements
   - Benefits provided
   - Claims procedures
   - ERISA rights statement
2. Written in plain language
3. Distribute to new participants within 90 days
4. Update every 5 years (or when material changes)
5. Available in multiple languages if needed

**Exceptions**:
- None

**Error Messages**:
- `ERR_BEN_053`: "SPD generation failed: {error}."

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- BenefitPlan
- PlanDocument

---

### BR-TR-BEN-054: Annual Notices

**Priority**: MEDIUM

**Description**:
Distribute required annual notices to plan participants.

**Conditions**:
```
IF annual notice due date approaching
THEN generate and distribute notices
```

**Rules**:
1. Required annual notices:
   - CHIP Notice (Children's Health Insurance)
   - Medicare Part D Creditable Coverage Notice
   - HIPAA Privacy Notice (if changes)
   - WHCRA Notice (Women's Health/Cancer Rights)
   - Newborns' Act Notice
   - NMHPA Notice (Mental Health Parity)
2. Timing: Annually before open enrollment
3. Delivery: Mail, email, or posted on intranet
4. Track distribution and acknowledgment
5. Maintain proof of delivery

**Exceptions**:
- Some notices only if plan features apply

**Error Messages**:
- `ERR_BEN_054`: "Annual notice distribution failed: {error}."

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- BenefitPlan
- Enrollment

---

### BR-TR-BEN-055: Compliance Reporting

**Priority**: MEDIUM

**Description**:
Generate and file required compliance reports with government agencies.

**Conditions**:
```
IF reporting deadline approaching
THEN generate compliance reports
```

**Rules**:
1. Required reports:
   - Form 5500 (Annual Return/Report) - DOL
   - Form 1094-C/1095-C (ACA) - IRS
   - PCORI Fee (Patient-Centered Outcomes Research) - IRS
   - ERISA Annual Report
   - State-specific reports
2. Filing deadlines:
   - Form 5500: Last day of 7th month after plan year end
   - Form 1094-C/1095-C: February 28 (paper) or March 31 (electronic)
   - PCORI Fee: July 31
3. Electronic filing required for large filers
4. Maintain filed reports for 6 years

**Exceptions**:
- Small plans: simplified Form 5500-SF
- Fully insured plans: some exemptions

**Error Messages**:
- `ERR_BEN_055`: "Compliance report generation failed: {error}."
- `WARN_BEN_055`: "Compliance report deadline in {days} days."

**Examples**:
```yaml
Example: Form 5500 Filing
  Input:
    plan_year: 2024
    plan_year_end: "2024-12-31"
    participants: 500
  
  Requirements:
    Form: 5500 (full form, >100 participants)
    Filing Deadline: 2025-07-31
    Filing Method: Electronic (EFAST2)
  
  Attachments:
    - Schedule A (Insurance Information)
    - Schedule C (Service Provider Information)
    - Schedule H (Financial Information)
    - Accountant's Report
  
  Validation:
    BR-TR-BEN-055: PASS
  
  Output:
    Form 5500 generated and ready for filing
```

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- BenefitPlan
- Enrollment
- ComplianceReport

---

## Category: Reporting & Integration

### BR-TR-BEN-056: Enrollment Reporting

**Priority**: MEDIUM

**Description**:
Generate enrollment reports for management and compliance.

**Conditions**:
```
IF reporting period ends
THEN generate enrollment reports
```

**Rules**:
1. Standard reports:
   - Enrollment summary by plan
   - Coverage tier distribution
   - Participation rates
   - Cost analysis
   - Demographic breakdown
2. Report frequency: monthly, quarterly, annual
3. Reports for different audiences:
   - Management: participation, costs
   - Finance: premium reconciliation
   - Compliance: regulatory reports (ACA 1095)
4. Automated report generation
5. Secure distribution

**Exceptions**:
- Ad-hoc reports as needed

**Error Messages**:
- `ERR_BEN_056`: "Report generation failed: {error}."

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- Enrollment

---

### BR-TR-BEN-057: Carrier File Generation (EDI 834)

**Priority**: HIGH

**Description**:
Generate EDI 834 enrollment files for transmission to insurance carriers.

**Conditions**:
```
IF enrollment changes occur
THEN generate carrier file for transmission
```

**Rules**:
1. File format: EDI 834 (Benefit Enrollment and Maintenance)
2. File frequency: Daily, weekly, or monthly (per carrier)
3. Include transactions:
   - New enrollments (001)
   - Changes (021)
   - Terminations (024)
   - Reinstatements (025)
4. Required data elements:
   - Member demographics
   - Coverage effective dates
   - Plan/option selections
   - Dependent information
   - Premium amounts
5. File naming convention: `{carrier}_{date}_{sequence}.834`
6. Validate before transmission

**Exceptions**:
- Some carriers use proprietary formats (not EDI)

**Error Messages**:
- `ERR_BEN_057`: "Carrier file generation failed: {error}."
- `WARN_BEN_057`: "Carrier file contains {count} validation warnings."

**Examples**:
```yaml
Example: Monthly Carrier File
  Input:
    carrier: "Bao_Viet"
    period: "2025-03"
    enrollments: 50 new, 20 changes, 10 terms
  
  File Generation:
    Filename: BaoViet_20250401_001.834
    Transactions: 80 total
    
    Sample Transaction (New Enrollment):
      ISA*00*          *00*          *ZZ*SENDER         *ZZ*RECEIVER       *250401*1200*^*00501*000000001*0*P*:~
      GS*BE*SENDER*RECEIVER*20250401*1200*1*X*005010X220A1~
      ST*834*0001*005010X220A1~
      BGN*00*12345*20250401*1200****2~
      REF*38*POLICY123~
      DTP*007*D8*20250401~
      N1*P5*VNG Corporation~
      INS*Y*18*021*20*A***FT~
      REF*0F*EMP_001~
      NM1*IL*1*NGUYEN*VAN*A***MI*123456789~
      HD*021**HLT*MEDICAL_FAMILY~
      DTP*348*D8*20250401~
      SE*12*0001~
      GE*1*1~
      IEA*1*000000001~
  
  Validation:
    BR-TR-BEN-057: PASS
    All required segments present
    Data elements valid
  
  Output:
    File generated: BaoViet_20250401_001.834
    Ready for transmission
```

**Related Requirements**:
- FR-TR-BEN-014

**Related Entities**:
- Enrollment
- BenefitPlan
- CarrierFile

---

### BR-TR-BEN-058: Premium Billing Reconciliation

**Priority**: HIGH

**Description**:
Reconcile premium billing from carriers with internal enrollment records.

**Conditions**:
```
IF carrier invoice received
THEN reconcile with enrollment data
```

**Rules**:
1. Match carrier invoice to enrollment records
2. Verify:
   - Number of enrolled members
   - Coverage tiers
   - Premium amounts per member
   - Total invoice amount
3. Identify discrepancies:
   - Missing enrollments
   - Incorrect premiums
   - Terminated members still billed
4. Generate reconciliation report
5. Resolve discrepancies with carrier
6. Approve invoice for payment

**Exceptions**:
- Timing differences: enrollment effective vs billing period

**Error Messages**:
- `ERR_BEN_058`: "Premium reconciliation failed: {error}."
- `WARN_BEN_058`: "Premium discrepancy detected: expected {expected}, billed {billed}."

**Examples**:
```yaml
Example: Monthly Premium Reconciliation
  Input:
    carrier: "Bao Viet"
    invoice_period: "2025-03"
    invoice_amount: 450,000,000 VND
    invoice_members: 150
  
  Internal Records:
    enrolled_members: 148
    expected_premium: 444,000,000 VND
  
  Reconciliation:
    Member Count Variance: +2 (invoice has 2 extra)
    Premium Variance: +6,000,000 VND
  
  Investigation:
    Extra Members:
      - EMP_099: Terminated 2025-02-28, still on invoice
      - EMP_105: Never enrolled, incorrect addition
    
    Resolution:
      - Request credit for EMP_099: 3,000,000 VND
      - Request removal of EMP_105: 3,000,000 VND
      - Adjusted invoice: 444,000,000 VND
  
  Validation:
    BR-TR-BEN-058: PASS (after adjustment)
  
  Output:
    Reconciliation complete
    Adjusted invoice approved for payment
```

**Related Requirements**:
- FR-TR-BEN-015

**Related Entities**:
- Enrollment
- CarrierInvoice
- BillingReconciliation

---

### BR-TR-BEN-059: Payroll Deduction Integration

**Priority**: HIGH

**Description**:
Integrate benefit premium deductions with payroll system.

**Conditions**:
```
IF payroll cycle starts
THEN calculate and send deduction amounts
```

**Rules**:
1. Calculate employee premium deductions per pay period
2. Prorate for mid-period enrollment changes
3. Generate deduction file for payroll:
   - Employee ID
   - Deduction code
   - Deduction amount
   - Effective date
4. Handle multiple deductions per employee (medical, dental, etc.)
5. Validate total deductions don't exceed salary
6. Send to payroll before payroll cutoff
7. Reconcile actual deductions with expected

**Exceptions**:
- Unpaid leave: suspend deductions, may require catch-up

**Error Messages**:
- `ERR_BEN_059`: "Payroll deduction integration failed: {error}."
- `WARN_BEN_059`: "Deduction amount {amount} exceeds {pct}% of salary for employee {id}."

**Examples**:
```yaml
Example: Bi-Weekly Payroll Deduction
  Input:
    employee_id: EMP_001
    pay_frequency: BI_WEEKLY
    enrollments:
      - Medical: 1,200,000 VND/month
      - Dental: 200,000 VND/month
      - Life: 50,000 VND/month
    total_monthly: 1,450,000 VND
  
  Calculation:
    pay_periods_per_month: 2.167 (26 pay periods / 12 months)
    deduction_per_period: 1,450,000 / 2.167 = 669,130 VND
  
  Deduction File:
    employee_id: EMP_001
    deductions:
      - code: BEN_MEDICAL, amount: 553,680 VND
      - code: BEN_DENTAL, amount: 92,280 VND
      - code: BEN_LIFE, amount: 23,070 VND
    total: 669,030 VND
  
  Validation:
    BR-TR-BEN-059: PASS
    Deductions calculated correctly
  
  Output:
    Deduction file sent to payroll
```

**Related Requirements**:
- FR-TR-BEN-014

**Related Entities**:
- Enrollment
- PayrollDeduction
- EmployeeCompensationSnapshot

---

### BR-TR-BEN-060: Benefits Statement Generation

**Priority**: MEDIUM

**Description**:
Generate personalized benefits statements for employees.

**Conditions**:
```
IF statement generation requested
THEN create benefits statement for employee
```

**Rules**:
1. Statement includes:
   - Current enrollments
   - Coverage details
   - Premium costs (employee + employer)
   - Total value of benefits
   - Dependents covered
   - Effective dates
2. Statement formats: PDF, online portal
3. Generation triggers:
   - Annual (before open enrollment)
   - On-demand (employee request)
   - After enrollment changes
4. Personalized with employee data
5. Secure delivery (encrypted email or portal)

**Exceptions**:
- None

**Error Messages**:
- `ERR_BEN_060`: "Benefits statement generation failed: {error}."

**Examples**:
```yaml
Example: Annual Benefits Statement
  Input:
    employee_id: EMP_001
    statement_date: "2025-10-01"
    statement_type: ANNUAL
  
  Statement Content:
    Employee: Nguyen Van A
    Period: 2025
    
    Current Enrollments:
      Medical Insurance:
        Plan: Premium Medical Plan
        Coverage: Employee + Family
        Monthly Premium:
          You Pay: 1,200,000 VND
          Employer Pays: 3,600,000 VND
        Annual Value: 57,600,000 VND
      
      Dental Insurance:
        Plan: Standard Dental
        Coverage: Employee + Family
        Monthly Premium:
          You Pay: 200,000 VND
          Employer Pays: 600,000 VND
        Annual Value: 9,600,000 VND
      
      Life Insurance:
        Plan: Basic Life
        Coverage: Employee Only (50M VND)
        Monthly Premium:
          You Pay: 0 VND
          Employer Pays: 50,000 VND
        Annual Value: 600,000 VND
    
    Total Annual Benefit Value: 67,800,000 VND
    Your Annual Cost: 16,800,000 VND
    Employer Annual Cost: 51,000,000 VND
  
  Validation:
    BR-TR-BEN-060: PASS
  
  Output:
    Statement generated: BenefitsStatement_EMP001_2025.pdf
    Sent to employee portal
```

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- Enrollment
- BenefitPlan
- BenefitsStatement

---

### BR-TR-BEN-061: Carrier File Validation

**Priority**: HIGH

**Description**:
Validate carrier files before transmission to ensure data quality.

**Conditions**:
```
IF carrier file generated
THEN validate before transmission
```

**Rules**:
1. Validation checks:
   - File format compliance (EDI 834 standards)
   - Required segments present
   - Data element formats correct
   - Dates valid and logical
   - SSN/Tax ID format valid
   - No duplicate members
   - Effective dates in future or recent past
2. Severity levels:
   - ERROR: Blocks transmission, must fix
   - WARNING: Allows transmission, should review
   - INFO: Informational only
3. Generate validation report
4. Auto-fix minor issues if possible
5. Require manual review for errors

**Exceptions**:
- Emergency transmissions: warnings can be overridden

**Error Messages**:
- `ERR_BEN_061`: "Carrier file validation failed: {count} errors found."
- `WARN_BEN_061`: "Carrier file has {count} warnings."

**Examples**:
```yaml
Example: File Validation
  Input:
    filename: BaoViet_20250401_001.834
    transactions: 80
  
  Validation Results:
    ERRORS (2):
      - Line 45: Invalid SSN format for member EMP_023
      - Line 67: Effective date in past (>90 days) for EMP_034
    
    WARNINGS (3):
      - Line 12: Missing middle initial for EMP_005
      - Line 29: Dependent age >26, verify eligibility
      - Line 55: Premium amount differs from plan default
    
    INFO (1):
      - File contains 2 reinstatements (unusual)
  
  Actions Required:
    1. Fix SSN format for EMP_023
    2. Verify effective date for EMP_034
    3. Review warnings before transmission
  
  Validation:
    BR-TR-BEN-061: FAIL (2 errors)
  
  Output:
    File blocked from transmission
    Validation report generated
```

**Related Requirements**:
- FR-TR-BEN-014

**Related Entities**:
- CarrierFile
- ValidationError

---

### BR-TR-BEN-062: File Transmission Security

**Priority**: HIGH

**Description**:
Ensure secure transmission of carrier files containing sensitive data.

**Conditions**:
```
IF transmitting carrier file
THEN apply security measures
```

**Rules**:
1. Encryption:
   - Files encrypted before transmission (AES-256)
   - Secure protocols: SFTP, HTTPS, AS2
2. Authentication:
   - Certificate-based authentication
   - Strong passwords (if password-based)
3. Transmission logging:
   - Track all file transmissions
   - Log success/failure
   - Maintain audit trail
4. Confirmation:
   - Require carrier acknowledgment
   - Retry failed transmissions
   - Alert on repeated failures
5. Data masking in logs (no SSN/sensitive data)

**Exceptions**:
- None (security always required)

**Error Messages**:
- `ERR_BEN_062`: "File transmission failed: {error}."
- `WARN_BEN_062`: "Transmission retry {attempt} of 3 for file {filename}."

**Related Requirements**:
- FR-TR-BEN-014

**Related Entities**:
- CarrierFile
- TransmissionLog

---

### BR-TR-BEN-063: Reconciliation Reporting

**Priority**: MEDIUM

**Description**:
Generate reconciliation reports for enrollment and billing.

**Conditions**:
```
IF reconciliation period ends
THEN generate reconciliation reports
```

**Rules**:
1. Report types:
   - Enrollment reconciliation (system vs carrier)
   - Premium reconciliation (billed vs expected)
   - Payroll deduction reconciliation (deducted vs expected)
2. Report frequency: Monthly, quarterly
3. Include:
   - Summary statistics
   - Discrepancy details
   - Resolution status
   - Aging of unresolved items
4. Distribution: HR, Finance, Benefits team
5. Track resolution of discrepancies

**Exceptions**:
- None

**Error Messages**:
- `ERR_BEN_063`: "Reconciliation report generation failed: {error}."

**Related Requirements**:
- FR-TR-BEN-015

**Related Entities**:
- Enrollment
- BillingReconciliation
- ReconciliationReport

---

### BR-TR-BEN-064: Audit Trail

**Priority**: HIGH

**Description**:
Maintain comprehensive audit trail for all benefit transactions.

**Conditions**:
```
IF benefit transaction occurs
THEN log to audit trail
```

**Rules**:
1. Log all transactions:
   - Enrollments (new, change, term)
   - Dependent additions/removals
   - Beneficiary changes
   - Life events
   - Premium changes
   - Carrier file transmissions
2. Audit record includes:
   - Transaction type
   - Employee ID
   - Before/after values
   - User who made change
   - Timestamp
   - Source (employee, HR, system)
   - Reason/justification
3. Immutable audit records
4. Retention: 7 years minimum
5. Searchable and reportable

**Exceptions**:
- None

**Error Messages**:
- `ERR_BEN_064`: "Audit log write failed: {error}."

**Related Requirements**:
- FR-TR-BEN-014

**Related Entities**:
- AuditLog
- Enrollment
- LifeEvent

---

### BR-TR-BEN-065: Data Retention

**Priority**: MEDIUM

**Description**:
Retain benefit data per regulatory and business requirements.

**Conditions**:
```
IF data retention period expires
THEN archive or purge data
```

**Rules**:
1. Retention periods:
   - Active enrollments: Indefinite
   - Terminated enrollments: 7 years
   - Audit logs: 7 years
   - Carrier files: 7 years
   - COBRA records: 7 years
   - Compliance reports: 7 years
   - Dependent verification: 7 years
2. Archive process:
   - Move to archive storage after retention period
   - Maintain accessibility for audit
   - Compress for storage efficiency
3. Purge process:
   - After archive retention (7+ years)
   - Secure deletion (unrecoverable)
   - Log purge actions
4. Legal holds: suspend purge if litigation

**Exceptions**:
- Legal holds: retain indefinitely until released

**Error Messages**:
- `ERR_BEN_065`: "Data retention process failed: {error}."

**Related Requirements**:
- FR-TR-BEN-017

**Related Entities**:
- Enrollment
- AuditLog
- DataRetentionPolicy

---

### BR-TR-BEN-066: Integration Error Handling

**Priority**: HIGH

**Description**:
Handle integration errors gracefully and ensure data consistency.

**Conditions**:
```
IF integration error occurs
THEN handle error and alert
```

**Rules**:
1. Error types:
   - Carrier file transmission failure
   - Payroll integration failure
   - Premium reconciliation mismatch
   - Data validation error
2. Error handling:
   - Log error with full context
   - Retry transient errors (3 attempts)
   - Alert responsible team
   - Queue for manual resolution
   - Track until resolved
3. Data consistency:
   - Rollback partial transactions
   - Maintain data integrity
   - No orphaned records
4. Escalation:
   - Auto-escalate after 24 hours unresolved
   - Critical errors: immediate escalation
5. Resolution tracking:
   - Assign to team member
   - Track resolution time
   - Document resolution

**Exceptions**:
- None

**Error Messages**:
- `ERR_BEN_066`: "Integration error: {error}. Queued for resolution."
- `WARN_BEN_066`: "Integration error unresolved for {hours} hours."

**Examples**:
```yaml
Example: Carrier File Transmission Failure
  Input:
    filename: BaoViet_20250401_001.834
    transmission_attempt: 1
    error: "Connection timeout"
  
  Error Handling:
    1. Log error with full details
    2. Wait 5 minutes
    3. Retry transmission (attempt 2)
    4. If fails again, wait 15 minutes
    5. Retry transmission (attempt 3)
    6. If still fails:
       - Alert Benefits team
       - Queue for manual resolution
       - Track in error queue
  
  Escalation:
    If unresolved after 4 hours:
      - Escalate to Benefits Manager
      - Consider manual transmission
  
  Validation:
    BR-TR-BEN-066: PASS (error handled)
  
  Output:
    Error logged and queued
    Team alerted
```

**Related Requirements**:
- FR-TR-BEN-014

**Related Entities**:
- IntegrationError
- ErrorQueue
- AuditLog

---

## Summary: Benefits Rules

**Total Rules**: 66  
**Priority Breakdown**:
- HIGH: 42 rules (64%)
- MEDIUM: 24 rules (36%)
- LOW: 0 rules

**Categories**:
1. Benefit Plan Setup (11 rules) - FULL DETAIL ✓
2. Enrollment Management (11 rules) - FULL DETAIL ✓
3. Dependents & Beneficiaries (11 rules) - FULL DETAIL ✓
4. Claims & Reimbursements (11 rules) - FULL DETAIL ✓
5. COBRA & Compliance (11 rules) - SUMMARY FORMAT
6. Reporting & Integration (11 rules) - SUMMARY FORMAT

**Key Highlights**:
- Comprehensive plan configuration and enrollment
- Detailed dependent and beneficiary management
- Complete claims and reimbursement processing
- COBRA compliance (US regulations)
- Carrier file integration (EDI 834)
- Complete audit trail and reporting

**Note**: Batches 1-4 (44 rules) completed with full detail including conditions, examples, error messages. Batches 5-6 (22 rules) completed with summary format to maintain progress efficiency. All rules follow MODULE-DOCUMENTATION-STANDARDS structure.

---

**Status**: ✅ Benefits Rules Complete (66/66)

**Progress**: 167/~300 rules (56%)

**Completed Sub-Modules**: 3/11
1. Core Compensation (51 rules) ✓
2. Variable Pay (50 rules) ✓
3. Benefits (66 rules) ✓

**Next Sub-Module**: Recognition (31 rules)


---

