# 6. TR Statement Rules

## Category: Statement Generation & Content

### BR-TR-STMT-001: Statement Generation Trigger

**Priority**: MEDIUM

**Description**:
Define triggers for TR statement generation.

**Conditions**:
```
IF trigger event occurs
THEN generate TR statement
```

**Rules**:
1. Generation triggers:
   - Annual: once per year (typically Q1)
   - On-demand: employee request
   - Life event: major compensation change
   - Manager request: for team members
2. Scheduled generation: batch process
3. On-demand: real-time generation
4. Statement reflects data as of generation date
5. Historical statements archived

**Exceptions**:
- New hires: statement after 90 days

**Error Messages**:
- `ERR_STMT_001`: "Statement generation failed: {reason}."

**Related Requirements**:
- FR-TR-STMT-001

**Related Entities**:
- TotalRewardsStatement

---

### BR-TR-STMT-002: Statement Content Components

**Priority**: HIGH

**Description**:
Define required and optional components for TR statement.

**Conditions**:
```
IF generating statement
THEN include required components
AND optional components per configuration
```

**Rules**:
1. Required components:
   - Base compensation
   - Variable pay (actual + target)
   - Benefits value
   - Total compensation summary
2. Optional components:
   - Equity holdings and value
   - Retirement contributions
   - Perks and allowances
   - Career development investments
   - Work-life balance benefits
3. Components configurable per company
4. Year-over-year comparison
5. Personalized messaging

**Exceptions**:
- Executive statements may have additional components

**Error Messages**:
- `ERR_STMT_002`: "Statement missing required component: {component}."

**Examples**:
```yaml
Example: TR statement components
  Input:
    employee: John Doe
    period: 2024
    
  Components:
    Base Compensation:
      - Base Salary: 100M VND
      - Allowances: 10M VND
      - Total: 110M VND
    
    Variable Pay:
      - STI Target: 15M VND
      - STI Actual: 18M VND
      - Equity Value (vested): 50M VND
      - Total: 68M VND
    
    Benefits:
      - Health Insurance: 30M VND
      - Retirement: 12M VND
      - Other: 8M VND
      - Total: 50M VND
    
    Total Rewards: 228M VND
  
  Validation:
    BR-STMT-002: PASS
  
  Output:
    Statement generated with all components
```

**Related Requirements**:
- FR-TR-STMT-002

**Related Entities**:
- TotalRewardsStatement

---

### BR-TR-STMT-003: Statement Template Selection

**Priority**: MEDIUM

**Description**:
Select appropriate statement template based on employee level and configuration.

**Conditions**:
```
IF generating statement
THEN select template based on employee level
```

**Rules**:
1. Template types: Standard, Executive, Manager, Contractor
2. Selection criteria: Job level, employment type, location
3. Templates define layout, sections, and branding
4. Custom templates allowed for special cases
5. Template must be active and approved

**Exceptions**:
- HR can override template selection

**Error Messages**:
- `ERR_STMT_003`: "No active template found for employee level {level}."

**Related Requirements**: FR-TR-STMT-003

**Related Entities**: StatementTemplate, TotalRewardsStatement

---

### BR-TR-STMT-004: Branding and Customization

**Priority**: LOW

**Description**:
Apply company branding and customization to statements.

**Conditions**:
```
WHEN generating statement
THEN apply branding configuration
```

**Rules**:
1. Branding elements: Logo, colors, fonts, header/footer
2. Customizable per legal entity or business unit
3. Branding must meet accessibility standards
4. PDF watermark for draft statements
5. Final statements include company seal/signature

**Exceptions**:
- None

**Error Messages**:
- `WARN_STMT_004`: "Branding assets missing for {entity}."

**Related Requirements**: FR-TR-STMT-003

**Related Entities**: StatementTemplate, LegalEntity

---

### BR-TR-STMT-005: Multi-Currency Support

**Priority**: HIGH

**Description**:
Support multiple currencies for global employees.

**Conditions**:
```
IF employee has compensation in multiple currencies
THEN display all currencies with conversion
```

**Rules**:
1. Display amounts in original currency
2. Provide converted total in employee's home currency
3. Exchange rates: as of statement generation date
4. Clearly indicate exchange rate and date used
5. Support major currencies: VND, USD, EUR, SGD, etc.

**Exceptions**:
- None

**Error Messages**:
- `ERR_STMT_005`: "Exchange rate not available for {currency} on {date}."

**Related Requirements**: FR-TR-STMT-004

**Related Entities**: TotalRewardsStatement, Currency

---

### BR-TR-STMT-006: Language Localization

**Priority**: MEDIUM

**Description**:
Generate statements in employee's preferred language.

**Conditions**:
```
WHEN generating statement
THEN use employee's preferred language
```

**Rules**:
1. Supported languages: Vietnamese, English, others per configuration
2. Language preference from employee profile
3. All text, labels, and descriptions localized
4. Numbers and dates formatted per locale
5. Fallback to English if preferred language unavailable

**Exceptions**:
- None

**Error Messages**:
- `WARN_STMT_006`: "Language {language} not available, using English."

**Related Requirements**: FR-TR-STMT-004

**Related Entities**: TotalRewardsStatement, Employee

---

### BR-TR-STMT-007: Component Visibility Rules

**Priority**: MEDIUM

**Description**:
Control which components are visible in statement based on configuration.

**Conditions**:
```
IF component configured as hidden
THEN exclude from statement
```

**Rules**:
1. Configurable components: Equity, Retirement, Perks, Time Off, etc.
2. Visibility rules per employee level or location
3. Zero-value components can be hidden or shown
4. Sensitive components (equity) require additional permissions
5. At least base compensation and total must be visible

**Exceptions**:
- None

**Error Messages**:
- `ERR_STMT_007`: "Statement must include at least base compensation."

**Related Requirements**: FR-TR-STMT-002

**Related Entities**: StatementTemplate, StatementComponent

---

### BR-TR-STMT-008: Benefits Valuation Method

**Priority**: HIGH

**Description**:
Calculate benefits value using employer portion only.

**Conditions**:
```
WHEN calculating benefits value
THEN use employer portion of premium/cost
```

**Rules**:
1. Benefits value = Employer portion only (not employee portion)
2. Include: Health, dental, vision, life, disability insurance
3. Retirement: Employer match amount
4. Exclude: Employee contributions
5. Use annual cost (monthly × 12)

**Exceptions**:
- None

**Error Messages**:
- `ERR_STMT_008`: "Benefits valuation failed: {reason}."

**Related Requirements**: FR-TR-STMT-005

**Related Entities**: BenefitEnrollment, BenefitPlan

---

### BR-TR-STMT-009: Equity Valuation

**Priority**: HIGH

**Description**:
Calculate equity value based on vested shares and current FMV.

**Conditions**:
```
equity_value = vested_shares × fair_market_value
```

**Rules**:
1. Use vested shares as of statement date
2. FMV: Most recent valuation or stock price
3. Include RSUs, stock options (in-the-money value)
4. Show gross value before taxes
5. Indicate valuation date

**Exceptions**:
- Private companies: Use latest 409A valuation

**Error Messages**:
- `ERR_STMT_009`: "FMV not available for equity valuation."

**Related Requirements**: FR-TR-STMT-005

**Related Entities**: EquityGrant, EquityVestingEvent

---

### BR-TR-STMT-010: Total Compensation Calculation

**Priority**: HIGH

**Description**:
Calculate total compensation as sum of all components.

**Conditions**:
```
total_compensation = base + variable + benefits + perks + time_off_value
```

**Rules**:
1. Sum all visible components
2. Exclude one-time payments unless in statement period
3. Annualize all amounts (monthly × 12)
4. Round to nearest whole currency unit
5. Validate total = sum of components

**Exceptions**:
- None

**Error Messages**:
- `ERR_STMT_010`: "Total compensation mismatch: calculated {calc} vs expected {exp}."

**Related Requirements**: FR-TR-STMT-005

**Related Entities**: TotalRewardsStatement

---

### BR-TR-STMT-011: Year-over-Year Comparison

**Priority**: MEDIUM

**Description**:
Compare current year total compensation to previous year.

**Conditions**:
```
IF previous year statement exists
THEN calculate and display YoY change
```

**Rules**:
1. Calculate: (Current - Previous) / Previous × 100
2. Display as percentage and absolute amount
3. Highlight significant changes (>10%)
4. Explain major changes (promotion, equity vesting, etc.)
5. Show trend indicator (↑ ↓ →)

**Exceptions**:
- New hires: No comparison available

**Error Messages**:
- None

**Related Requirements**: FR-TR-STMT-006

**Related Entities**: TotalRewardsStatement

---

### BR-TR-STMT-012: Personalized Messaging

**Priority**: LOW

**Description**:
Include personalized messages in statement.

**Conditions**:
```
WHEN generating statement
THEN include personalized content
```

**Rules**:
1. Greeting with employee name
2. Highlights: Promotions, awards, milestones
3. Thank you message from CEO or manager
4. Upcoming benefits enrollment reminders
5. Career development opportunities

**Exceptions**:
- None

**Error Messages**:
- None

**Related Requirements**: FR-TR-STMT-007

**Related Entities**: TotalRewardsStatement, Employee

---

### BR-TR-STMT-013: Manager Commentary

**Priority**: LOW

**Description**:
Allow managers to add personalized comments to team member statements.

**Conditions**:
```
IF manager provides commentary
THEN include in statement
```

**Rules**:
1. Manager can add optional comment (max 500 characters)
2. Comment reviewed by HR before inclusion
3. Comment must be professional and positive
4. Manager cannot see compensation details
5. Comment appears in personalized section

**Exceptions**:
- None

**Error Messages**:
- `WARN_STMT_013`: "Manager comment exceeds 500 characters."

**Related Requirements**: FR-TR-STMT-007

**Related Entities**: TotalRewardsStatement, Manager

---

### BR-TR-STMT-014: Career Path Visualization

**Priority**: LOW

**Description**:
Show career progression and potential future compensation.

**Conditions**:
```
IF career path defined for employee
THEN show progression visualization
```

**Rules**:
1. Display current level and next level
2. Show typical compensation range for next level
3. Indicate skills/experience needed for progression
4. Estimated timeline to next level
5. Optional: Show 3-5 year career trajectory

**Exceptions**:
- Executives: Career path may not be defined

**Error Messages**:
- None

**Related Requirements**: FR-TR-STMT-007

**Related Entities**: CareerPath, JobLevel

---

### BR-TR-STMT-015: Statement Distribution Methods

**Priority**: HIGH

**Description**:
Define approved methods for distributing statements to employees.

**Conditions**:
```
WHEN statement generated
THEN distribute via approved channels
```

**Rules**:
1. Distribution methods: Email (PDF), Portal download, Printed
2. Email: Secure attachment, password-protected optional
3. Portal: Accessible via employee self-service
4. Printed: For special events or executive presentations
5. Track distribution status (sent, viewed, downloaded)

**Exceptions**:
- None

**Error Messages**:
- `ERR_STMT_015`: "Statement distribution failed: {reason}."

**Related Requirements**: FR-TR-STMT-008

**Related Entities**: TotalRewardsStatement, StatementDistribution

---

### BR-TR-STMT-016: Employee Portal Access

**Priority**: HIGH

**Description**:
Employees can access current and historical statements via portal.

**Conditions**:
```
WHEN employee logs into portal
THEN display available statements
```

**Rules**:
1. Show all statements for employee (current + historical)
2. Statements sorted by date (newest first)
3. Download as PDF
4. View online (web version)
5. Print-friendly format
6. Access requires authentication

**Exceptions**:
- None

**Error Messages**:
- `ERR_STMT_016`: "Statement access denied: {reason}."

**Related Requirements**: FR-TR-STMT-009

**Related Entities**: TotalRewardsStatement, Employee

---

### BR-TR-STMT-017: Statement Versioning

**Priority**: MEDIUM

**Description**:
Track statement versions and corrections.

**Conditions**:
```
IF statement needs correction
THEN create new version
```

**Rules**:
1. Each statement has version number (v1, v2, etc.)
2. Corrections create new version, mark previous as superseded
3. Version history maintained
4. Employees notified of corrections
5. Latest version always displayed

**Exceptions**:
- None

**Error Messages**:
- None

**Related Requirements**: FR-TR-STMT-010

**Related Entities**: TotalRewardsStatement, StatementVersion

---

### BR-TR-STMT-018: Batch Generation Rules

**Priority**: MEDIUM

**Description**:
Rules for batch generating statements for multiple employees.

**Conditions**:
```
WHEN batch generating statements
THEN process in batches with validation
```

**Rules**:
1. Batch size: Max 500 employees per batch
2. Validate data completeness before generation
3. Skip employees with missing data, log errors
4. Generate in background job
5. Notify HR when batch complete
6. Provide error report for failed statements

**Exceptions**:
- None

**Error Messages**:
- `ERR_STMT_018`: "Batch generation failed for {count} employees."

**Related Requirements**: FR-TR-STMT-011

**Related Entities**: TotalRewardsStatement, BatchJob

---

### BR-TR-STMT-019: Data Privacy and Confidentiality

**Priority**: HIGH

**Description**:
Protect confidential compensation data in statements.

**Conditions**:
```
WHEN handling statements
THEN enforce data privacy rules
```

**Rules**:
1. Statements are confidential to employee only
2. Managers cannot view team member statements
3. HR can view for support purposes only
4. Access logged for audit
5. Statements encrypted at rest and in transit
6. Auto-delete from email after 90 days (portal remains)

**Exceptions**:
- Legal/compliance: Access with documented reason

**Error Messages**:
- `ERR_STMT_019`: "Unauthorized access to statement {id}."

**Related Requirements**: FR-TR-STMT-012

**Related Entities**: TotalRewardsStatement, AuditLog

---

### BR-TR-STMT-020: Statement Retention Policy

**Priority**: MEDIUM

**Description**:
Define retention period for statements.

**Conditions**:
```
WHEN statement older than retention period
THEN archive or delete per policy
```

**Rules**:
1. Retention period: 7 years (default)
2. Active employees: All statements retained
3. Terminated employees: Retain per legal requirements
4. Archived statements: Read-only, no modifications
5. Deletion requires approval

**Exceptions**:
- Legal hold: Retain indefinitely

**Error Messages**:
- None

**Related Requirements**: FR-TR-STMT-013

**Related Entities**: TotalRewardsStatement, RetentionPolicy

---

### BR-TR-STMT-021: Statement Correction Process

**Priority**: HIGH

**Description**:
Process for correcting errors in generated statements.

**Conditions**:
```
IF error found in statement
THEN follow correction process
```

**Rules**:
1. HR identifies error and documents issue
2. Correction approved by compensation team
3. New version generated with corrections
4. Employee notified of correction
5. Original statement marked as superseded
6. Correction reason documented

**Exceptions**:
- Minor formatting errors: No new version needed

**Error Messages**:
- None

**Related Requirements**: FR-TR-STMT-014

**Related Entities**: TotalRewardsStatement, StatementCorrection

---

### BR-TR-STMT-022: Statement Audit Trail

**Priority**: HIGH

**Description**:
Maintain complete audit trail for statement lifecycle.

**Conditions**:
```
WHEN statement activity occurs
THEN log to audit trail
```

**Rules**:
1. Log events: Generation, Distribution, Access, Correction, Deletion
2. Audit record: User, Timestamp, Action, IP address
3. Immutable audit logs
4. Retention: Same as statement (7 years)
5. Searchable and reportable

**Exceptions**:
- None

**Error Messages**:
- `ERR_STMT_022`: "Audit log write failed: {reason}."

**Related Requirements**: FR-TR-STMT-015

**Related Entities**: AuditLog, TotalRewardsStatement

---

