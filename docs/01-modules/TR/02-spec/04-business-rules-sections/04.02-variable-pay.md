# 2. Variable Pay Rules

## Category: Bonus Plan Setup


---

# 2. Variable Pay Rules

## Category: Bonus Plan Setup

### BR-TR-VAR-001: Bonus Plan Code Uniqueness

**Priority**: HIGH

**Description**:
Each bonus plan must have a unique code within the legal entity.

**Conditions**:
```
IF creating BonusPlan
AND code exists in same legal entity
THEN reject
```

**Rules**:
1. Code unique per legal entity
2. Format: uppercase with underscores
3. Maximum 50 characters
4. Cannot be changed once created
5. Descriptive naming convention (e.g., STI_2025, LTI_2025_2027)

**Exceptions**:
- None

**Error Messages**:
- `ERR_VAR_001`: "Bonus plan code '{code}' already exists in legal entity '{entity}'."

**Related Requirements**:
- FR-TR-VAR-001

**Related Entities**:
- BonusPlan

---

### BR-TR-VAR-002: Bonus Plan Type Validation

**Priority**: HIGH

**Description**:
Bonus plan type determines calculation rules and payout timing.

**Conditions**:
```
IF creating BonusPlan
THEN type must be valid
```

**Rules**:
1. Valid types:
   - STI (Short-Term Incentive): annual performance bonus
   - LTI (Long-Term Incentive): multi-year performance bonus
   - RETENTION: retention bonus with cliff
   - SIGN_ON: signing bonus for new hires
   - SPOT: discretionary spot bonus
   - PROJECT: project completion bonus
2. Type determines default calculation rules
3. Type affects tax treatment
4. Cannot change type after cycle created

**Exceptions**:
- Type change requires new plan creation

**Error Messages**:
- `ERR_VAR_002`: "Invalid bonus plan type '{type}'."

**Related Requirements**:
- FR-TR-VAR-001

**Related Entities**:
- BonusPlan

---

### BR-TR-VAR-003: Bonus Target Percentage Validation

**Priority**: HIGH

**Description**:
Bonus target percentage must be reasonable and within policy limits.

**Conditions**:
```
IF defining bonus target
THEN 0% < target <= max_allowed_percentage
```

**Rules**:
1. Target must be positive
2. Typical ranges by level:
   - Individual Contributor: 5-15%
   - Manager: 10-20%
   - Director: 15-30%
   - VP: 20-40%
   - Executive: 30-100%+
3. Target as percentage of base salary
4. Maximum configurable per company policy

**Exceptions**:
- Sales roles may have higher targets (50-100%+)
- Executive LTI may exceed 100%

**Error Messages**:
- `ERR_VAR_003`: "Bonus target {percentage}% exceeds maximum allowed {max}%."

**Examples**:
```yaml
Example 1: Manager STI
  Input:
    role_level: Manager
    target_percentage: 15%
    base_salary: 80000000
  
  Calculation:
    target_bonus: 80M × 15% = 12,000,000
  
  Validation:
    BR-TR-VAR-003: PASS (within 10-20% range)
  
  Output:
    Target bonus: 12M VND

Example 2: Executive LTI
  Input:
    role_level: VP
    target_percentage: 50%
    base_salary: 300000000
  
  Calculation:
    target_bonus: 300M × 50% = 150,000,000
  
  Validation:
    BR-TR-VAR-003: PASS (within 20-100% range)
  
  Output:
    Target bonus: 150M VND
```

**Related Requirements**:
- FR-TR-VAR-001

**Related Entities**:
- BonusPlan

---

### BR-TR-VAR-004: Performance Multiplier Range

**Priority**: HIGH

**Description**:
Performance multipliers must be within acceptable range.

**Conditions**:
```
IF defining performance multipliers
THEN 0% <= multiplier <= max_multiplier
```

**Rules**:
1. Minimum multiplier: 0% (no payout for poor performance)
2. Typical range: 0% to 200%
3. Multiplier by performance rating:
   - Does Not Meet: 0%
   - Partially Meets: 50-75%
   - Meets: 100%
   - Exceeds: 125-150%
   - Outstanding: 150-200%
4. Maximum configurable (typically 200%)

**Exceptions**:
- Exceptional performance may exceed 200% with approval

**Error Messages**:
- `ERR_VAR_004`: "Performance multiplier {multiplier}% exceeds maximum {max}%."

**Related Requirements**:
- FR-TR-VAR-001

**Related Entities**:
- BonusPlan

---

## Category: Bonus Cycle Management

### BR-TR-VAR-005: Cycle Period Validation

**Priority**: HIGH

**Description**:
Bonus cycles must have valid periods aligned with plan type.

**Conditions**:
```
IF creating BonusCycle
THEN validate period matches plan type
```

**Rules**:
1. STI: typically 12 months (annual)
2. LTI: typically 36 months (3 years)
3. RETENTION: cliff period (e.g., 12-24 months)
4. Start date < end date
5. No overlapping cycles for same plan
6. Performance period may differ from payout period

**Exceptions**:
- Partial year cycles for new plans

**Error Messages**:
- `ERR_VAR_005`: "Cycle period {start} to {end} invalid for plan type {type}."

**Related Requirements**:
- FR-TR-VAR-002

**Related Entities**:
- BonusCycle

---

### BR-TR-VAR-006: Bonus Pool Calculation

**Priority**: HIGH

**Description**:
Calculate bonus pool based on company/department performance.

**Conditions**:
```
IF calculating bonus pool
THEN pool = target_pool × company_multiplier × funding_percentage
```

**Rules**:
1. Target pool = sum of all employee target bonuses
2. Company multiplier based on financial performance
3. Funding percentage: 0-100% (board approval)
4. Pool allocated to departments/business units
5. Pool cannot be exceeded without approval

**Exceptions**:
- Guaranteed bonuses paid regardless of pool

**Error Messages**:
- `ERR_VAR_006`: "Bonus allocation {amount} exceeds available pool {pool}."

**Examples**:
```yaml
Example: Bonus pool calculation
  Input:
    target_pool: 10000000000 VND (10B)
    company_performance: 120% of target
    company_multiplier: 1.2
    funding_percentage: 100%
  
  Calculation:
    actual_pool: 10B × 1.2 × 100% = 12,000,000,000
  
  Validation:
    BR-TR-VAR-006: PASS
  
  Output:
    Available pool: 12B VND
```

**Related Requirements**:
- FR-TR-VAR-002

**Related Entities**:
- BonusPool
- BonusCycle

---

### BR-TR-VAR-007: Pool Allocation to Departments

**Priority**: HIGH

**Description**:
Allocate bonus pool to departments based on performance and headcount.

**Conditions**:
```
IF allocating pool
THEN sum(department_allocations) <= total_pool
```

**Rules**:
1. Allocation methods:
   - Pro-rata by target bonuses
   - Performance-based weighting
   - Hybrid approach
2. Department performance multiplier applied
3. Total allocations ≤ total pool
4. Reserve pool for adjustments (typically 5-10%)

**Exceptions**:
- Over-allocation requires CFO approval

**Error Messages**:
- `ERR_VAR_007`: "Department allocations {total} exceed pool {pool}."

**Related Requirements**:
- FR-TR-VAR-002

**Related Entities**:
- BonusPool

---

## Category: Bonus Allocation

### BR-TR-VAR-008: Individual Bonus Calculation

**Priority**: HIGH

**Description**:
Calculate individual bonus based on target, performance, and pool availability.

**Conditions**:
```
bonus = base_salary × target_% × performance_multiplier × pool_modifier
```

**Rules**:
1. Base calculation: salary × target %
2. Apply performance multiplier
3. Apply pool modifier (if pool constrained)
4. Minimum payout: 0 (no negative bonuses)
5. Maximum payout: configurable cap

**Exceptions**:
- Guaranteed bonuses ignore pool modifier

**Error Messages**:
- `ERR_VAR_008`: "Calculated bonus {amount} exceeds maximum {max}."

**Examples**:
```yaml
Example: STI bonus calculation
  Input:
    base_salary: 80000000
    target_percentage: 15%
    performance_rating: "Exceeds"
    performance_multiplier: 125%
    pool_modifier: 100% (fully funded)
  
  Calculation:
    target_bonus: 80M × 15% = 12,000,000
    performance_bonus: 12M × 125% = 15,000,000
    final_bonus: 15M × 100% = 15,000,000
  
  Validation:
    BR-TR-VAR-008: PASS
  
  Output:
    Bonus payout: 15M VND
```

**Related Requirements**:
- FR-TR-VAR-003

**Related Entities**:
- BonusAllocation

---

### BR-TR-VAR-009: Proration for Partial Year

**Priority**: HIGH

**Description**:
Prorate bonuses for employees who worked partial year.

**Conditions**:
```
IF employee worked < full year
THEN prorate bonus
```

**Rules**:
1. Proration methods:
   - Months worked / 12
   - Days worked / 365
   - No proration (full bonus if employed on payout date)
2. Method configured per plan
3. New hires: prorate from hire date
4. Terminations: typically no bonus (unless specified)
5. Leave of absence: may or may not prorate

**Exceptions**:
- Retention bonuses typically not prorated
- Guaranteed bonuses may not be prorated

**Error Messages**:
- `ERR_VAR_009`: "Proration method not configured for plan {plan_id}."

**Related Requirements**:
- FR-TR-VAR-003

**Related Entities**:
- BonusAllocation

---

### BR-TR-VAR-010: Bonus Eligibility Rules

**Priority**: HIGH

**Description**:
Determine employee eligibility for bonus payout.

**Conditions**:
```
IF employee eligible
THEN must meet:
  - Active on payout date
  - Minimum tenure met
  - Not on performance improvement plan
  - Not under investigation
```

**Rules**:
1. Active employment on payout date required
2. Minimum tenure (e.g., 3 months for STI)
3. Good standing (not on PIP)
4. No active disciplinary action
5. Eligibility rules configurable per plan

**Exceptions**:
- Terminated employees may receive prorated bonus (with approval)
- Retirement/disability may qualify for payout

**Error Messages**:
- `ERR_VAR_010`: "Employee {id} not eligible: {reason}."

**Related Requirements**:
- FR-TR-VAR-003

**Related Entities**:
- BonusAllocation

---

**Status**: ✅ Variable Pay Batch 1 Complete (BR-VAR-001 to BR-VAR-010)

**Progress**: 61/~300 rules (20%)

**Next**: Variable Pay Batch 2 - Equity Grants Part 1 (BR-VAR-011 to VAR-020)


## Category: Equity Grants

### BR-TR-VAR-011: Equity Grant Type Validation

**Priority**: HIGH

**Description**:
Validate equity grant type and ensure appropriate configuration.

**Conditions**:
```
IF creating EquityGrant
THEN type must be valid
AND configuration appropriate for type
```

**Rules**:
1. Valid types:
   - RSU (Restricted Stock Units): shares granted, vest over time
   - STOCK_OPTION: right to purchase at strike price
   - SAR (Stock Appreciation Rights): cash/shares for appreciation
   - PHANTOM_STOCK: cash equivalent to stock value
2. Each type has specific attributes
3. Type determines vesting and exercise rules
4. Tax treatment varies by type

**Exceptions**:
- None

**Error Messages**:
- `ERR_VAR_011`: "Invalid equity grant type '{type}'."

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-012: Grant Quantity Validation

**Priority**: HIGH

**Description**:
Validate grant quantity against available shares and limits.

**Conditions**:
```
IF creating grant
THEN quantity > 0
AND quantity <= available_shares
AND quantity within individual limit
```

**Rules**:
1. Quantity must be positive
2. Cannot exceed available shares in pool
3. Individual grant limits by level:
   - IC: up to 10,000 shares
   - Manager: up to 25,000 shares
   - Director: up to 50,000 shares
   - VP: up to 100,000 shares
   - Executive: up to 500,000 shares
4. Total grants tracked against cap table
5. Board approval for large grants

**Exceptions**:
- Executive grants may require board approval regardless of size

**Error Messages**:
- `ERR_VAR_012`: "Grant quantity {qty} exceeds available shares {available}."
- `ERR_VAR_012_LIMIT`: "Grant quantity {qty} exceeds individual limit {limit} for level {level}."

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-013: Strike Price for Options

**Priority**: HIGH

**Description**:
Set strike price for stock options at Fair Market Value on grant date.

**Conditions**:
```
IF grant_type = STOCK_OPTION
THEN strike_price = FMV_on_grant_date
```

**Rules**:
1. Strike price = Fair Market Value (FMV) on grant date
2. FMV determined by:
   - Public company: closing price on grant date
   - Private company: 409A valuation
3. Cannot be below FMV (tax implications)
4. Strike price fixed at grant, doesn't change
5. Currency matches company stock currency

**Exceptions**:
- Discounted options require special tax treatment (not recommended)

**Error Messages**:
- `ERR_VAR_013`: "Strike price {price} below FMV {fmv} on grant date."

**Examples**:
```yaml
Example: Stock option grant
  Input:
    grant_date: 2025-01-15
    grant_type: STOCK_OPTION
    quantity: 10000
    FMV_on_grant_date: 50.00 USD
  
  Validation:
    strike_price must = 50.00 USD
    BR-TR-VAR-013: PASS
  
  Output:
    Grant created with strike price: $50.00
    
  Future Exercise (2028):
    If stock price = $100
    Gain per share: $100 - $50 = $50
    Total gain: 10,000 × $50 = $500,000
```

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-014: Vesting Schedule Validation

**Priority**: HIGH

**Description**:
Validate vesting schedule configuration.

**Conditions**:
```
IF defining vesting schedule
THEN validate:
  - Total vesting period
  - Cliff period
  - Vesting frequency
  - Vesting percentages sum to 100%
```

**Rules**:
1. Standard schedule: 4 years total, 1 year cliff, monthly vesting
2. Cliff: no vesting until cliff date, then cliff amount vests
3. After cliff: remaining vests per schedule (monthly/quarterly)
4. Total vesting percentage = 100%
5. Vesting dates calculated from grant date

**Exceptions**:
- Custom schedules require approval
- Accelerated vesting for acquisitions/IPO

**Error Messages**:
- `ERR_VAR_014`: "Invalid vesting schedule: percentages sum to {sum}%, expected 100%."

**Examples**:
```yaml
Example: Standard 4-year vesting
  Input:
    total_period: 48 months
    cliff_period: 12 months
    cliff_percentage: 25%
    post_cliff_frequency: MONTHLY
    post_cliff_percentage: 75% / 36 months = 2.0833% per month
    grant_quantity: 1000 shares
  
  Vesting Schedule:
    Month 0-11: 0 shares (cliff period)
    Month 12: 250 shares vest (25% cliff)
    Month 13: 20.83 shares vest
    Month 14: 20.83 shares vest
    ...
    Month 48: 20.83 shares vest
    Total: 1000 shares
  
  Validation:
    Total: 25% + (2.0833% × 36) = 100%
    BR-TR-VAR-014: PASS
  
  Output:
    Vesting schedule created
```

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-015: Grant Effective Date

**Priority**: MEDIUM

**Description**:
Grant effective date determines vesting start and FMV for options.

**Conditions**:
```
IF creating grant
THEN effective_date must be:
  - Valid business day
  - Not in past (except corrections)
  - Approval date or later
```

**Rules**:
1. Effective date = vesting start date
2. Must be business day
3. Typically = board approval date
4. Cannot be before approval date
5. FMV determined on effective date

**Exceptions**:
- Corrections may have past effective dates with approval

**Error Messages**:
- `ERR_VAR_015`: "Effective date {date} is before approval date {approval_date}."

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-016: Grant Approval Workflow

**Priority**: HIGH

**Description**:
Route equity grants for appropriate approval based on quantity and level.

**Conditions**:
```
IF creating equity grant
THEN route for approval based on:
  - Grant value
  - Employee level
  - Grant type
```

**Rules**:
1. Approval levels:
   - Manager: standard grants within guidelines
   - VP: off-cycle or above-guideline grants
   - CEO: executive grants
   - Board: CEO and large grants (>100K shares)
2. Approval thresholds configurable
3. All grants logged for board review
4. Grant effective date = approval date

**Exceptions**:
- New hire grants may have delegated approval

**Error Messages**:
- `ERR_VAR_016`: "Grant requires {approver_level} approval."

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-017: Grant Amendment Rules

**Priority**: MEDIUM

**Description**:
Define rules for amending equity grants after creation.

**Conditions**:
```
IF amending grant
THEN amendment must be:
  - Before any vesting
  - Approved at same level as original
  - Documented with reason
```

**Rules**:
1. Amendments allowed before first vesting
2. Cannot amend after vesting starts (create new grant instead)
3. Amendable fields:
   - Quantity (increase/decrease)
   - Vesting schedule
   - Grant type (limited)
4. Requires same approval level as original
5. Tax implications reviewed

**Exceptions**:
- Post-vesting amendments require board approval

**Error Messages**:
- `ERR_VAR_017`: "Cannot amend grant: vesting already started."

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-018: Grant Cancellation Rules

**Priority**: MEDIUM

**Description**:
Define rules for cancelling equity grants.

**Conditions**:
```
IF cancelling grant
THEN:
  - Unvested shares returned to pool
  - Vested shares retained by employee
  - Cancellation reason documented
```

**Rules**:
1. Cancellation reasons:
   - Employee termination
   - Performance issues
   - Grant error/correction
   - Employee request
2. Unvested shares forfeited and returned to pool
3. Vested shares retained (cannot be cancelled)
4. Cancellation effective immediately
5. Employee notified

**Exceptions**:
- Termination for cause: may forfeit all shares (per agreement)

**Error Messages**:
- `ERR_VAR_018`: "Cannot cancel vested shares."

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-019: Grant Documentation Requirements

**Priority**: MEDIUM

**Description**:
Ensure proper documentation for equity grants.

**Conditions**:
```
IF creating grant
THEN generate:
  - Grant agreement
  - Vesting schedule
  - Tax disclosure
  - Employee acknowledgment
```

**Rules**:
1. Required documents:
   - Equity grant agreement
   - Vesting schedule detail
   - Tax implications disclosure
   - Employee acknowledgment form
2. Documents generated automatically
3. Employee must acknowledge receipt
4. Documents stored securely
5. Compliance with securities laws

**Exceptions**:
- Simplified docs for small grants

**Error Messages**:
- `ERR_VAR_019`: "Grant documentation incomplete."

**Related Requirements**:
- FR-TR-VAR-006

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-020: Grant Equity Pool Management

**Priority**: HIGH

**Description**:
Manage equity pool and track available shares.

**Conditions**:
```
IF creating grant
THEN:
  - Deduct from available pool
  - Track granted shares
  - Update pool availability
```

**Rules**:
1. Available pool = authorized - (granted + exercised)
2. Granted includes unvested grants
3. Pool replenished when grants forfeit
4. Pool tracked by plan (e.g., 2020 Plan, 2025 Plan)
5. Board can authorize additional shares

**Exceptions**:
- Over-allocation requires board approval

**Error Messages**:
- `ERR_VAR_020`: "Insufficient shares in pool: {available} available, {requested} requested."

**Examples**:
```yaml
Example: Pool management
  Input:
    authorized_shares: 10000000
    granted_unvested: 6000000
    granted_vested: 2000000
    exercised: 1500000
    new_grant_request: 500000
  
  Calculation:
    total_granted: 6M + 2M = 8,000,000
    total_outstanding: 8M + 1.5M = 9,500,000
    available: 10M - 8M = 2,000,000
  
  Validation:
    new_grant (500K) <= available (2M)
    BR-TR-VAR-020: PASS
  
  Output:
    Grant approved
    New available: 2M - 500K = 1,500,000
```

**Related Requirements**:
- FR-TR-VAR-006
- FR-TR-VAR-013

**Related Entities**:
- EquityGrant

---

**Status**: ✅ Variable Pay Batch 2 Complete (BR-VAR-011 to BR-VAR-020)

**Progress**: 71/~300 rules (24%)

**Next**: Variable Pay Batch 3 - Equity Grants Part 2 (BR-VAR-021 to VAR-030)


## Category: Equity Vesting & Exercise

### BR-TR-VAR-021: Vesting Event Processing

**Priority**: HIGH

**Description**:
Process vesting events on schedule and create vested shares.

**Conditions**:
```
IF vesting_date reached
AND employee still employed
THEN vest shares per schedule
```

**Rules**:
1. Vesting processed on vesting date
2. Employee must be active on vesting date
3. Vested shares/units created
4. Unvested balance reduced
5. Tax withholding calculated (for RSUs)
6. Automated processing daily

**Exceptions**:
- Termination: unvested shares typically forfeited
- Retirement/disability: may have accelerated vesting

**Error Messages**:
- `ERR_VAR_021`: "Cannot vest: employee {id} not active on vesting date."

**Related Requirements**:
- FR-TR-VAR-007

**Related Entities**:
- EquityVestingEvent
- EquityGrant

---

### BR-TR-VAR-022: Vesting Acceleration Rules

**Priority**: MEDIUM

**Description**:
Define rules for accelerated vesting in special circumstances.

**Conditions**:
```
IF trigger_event occurs
THEN accelerate vesting per policy
```

**Rules**:
1. Acceleration triggers:
   - Acquisition/change of control
   - IPO
   - Termination without cause
   - Death or disability
   - Retirement (if eligible)
2. Acceleration types:
   - Full acceleration (100% vests)
   - Partial acceleration (e.g., 50%)
   - Cliff acceleration only
3. Policy defined in grant agreement
4. Requires board approval

**Exceptions**:
- Termination for cause: no acceleration

**Error Messages**:
- `WARN_VAR_022`: "Acceleration event {event} requires board approval."

**Examples**:
```yaml
Example: Acquisition acceleration
  Input:
    grant_quantity: 10000 shares
    vested_to_date: 2500 shares (25%)
    unvested: 7500 shares (75%)
    acceleration_policy: "Single trigger - 100%"
    event: Acquisition
  
  Calculation:
    accelerated_shares: 7500 (all unvested)
    total_vested_after: 2500 + 7500 = 10,000
  
  Validation:
    BR-TR-VAR-022: PASS (with board approval)
  
  Output:
    All 10,000 shares now vested
```

**Related Requirements**:
- FR-TR-VAR-007

**Related Entities**:
- EquityGrant
- EquityVestingEvent

---

### BR-TR-VAR-023: Option Exercise Validation

**Priority**: HIGH

**Description**:
Validate option exercise requests.

**Conditions**:
```
IF exercising options
THEN validate:
  - Options are vested
  - Within exercise window
  - Sufficient payment
  - Not expired
```

**Rules**:
1. Only vested options can be exercised
2. Must be within exercise window (typically 10 years from grant)
3. Payment required: quantity × strike price
4. Payment methods: cash, cashless, stock swap
5. Tax withholding calculated
6. Shares issued upon exercise

**Exceptions**:
- Early exercise (before vesting) if allowed by plan

**Error Messages**:
- `ERR_VAR_023`: "Cannot exercise: only {vested} of {total} options vested."
- `ERR_VAR_023_EXPIRED`: "Options expired on {expiry_date}."

**Examples**:
```yaml
Example: Option exercise
  Input:
    grant_quantity: 10000 options
    vested: 5000 options
    strike_price: $50
    current_FMV: $100
    exercise_quantity: 3000
  
  Validation:
    3000 <= 5000 (vested)
    BR-TR-VAR-023: PASS
  
  Calculation:
    payment_required: 3000 × $50 = $150,000
    taxable_gain: 3000 × ($100 - $50) = $150,000
    tax_withholding: $150,000 × 40% = $60,000
  
  Output:
    Shares issued: 3000
    Payment: $150,000
    Tax withheld: $60,000
```

**Related Requirements**:
- FR-TR-VAR-008

**Related Entities**:
- EquityGrant
- EquityTransaction

---

### BR-TR-VAR-024: Exercise Window After Termination

**Priority**: HIGH

**Description**:
Define exercise window for vested options after termination.

**Conditions**:
```
IF employee terminated
THEN vested options exercisable for limited period
AND unvested options forfeited
```

**Rules**:
1. Standard window: 90 days post-termination
2. Unvested options forfeited immediately
3. Vested options must be exercised within window
4. Unexercised options expire after window
5. Window may be extended for retirement/disability

**Exceptions**:
- Termination for cause: immediate forfeiture
- Death: extended window (e.g., 12 months)
- Retirement: may have extended window (e.g., 5 years)

**Error Messages**:
- `ERR_VAR_024`: "Exercise window expired on {date}."
- `WARN_VAR_024`: "Exercise window expires in {days} days."

**Related Requirements**:
- FR-TR-VAR-008

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-025: Cashless Exercise

**Priority**: MEDIUM

**Description**:
Allow cashless exercise where shares are sold to cover costs.

**Conditions**:
```
IF exercise_method = CASHLESS
THEN:
  - Sell shares to cover strike price
  - Sell shares to cover taxes
  - Net shares to employee
```

**Rules**:
1. Cashless = sell-to-cover
2. Broker sells shares at market price
3. Proceeds cover:
   - Strike price payment
   - Tax withholding
4. Net shares delivered to employee
5. Requires broker integration

**Exceptions**:
- Not available for private companies (no market)

**Error Messages**:
- `ERR_VAR_025`: "Cashless exercise not available for private company stock."

**Examples**:
```yaml
Example: Cashless exercise
  Input:
    options_exercised: 10000
    strike_price: $50
    current_FMV: $100
    tax_rate: 40%
  
  Calculation:
    total_value: 10,000 × $100 = $1,000,000
    strike_payment: 10,000 × $50 = $500,000
    taxable_gain: $1M - $500K = $500,000
    tax_withholding: $500,000 × 40% = $200,000
    
    total_costs: $500K + $200K = $700,000
    shares_to_sell: $700,000 / $100 = 7,000
    net_shares: 10,000 - 7,000 = 3,000
  
  Validation:
    BR-TR-VAR-025: PASS
  
  Output:
    Net shares delivered: 3,000
```

**Related Requirements**:
- FR-TR-VAR-008

**Related Entities**:
- EquityTransaction

---

### BR-TR-VAR-026: Cap Table Tracking

**Priority**: HIGH

**Description**:
Track equity ownership and maintain accurate cap table.

**Conditions**:
```
IF equity transaction occurs
THEN update cap table
AND validate ownership limits
```

**Rules**:
1. Cap table tracks:
   - Shares outstanding
   - Shares reserved for equity plans
   - Shares granted (unvested)
   - Shares vested
   - Shares exercised
   - Ownership by holder
2. Total shares cannot exceed authorized shares
3. Dilution calculated and reported
4. Ownership percentages calculated
5. Updated in real-time

**Exceptions**:
- Board can authorize additional shares

**Error Messages**:
- `ERR_VAR_026`: "Grant would exceed authorized shares: {available} available."

**Related Requirements**:
- FR-TR-VAR-013

**Related Entities**:
- EquityGrant
- EquityTransaction

---

### BR-TR-VAR-027: Dilution Calculation

**Priority**: MEDIUM

**Description**:
Calculate and report dilution from equity grants.

**Conditions**:
```
dilution = (shares_granted / total_shares_outstanding) × 100
```

**Rules**:
1. Dilution = new shares / total outstanding
2. Fully diluted includes all granted (vested + unvested)
3. Report dilution to board quarterly
4. Typical annual dilution: 3-5% for startups
5. Excessive dilution requires board discussion

**Exceptions**:
- Acquisition scenarios may have higher dilution

**Error Messages**:
- `WARN_VAR_027`: "Annual dilution {percentage}% exceeds target {target}%."

**Examples**:
```yaml
Example: Dilution calculation
  Input:
    shares_outstanding: 10000000
    new_grants_this_year: 400000
  
  Calculation:
    dilution: (400,000 / 10,000,000) × 100 = 4%
  
  Validation:
    4% within typical range (3-5%)
    BR-TR-VAR-027: PASS
  
  Output:
    Annual dilution: 4%
```

**Related Requirements**:
- FR-TR-VAR-013

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-028: Equity Valuation for Reporting

**Priority**: MEDIUM

**Description**:
Value equity grants for financial reporting and total rewards statements.

**Conditions**:
```
IF reporting equity value
THEN use appropriate valuation method
```

**Rules**:
1. Valuation methods:
   - RSU: current FMV × unvested quantity
   - Options: Black-Scholes or current spread
   - SAR: current appreciation value
   - Phantom: current stock value
2. FMV updated regularly (monthly for private, daily for public)
3. Valuation for different purposes:
   - Financial reporting: GAAP rules
   - Total rewards: current value
   - Tax: FMV at vest/exercise

**Exceptions**:
- Private companies: 409A valuation required

**Error Messages**:
- `WARN_VAR_028`: "FMV not updated in {days} days."

**Related Requirements**:
- FR-TR-VAR-013

**Related Entities**:
- EquityGrant

---

### BR-TR-VAR-029: Equity Tax Withholding

**Priority**: HIGH

**Description**:
Calculate and withhold taxes on equity vesting and exercise.

**Conditions**:
```
IF equity vests OR options exercised
THEN calculate tax withholding
AND withhold shares or cash
```

**Rules**:
1. RSU vesting: taxable as ordinary income at FMV
2. Option exercise: taxable on spread (FMV - strike price)
3. Withholding methods:
   - Sell to cover: sell shares to pay taxes
   - Net settlement: withhold shares for taxes
   - Cash payment: employee pays cash
4. Withholding rate per jurisdiction
5. Tax integrated with payroll

**Exceptions**:
- ISO (Incentive Stock Options): special tax treatment (no withholding at exercise)

**Error Messages**:
- `ERR_VAR_029`: "Tax withholding calculation failed for grant {id}."

**Related Requirements**:
- FR-TR-VAR-007
- FR-TR-VAR-008
- FR-TR-TAX-005

**Related Entities**:
- EquityVestingEvent
- EquityTransaction
- TaxWithholdingTransaction

---

### BR-TR-VAR-030: Equity Reporting Requirements

**Priority**: MEDIUM

**Description**:
Generate required equity reports for compliance and management.

**Conditions**:
```
IF reporting period ends
THEN generate equity reports
```

**Rules**:
1. Required reports:
   - Cap table (quarterly)
   - Grant activity (monthly)
   - Vesting schedule (ongoing)
   - Exercise activity (monthly)
   - Dilution analysis (quarterly)
   - Tax reporting (annual)
2. Reports for different audiences:
   - Board: cap table, dilution
   - Management: grant activity, costs
   - Finance: expense recognition
   - Tax: W-2/1099 data
3. Automated report generation
4. Secure distribution

**Exceptions**:
- Ad-hoc reports as needed

**Error Messages**:
- `ERR_VAR_030`: "Report generation failed: {error}."

**Related Requirements**:
- FR-TR-VAR-013

**Related Entities**:
- EquityGrant
- EquityTransaction

---

**Status**: ✅ Variable Pay Batch 3 Complete (BR-VAR-021 to BR-VAR-030)

**Progress**: 81/~300 rules (27%)

**Next**: Variable Pay Batch 4 - Commissions (BR-VAR-031 to VAR-040)


## Category: Commission Management

### BR-TR-VAR-031: Commission Plan Type Validation

**Priority**: HIGH

**Description**:
Validate commission plan type and configuration.

**Conditions**:
```
IF creating CommissionPlan
THEN type must be valid
```

**Rules**:
1. Valid types:
   - FLAT_RATE: fixed percentage of sales
   - TIERED: different rates for different achievement levels
   - ACCELERATOR: increasing rates as quota exceeded
   - DRAW: guaranteed minimum with reconciliation
2. Type determines calculation logic
3. Cannot change type after transactions exist

**Exceptions**:
- Type change requires new plan creation

**Error Messages**:
- `ERR_VAR_031`: "Invalid commission plan type '{type}'."

**Related Requirements**:
- FR-TR-VAR-009

**Related Entities**:
- CommissionPlan

---

### BR-TR-VAR-032: Commission Rate Validation

**Priority**: HIGH

**Description**:
Validate commission rates are reasonable and within policy.

**Conditions**:
```
IF defining commission rate
THEN 0% < rate <= max_rate
```

**Rules**:
1. Rate must be positive
2. Typical ranges:
   - Inside sales: 2-5%
   - Field sales: 5-15%
   - Enterprise sales: 10-20%
3. Maximum rate configurable
4. Rates may vary by product/service
5. Accelerator rates can exceed base rate

**Exceptions**:
- Strategic deals may have custom rates

**Error Messages**:
- `ERR_VAR_032`: "Commission rate {rate}% exceeds maximum {max}%."

**Related Requirements**:
- FR-TR-VAR-009

**Related Entities**:
- CommissionPlan

---

### BR-TR-VAR-033: Tiered Commission Configuration

**Priority**: HIGH

**Description**:
Configure commission tiers with achievement thresholds and rates.

**Conditions**:
```
IF plan_type = TIERED
THEN define tiers with:
  - Achievement threshold
  - Commission rate
  - No gaps or overlaps
```

**Rules**:
1. Tiers must be sequential
2. No gaps in achievement ranges
3. Rates typically increase with achievement
4. Minimum 2 tiers required
5. Maximum 10 tiers recommended

**Exceptions**:
- Declining rates for certain product categories

**Error Messages**:
- `ERR_VAR_033`: "Tier configuration invalid: gap between {tier1} and {tier2}."

**Examples**:
```yaml
Example: Tiered commission plan
  Input:
    quota: 1000000000 VND (1B)
    tiers:
      - threshold: 0-70%, rate: 5%
      - threshold: 70-100%, rate: 8%
      - threshold: 100-120%, rate: 10%
      - threshold: >120%, rate: 12%
  
  Calculation (if achievement = 110%):
    Tier 1 (0-70%): 700M × 5% = 35M
    Tier 2 (70-100%): 300M × 8% = 24M
    Tier 3 (100-110%): 100M × 10% = 10M
    Total commission: 69M VND
  
  Validation:
    BR-TR-VAR-033: PASS (no gaps, sequential)
  
  Output:
    Commission: 69M VND
```

**Related Requirements**:
- FR-TR-VAR-010

**Related Entities**:
- CommissionTier
- CommissionPlan

---

### BR-TR-VAR-034: Quota Assignment

**Priority**: HIGH

**Description**:
Assign sales quotas to commission-eligible employees.

**Conditions**:
```
IF assigning quota
THEN quota > 0
AND aligned with territory/role
```

**Rules**:
1. Quota must be positive
2. Quota aligned with:
   - Territory size
   - Product mix
   - Historical performance
   - Market potential
3. Quota typically annual, may be quarterly
4. Quota changes require approval
5. Prorated for partial periods

**Exceptions**:
- New hires may have ramped quotas (50% Q1, 75% Q2, 100% Q3+)

**Error Messages**:
- `ERR_VAR_034`: "Quota {amount} invalid or not aligned with role."

**Related Requirements**:
- FR-TR-VAR-009

**Related Entities**:
- CommissionPlan

---

### BR-TR-VAR-035: Commission Transaction Validation

**Priority**: HIGH

**Description**:
Validate commission transactions before processing.

**Conditions**:
```
IF importing commission transaction
THEN validate:
  - Employee is commission-eligible
  - Transaction date valid
  - Amount positive
  - Product/service code valid
```

**Rules**:
1. Employee must have active commission plan
2. Transaction date within commission period
3. Amount must be positive
4. Product/service code must exist
5. Duplicate detection (same deal ID)

**Exceptions**:
- Negative transactions for returns/adjustments

**Error Messages**:
- `ERR_VAR_035`: "Employee {id} not eligible for commissions."

**Related Requirements**:
- FR-TR-VAR-011

**Related Entities**:
- CommissionTransaction

---

### BR-TR-VAR-036: Commission Calculation

**Priority**: HIGH

**Description**:
Calculate commissions based on plan type and achievement.

**Conditions**:
```
IF calculating commission
THEN apply plan rules:
  - FLAT_RATE: sales × rate
  - TIERED: sum of (tier_sales × tier_rate)
  - ACCELERATOR: progressive rate increase
```

**Rules**:
1. Calculation method per plan type
2. Achievement = actual sales / quota
3. Apply appropriate rate(s)
4. Handle splits (multiple reps on deal)
5. Apply caps/floors if configured

**Exceptions**:
- Manual adjustments for special cases

**Error Messages**:
- `ERR_VAR_036`: "Commission calculation failed for transaction {id}."

**Related Requirements**:
- FR-TR-VAR-011

**Related Entities**:
- CommissionTransaction

---

### BR-TR-VAR-037: Commission Splits

**Priority**: MEDIUM

**Description**:
Handle commission splits for deals involving multiple sales reps.

**Conditions**:
```
IF deal has multiple reps
THEN split commission per defined percentages
AND percentages must sum to 100%
```

**Rules**:
1. Split percentages must sum to 100%
2. Each rep receives their percentage
3. Split rules defined per deal or plan
4. Common splits:
   - 50/50 for co-selling
   - 70/30 for primary/overlay
   - Custom splits approved by manager
5. All reps must be commission-eligible

**Exceptions**:
- Manager overrides require approval

**Error Messages**:
- `ERR_VAR_037`: "Commission split percentages sum to {sum}%, expected 100%."

**Related Requirements**:
- FR-TR-VAR-011

**Related Entities**:
- CommissionTransaction

---

### BR-TR-VAR-038: Commission Clawback Rules

**Priority**: MEDIUM

**Description**:
Define rules for commission clawbacks on cancelled/returned deals.

**Conditions**:
```
IF deal cancelled OR customer returns
THEN clawback commission
WITHIN clawback period
```

**Rules**:
1. Clawback period: typically 90-180 days
2. Full clawback if deal cancelled
3. Partial clawback for partial returns
4. Clawback processed as negative transaction
5. Cannot clawback after clawback period

**Exceptions**:
- Customer bankruptcy: may waive clawback

**Error Messages**:
- `WARN_VAR_038`: "Clawback period expired for transaction {id}."

**Related Requirements**:
- FR-TR-VAR-011

**Related Entities**:
- CommissionTransaction

---

### BR-TR-VAR-039: Draw Against Commission

**Priority**: MEDIUM

**Description**:
Manage commission draws (guaranteed minimum) with reconciliation.

**Conditions**:
```
IF plan has draw
THEN pay draw amount
AND reconcile against earned commissions
```

**Rules**:
1. Draw = guaranteed minimum payment
2. Draw types:
   - Recoverable: excess draw deducted from future commissions
   - Non-recoverable: guaranteed, no payback required
3. Reconciliation period: monthly or quarterly
4. Negative balance carried forward (recoverable)
5. Draw typically for new hires (ramp period)

**Exceptions**:
- Non-recoverable draws for strategic hires

**Error Messages**:
- `WARN_VAR_039`: "Commission draw balance negative: {balance}."

**Related Requirements**:
- FR-TR-VAR-009

**Related Entities**:
- CommissionPlan
- CommissionTransaction

---

### BR-TR-VAR-040: Commission Payout Timing

**Priority**: MEDIUM

**Description**:
Define when commissions are paid relative to sale recognition.

**Conditions**:
```
IF commission earned
THEN payout based on:
  - Sale recognition date
  - Payment receipt
  - Plan configuration
```

**Rules**:
1. Payout timing options:
   - On booking: when deal signed
   - On invoice: when customer invoiced
   - On payment: when customer pays
2. Timing configured per plan
3. Typical: monthly payout cycle
4. Payout integrated with payroll

**Exceptions**:
- Large deals may have milestone-based payouts

**Error Messages**:
- `ERR_VAR_040`: "Payout timing not configured for plan {plan_id}."

**Related Requirements**:
- FR-TR-VAR-011

**Related Entities**:
- CommissionPlan

---

## Category: Performance Integration & Reporting

### BR-TR-VAR-041: Performance Rating Requirement

**Priority**: HIGH

**Description**:
Require finalized performance ratings for variable pay calculations.

**Conditions**:
```
IF calculating variable pay
THEN performance rating must be:
  - From completed review cycle
  - Finalized (not draft)
  - Within valid period
```

**Rules**:
1. Rating from Performance Management module
2. Rating must be final (approved)
3. Rating period aligns with bonus period
4. Rating scale mapped to multipliers
5. Missing rating: flag for manager input

**Exceptions**:
- New hires: use manager assessment if no formal review

**Error Messages**:
- `ERR_VAR_041`: "Performance rating not finalized for employee {id}."

**Related Requirements**:
- FR-TR-VAR-012

**Related Entities**:
- BonusAllocation
- PM.PerformanceReview

---

### BR-TR-VAR-042: Rating to Multiplier Mapping

**Priority**: HIGH

**Description**:
Map performance ratings to bonus multipliers.

**Conditions**:
```
IF rating = "Exceeds"
THEN multiplier = 125%
```

**Rules**:
1. Standard mapping:
   - Does Not Meet: 0%
   - Partially Meets: 50-75%
   - Meets Expectations: 100%
   - Exceeds Expectations: 125-150%
   - Outstanding: 150-200%
2. Mapping configurable per company
3. Mapping may vary by level
4. Multiplier applied to target bonus

**Exceptions**:
- Custom multipliers for specific situations

**Error Messages**:
- `ERR_VAR_042`: "No multiplier mapping for rating '{rating}'."

**Related Requirements**:
- FR-TR-VAR-012

**Related Entities**:
- BonusPlan

---

### BR-TR-VAR-043: Performance Period Alignment

**Priority**: MEDIUM

**Description**:
Ensure performance review period aligns with bonus period.

**Conditions**:
```
IF using performance rating
THEN rating_period must overlap bonus_period
```

**Rules**:
1. Performance period should match bonus period
2. Typical: annual review for annual bonus
3. Misalignment flagged for review
4. Use most recent rating if periods don't match exactly
5. Mid-year hires: prorated period

**Exceptions**:
- Quarterly bonuses may use annual rating

**Error Messages**:
- `WARN_VAR_043`: "Performance period {period} doesn't align with bonus period {bonus_period}."

**Related Requirements**:
- FR-TR-VAR-012

**Related Entities**:
- BonusCycle
- PM.ReviewCycle

---

### BR-TR-VAR-044: Variable Pay Statement Generation

**Priority**: MEDIUM

**Description**:
Generate variable pay statements after payouts are finalized.

**Conditions**:
```
IF variable pay finalized
THEN generate statement
```

**Rules**:
1. Statements generated after payout
2. Include all variable pay components:
   - Bonuses (STI/LTI)
   - Commissions
   - Equity value
3. Show year-to-date totals
4. Personalized per employee

**Exceptions**:
- Preview statements before finalization

**Error Messages**:
- `ERR_VAR_044`: "Cannot generate statement: payout not finalized."

**Related Requirements**:
- FR-TR-VAR-014

**Related Entities**:
- BonusAllocation
- CommissionTransaction
- EquityGrant

---

### BR-TR-VAR-045: Statement Content Requirements

**Priority**: MEDIUM

**Description**:
Variable pay statements must include all required information.

**Conditions**:
```
IF generating statement
THEN include:
  - Bonus details
  - Commission details
  - Equity holdings
  - Total variable pay value
```

**Rules**:
1. Required sections:
   - Bonus summary (target, actual, multiplier)
   - Commission summary (quota, achievement, earnings)
   - Equity summary (grants, vested, value)
   - Total variable compensation
2. Year-over-year comparison
3. Tax withholding shown
4. Confidential delivery

**Exceptions**:
- Minimal statements if no variable pay

**Error Messages**:
- `ERR_VAR_045`: "Statement missing required section: {section}."

**Related Requirements**:
- FR-TR-VAR-014

**Related Entities**:
- BonusAllocation
- CommissionTransaction
- EquityGrant

---

## Category: Payroll Integration

### BR-TR-VAR-046: Payout File Format

**Priority**: HIGH

**Description**:
Generate payout files in format required by payroll system.

**Conditions**:
```
IF sending to payroll
THEN format must match payroll requirements
```

**Rules**:
1. File format: CSV or API
2. Required fields:
   - Employee ID
   - Pay component code
   - Gross amount
   - Tax withholding
   - Payout date
3. File validation before send
4. Confirmation from payroll required

**Exceptions**:
- Manual payouts for exceptions

**Error Messages**:
- `ERR_VAR_046`: "Payout file validation failed: {error}."

**Related Requirements**:
- FR-TR-VAR-005
- FR-TR-VAR-011

**Related Entities**:
- BonusAllocation
- CommissionTransaction
- PR.PayrollInput

---

### BR-TR-VAR-047: Payout Reconciliation

**Priority**: HIGH

**Description**:
Reconcile variable pay payouts with payroll actuals.

**Conditions**:
```
IF payout processed
THEN reconcile:
  - Expected amount vs actual
  - Tax withholding
  - Net pay
```

**Rules**:
1. Reconciliation after each payout
2. Compare expected vs actual amounts
3. Investigate variances >1%
4. Document reconciliation results
5. Resolve discrepancies before next payout

**Exceptions**:
- Small variances (<$1) may be ignored

**Error Messages**:
- `WARN_VAR_047`: "Payout variance detected: expected {expected}, actual {actual}."

**Related Requirements**:
- FR-TR-VAR-005

**Related Entities**:
- BonusAllocation
- CommissionTransaction

---

### BR-TR-VAR-048: Tax Withholding Integration

**Priority**: HIGH

**Description**:
Integrate variable pay tax withholding with tax module.

**Conditions**:
```
IF processing variable pay
THEN calculate tax withholding
USING tax module rules
```

**Rules**:
1. Variable pay is supplemental income
2. May have different tax rate than regular salary
3. Withholding calculated per jurisdiction
4. Employee can elect additional withholding
5. Tax integrated with payroll

**Exceptions**:
- Some countries tax bonuses at regular rates

**Error Messages**:
- `ERR_VAR_048`: "Tax withholding calculation failed for employee {id}."

**Related Requirements**:
- FR-TR-VAR-005
- FR-TR-TAX-005

**Related Entities**:
- BonusAllocation
- CommissionTransaction
- TaxWithholdingTransaction

---

### BR-TR-VAR-049: Variable Pay Accrual

**Priority**: MEDIUM

**Description**:
Accrue variable pay expenses for financial reporting.

**Conditions**:
```
IF variable pay earned
THEN accrue expense
EVEN IF not yet paid
```

**Rules**:
1. Accrual based on:
   - Bonus: performance period
   - Commission: sale recognition
   - Equity: vesting period
2. Accrual updated monthly
3. True-up at payout
4. Reversal if not paid

**Exceptions**:
- Discretionary bonuses: accrue when approved

**Error Messages**:
- `WARN_VAR_049`: "Accrual variance: {variance} between accrued and actual."

**Related Requirements**:
- FR-TR-VAR-015

**Related Entities**:
- BonusAllocation
- CommissionTransaction

---

### BR-TR-VAR-050: Variable Pay Audit Trail

**Priority**: HIGH

**Description**:
Maintain complete audit trail for all variable pay transactions.

**Conditions**:
```
IF variable pay transaction occurs
THEN log:
  - Transaction details
  - Approvals
  - Calculations
  - Payouts
```

**Rules**:
1. All transactions logged immutably
2. Include calculation details
3. Include approval chain
4. Include payout confirmation
5. Retain for 7 years minimum

**Exceptions**:
- None (required for compliance)

**Error Messages**:
- N/A (automatic logging)

**Related Requirements**:
- FR-TR-VAR-004
- FR-TR-VAR-005
- FR-TR-AUDIT-001

**Related Entities**:
- BonusAllocation
- CommissionTransaction
- EquityGrant
- AuditLog

---

## Summary: Variable Pay Rules

**Total Rules**: 50  
**Priority Breakdown**:
- HIGH: 34 rules (68%)
- MEDIUM: 16 rules (32%)
- LOW: 0 rules

**Categories**:
1. Bonus Plan Setup (4 rules)
2. Bonus Cycle Management (3 rules)
3. Bonus Allocation (3 rules)
4. Equity Grants (20 rules)
5. Commission Management (10 rules)
6. Performance Integration & Reporting (5 rules)
7. Payroll Integration (5 rules)

**Key Highlights**:
- Comprehensive bonus calculation with performance multipliers
- Detailed equity grant management (RSU, Options, SAR, Phantom)
- Vesting schedules with cliff and acceleration
- Tiered commission plans with examples
- Performance rating integration
- Cap table management and dilution tracking
- Complete audit trail

---

**Status**: ✅ Variable Pay Rules Complete (50/50)

**Progress**: 101/~300 rules (34%)

**Next Sub-Module**: Benefits (66 rules)


---

