# 5. Offer Management Rules

## Category: Offer Package Creation

### BR-TR-OFFER-001: Offer Package Code Uniqueness

**Priority**: HIGH

**Description**:
Each offer package must have a unique code.

**Conditions**:
```
IF creating OfferPackage
AND code exists
THEN reject
```

**Rules**:
1. Code unique globally (across all legal entities)
2. Format: auto-generated (e.g., OFFER-2025-00001)
3. Sequential numbering
4. Cannot be changed once created
5. Code used for tracking and reference

**Exceptions**:
- None

**Error Messages**:
- `ERR_OFFER_001`: "Offer package code '{code}' already exists."

**Related Requirements**:
- FR-TR-OFFER-001

**Related Entities**:
- OfferPackage

---

### BR-TR-OFFER-002: Candidate Information Validation

**Priority**: HIGH

**Description**:
Validate candidate information before creating offer.

**Conditions**:
```
IF creating offer
THEN candidate information must be complete
```

**Rules**:
1. Required candidate fields:
   - Full name
   - Email address
   - Phone number
   - Address
   - Tax ID/SSN (for background check)
2. Candidate must exist in ATS/Recruiting system
3. Candidate must have passed all interview stages
4. Background check completed (if required)
5. No existing active offer for same candidate

**Exceptions**:
- Internal transfers may skip some validations

**Error Messages**:
- `ERR_OFFER_002`: "Candidate information incomplete: {missing_fields}."

**Related Requirements**:
- FR-TR-OFFER-001

**Related Entities**:
- OfferPackage
- ATS.Candidate

---

### BR-TR-OFFER-003: Position Information Validation

**Priority**: HIGH

**Description**:
Validate position information for the offer.

**Conditions**:
```
IF creating offer
THEN position must be valid and approved
```

**Rules**:
1. Position must exist in system
2. Position must be approved (headcount approved)
3. Position details required:
   - Job title
   - Department
   - Location
   - Reports to (manager)
   - Employment type (FULL_TIME, PART_TIME, etc.)
   - Grade/level
4. Position must be OPEN status
5. One offer per position (unless multiple candidates)

**Exceptions**:
- New positions may be created during offer process

**Error Messages**:
- `ERR_OFFER_003`: "Position {position_id} is not approved or not open."

**Related Requirements**:
- FR-TR-OFFER-001

**Related Entities**:
- OfferPackage
- Core.Position

---

### BR-TR-OFFER-004: Base Salary Validation

**Priority**: HIGH

**Description**:
Validate base salary is within approved range for position.

**Conditions**:
```
IF defining base salary
THEN salary must be within grade pay range
```

**Rules**:
1. Salary must be within grade pay range
2. Typical offer: 90-95% compa-ratio for new hires
3. Salary must match position currency
4. Salary frequency (annual, monthly) specified
5. Out-of-range requires approval

**Exceptions**:
- High-demand roles may exceed range with approval
- Executive offers may have custom ranges

**Error Messages**:
- `ERR_OFFER_004`: "Base salary {amount} outside grade range [{min} - {max}]."

**Examples**:
```yaml
Example: Salary validation
  Input:
    position_grade: Senior Engineer
    grade_range: [80M - 120M VND annually]
    offered_salary: 95M VND
    compa_ratio: 90% (assuming midpoint = 100M)
  
  Validation:
    95M within [80M - 120M]: PASS
    Compa-ratio 90%: PASS (typical for new hire)
    BR-OFFER-004: PASS
  
  Output:
    Salary approved: 95M VND/year
```

**Related Requirements**:
- FR-TR-OFFER-002

**Related Entities**:
- OfferPackage
- Core.PayRange

---

### BR-TR-OFFER-005: Variable Pay Component Configuration

**Priority**: MEDIUM

**Description**:
Configure variable pay components in offer package.

**Conditions**:
```
IF offer includes variable pay
THEN configure:
  - Bonus target percentage
  - Equity grant (if applicable)
  - Commission plan (if applicable)
```

**Rules**:
1. Variable pay components:
   - STI bonus: target percentage of base salary
   - LTI/Equity: number of shares/options
   - Commission: plan and quota
2. Components must align with position level
3. Equity grants require board approval
4. Variable pay shown as target, not guaranteed
5. Tax treatment disclosed

**Exceptions**:
- Entry-level positions may not have variable pay

**Error Messages**:
- `ERR_OFFER_005`: "Variable pay configuration invalid: {reason}."

**Related Requirements**:
- FR-TR-OFFER-002

**Related Entities**:
- OfferPackage

---

### BR-TR-OFFER-006: Benefits Package Selection

**Priority**: MEDIUM

**Description**:
Select benefits package for offer.

**Conditions**:
```
IF configuring benefits
THEN select from approved benefit plans
```

**Rules**:
1. Benefits based on:
   - Position level
   - Employment type
   - Location
2. Standard benefits package or custom
3. Benefits summary included in offer
4. Enrollment details provided
5. Benefits effective from start date

**Exceptions**:
- Executive offers may have enhanced benefits

**Error Messages**:
- `ERR_OFFER_006`: "Benefits package {package_id} not available for position level."

**Related Requirements**:
- FR-TR-OFFER-002

**Related Entities**:
- OfferPackage
- BenefitPlan

---

### BR-TR-OFFER-007: Start Date Validation

**Priority**: HIGH

**Description**:
Validate proposed start date for offer.

**Conditions**:
```
IF setting start date
THEN date must be:
  - Future date
  - Business day
  - Reasonable notice period
```

**Rules**:
1. Start date must be in future
2. Must be business day (not weekend/holiday)
3. Minimum notice period:
   - Standard: 2 weeks from offer acceptance
   - Senior roles: 4 weeks
   - Executive: 8 weeks
4. Aligned with payroll cycle (typically 1st or 16th)
5. Background check completion before start date

**Exceptions**:
- Emergency hires may have shorter notice
- Internal transfers: immediate or next pay period

**Error Messages**:
- `ERR_OFFER_007`: "Start date {date} invalid: {reason}."

**Related Requirements**:
- FR-TR-OFFER-001

**Related Entities**:
- OfferPackage

---

### BR-TR-OFFER-008: Offer Expiration Date

**Priority**: MEDIUM

**Description**:
Set offer expiration date for candidate response.

**Conditions**:
```
IF creating offer
THEN set expiration date
```

**Rules**:
1. Standard expiration: 7 days from offer date
2. Senior roles: 14 days
3. Executive: 30 days
4. Expiration date clearly stated in offer letter
5. Expired offers automatically closed
6. Can extend expiration with approval

**Exceptions**:
- Competitive situations: shorter expiration (3-5 days)

**Error Messages**:
- `WARN_OFFER_008`: "Offer expires on {date}."

**Related Requirements**:
- FR-TR-OFFER-001

**Related Entities**:
- OfferPackage

---

### BR-TR-OFFER-009: Sign-On Bonus Validation

**Priority**: MEDIUM

**Description**:
Validate sign-on bonus if included in offer.

**Conditions**:
```
IF offer includes sign_on_bonus
THEN validate amount and terms
```

**Rules**:
1. Sign-on bonus requires justification:
   - Competitive offer from another company
   - Relocation costs
   - Forfeited bonus from previous employer
   - High-demand skills
2. Typical range: 10-25% of base salary
3. Repayment terms if employee leaves within 12 months
4. Paid on first paycheck or after probation
5. Taxed as supplemental income

**Exceptions**:
- Executive sign-on bonuses may be higher

**Error Messages**:
- `ERR_OFFER_009`: "Sign-on bonus {amount} exceeds maximum {max}."

**Related Requirements**:
- FR-TR-OFFER-002

**Related Entities**:
- OfferPackage

---

### BR-TR-OFFER-010: Relocation Package Validation

**Priority**: MEDIUM

**Description**:
Validate relocation package if candidate requires relocation.

**Conditions**:
```
IF offer includes relocation
THEN configure relocation package
```

**Rules**:
1. Relocation components:
   - Moving expenses (actual or lump sum)
   - Temporary housing
   - Travel costs
   - Spouse/family support
2. Relocation amount based on:
   - Distance
   - Family size
   - Position level
3. Repayment terms if employee leaves within 24 months
4. Tax gross-up may be provided
5. Receipts required for reimbursement

**Exceptions**:
- Local candidates: no relocation

**Error Messages**:
- `ERR_OFFER_010`: "Relocation package configuration invalid."

**Related Requirements**:
- FR-TR-OFFER-002

**Related Entities**:
- OfferPackage

---

### BR-TR-OFFER-011: Total Compensation Calculation

**Priority**: HIGH

**Description**:
Calculate total compensation value for offer package.

**Conditions**:
```
total_compensation = base_salary + target_bonus + equity_value + benefits_value + other
```

**Rules**:
1. Total compensation includes:
   - Base salary (annual)
   - Target bonus (annual)
   - Equity value (annual vesting)
   - Benefits value (annual)
   - Sign-on bonus (one-time)
   - Relocation (one-time)
2. Calculation for comparison purposes
3. Shown in offer summary
4. Year 1 vs ongoing compensation differentiated

**Exceptions**:
- None

**Error Messages**:
- `ERR_OFFER_011`: "Total compensation calculation failed."

**Examples**:
```yaml
Example: Total compensation
  Input:
    base_salary: 100M VND/year
    target_bonus: 15% = 15M VND/year
    equity: 10,000 shares, FMV $50, 4-year vest = $125K/year = ~3B VND/year
    benefits: 30M VND/year
    sign_on: 20M VND (one-time)
    relocation: 50M VND (one-time)
  
  Calculation:
    Year 1 total: 100M + 15M + 3000M + 30M + 20M + 50M = 3,215M VND
    Ongoing annual: 100M + 15M + 3000M + 30M = 3,145M VND
  
  Validation:
    BR-OFFER-011: PASS
  
  Output:
    Year 1: 3.215B VND
    Ongoing: 3.145B VND/year
```

**Related Requirements**:
- FR-TR-OFFER-003

**Related Entities**:
- OfferPackage

---

### BR-TR-OFFER-012: Offer Package Completeness

**Priority**: HIGH

**Description**:
Ensure offer package is complete before submission for approval.

**Conditions**:
```
IF submitting offer for approval
THEN all required components must be configured
```

**Rules**:
1. Required components:
   - Candidate information
   - Position details
   - Base salary
   - Start date
   - Benefits package
   - Offer expiration date
2. Optional components:
   - Variable pay
   - Sign-on bonus
   - Relocation
   - Special terms
3. Offer letter template selected
4. Approvers identified
5. All validations passed

**Exceptions**:
- Draft offers can be saved incomplete

**Error Messages**:
- `ERR_OFFER_012`: "Offer package incomplete: {missing_items}."

**Related Requirements**:
- FR-TR-OFFER-001

**Related Entities**:
- OfferPackage

---

**Status**: ✅ Offer Management Batch 1 Complete (BR-OFFER-001 to BR-OFFER-012)

**Progress**: 210/~300 rules (70%)

**Next**: Offer Management Batch 2 - Approval & E-signature (BR-OFFER-013 to OFFER-023)


## Category: Offer Approval & E-signature

### BR-TR-OFFER-013: Offer Approval Workflow

**Priority**: HIGH

**Description**:
Route offers through approval workflow based on level and compensation.

**Conditions**:
```
IF submitting offer for approval
THEN route based on:
  - Position level
  - Total compensation
  - Special terms
```

**Rules**:
1. Approval levels:
   - Hiring Manager: all offers
   - Department Head: senior roles or >$100K
   - VP/C-level: director+ or >$200K
   - CEO: executive offers
   - Board: CEO and C-level offers
2. Approval sequence: sequential (not parallel)
3. Each approver can:
   - Approve
   - Reject (with reason)
   - Request changes
4. SLA: 2 business days per approver
5. Escalation if SLA exceeded

**Exceptions**:
- Emergency hires: expedited approval (24 hours)

**Error Messages**:
- N/A (workflow process)

**Related Requirements**:
- FR-TR-OFFER-004

**Related Entities**:
- OfferPackage
- OfferApproval

---

### BR-TR-OFFER-014: Approval Delegation

**Priority**: MEDIUM

**Description**:
Allow approvers to delegate offer approval authority to designated backup when unavailable (vacation, leave, etc.).

**Conditions**:
```
IF approver unavailable (OOO, on leave)
THEN delegate to designated backup
```

**Rules**:
1. Approver can designate backup approver
2. Delegation period: start and end dates
3. Backup must be same or higher level
4. Delegation logged for audit
5. Original approver can revoke delegation anytime
6. System auto-routes to backup during delegation period

**Exceptions**:
- C-level offers: cannot be delegated
- Emergency approvals: CEO can override

**Error Messages**:
- `ERR_OFFER_014`: "Offer approval delegation failed: {reason}."
- `WARN_OFFER_014`: "Delegation period overlaps with existing delegation."

**Examples**:
```yaml
Example: Manager Delegation During Vacation
  Input:
    approver: Sarah Johnson (Director)
    backup: Tom Wilson (Senior Director)
    delegation_start: "2025-12-20"
    delegation_end: "2026-01-05"
    reason: "Annual leave"
  
  Validation:
    ✅ Backup level (Senior Director) >= Approver level (Director)
    ✅ Delegation period valid
    ✅ No overlapping delegations
  
  System Actions:
    1. Create delegation record
    2. Log delegation in audit trail
    3. Route pending approvals to Tom Wilson
    4. Send notification to Tom Wilson
    5. Auto-revert on 2026-01-06
  
  Validation:
    BR-TR-OFFER-014: PASS
  
  Output:
    Delegation active
    Pending offers (3) routed to Tom Wilson
```

**Related Requirements**:
- FR-TR-OFFER-004

**Related Entities**:
- OfferApproval
- ApprovalDelegation

---

### BR-TR-OFFER-015: Offer Revision After Rejection

**Priority**: HIGH

**Description**:
Allow offer revision and resubmission after rejection with documented changes addressing rejection reasons.

**Conditions**:
```
IF offer rejected
THEN allow revision with changes
```

**Rules**:
1. Rejection reason required from approver
2. Revisions must address rejection reasons
3. New approval cycle starts from beginning
4. Version history maintained for audit
5. Max 3 revisions per offer
6. Each revision tracked with timestamp and user

**Exceptions**:
- None

**Error Messages**:
- `ERR_OFFER_015`: "Maximum revisions (3) reached for offer {id}."
- `WARN_OFFER_015`: "Offer revision must address rejection reason: {reason}."

**Examples**:
```yaml
Example: Salary Revision After Rejection
  Initial Offer:
    candidate: John Doe
    position: Senior Engineer
    base_salary: 150M VND
    status: REJECTED
    rejection_reason: "Salary exceeds approved budget (max 130M)"
  
  Revision 1:
    base_salary: 125M VND (reduced)
    sign_on_bonus: 10M VND (added to compensate)
    total_comp: 135M VND
    revision_notes: "Reduced base, added sign-on bonus"
  
  System Actions:
    1. Create revision version 2
    2. Log changes in version history
    3. Restart approval workflow
    4. Notify approvers of revision
  
  Validation:
    BR-TR-OFFER-015: PASS
  
  Output:
    Offer revised (v2)
    Sent for re-approval
```

**Related Requirements**:
- FR-TR-OFFER-004

**Related Entities**:
- OfferPackage
- OfferApproval

---

### BR-TR-OFFER-016: Offer Letter Generation

**Priority**: HIGH

**Description**:
Generate professional offer letter from approved offer package using position-appropriate template.

**Conditions**:
```
IF offer approved
THEN generate offer letter from template
```

**Rules**:
1. Use approved template for position/level
2. Populate all offer details automatically
3. Include all compensation components
4. Add legal disclaimers and terms
5. Generate PDF format for signing
6. Include company branding and logo
7. Multi-language support if needed

**Exceptions**:
- Executive offers: custom templates
- International offers: country-specific templates

**Error Messages**:
- `ERR_OFFER_016`: "Offer letter generation failed: {reason}."
- `WARN_OFFER_016`: "Template not found for position level {level}."

**Examples**:
```yaml
Example: Senior Engineer Offer Letter
  Input:
    offer_id: OFFER-2025-00123
    template: SENIOR_ENGINEER_VN
    candidate: Jane Smith
    position: Senior Software Engineer
    base_salary: 100M VND/year
    bonus_target: 15%
    benefits: Standard Package
    start_date: "2026-02-01"
  
  Generated Letter Includes:
    - Header: Company logo, date
    - Greeting: "Dear Jane Smith,"
    - Position: Senior Software Engineer, Engineering Dept
    - Compensation:
      * Base: 100M VND annually
      * Bonus: 15% target (15M VND)
      * Benefits: Medical, Dental, Life Insurance
    - Start Date: February 1, 2026
    - Terms: At-will employment, probation period
    - Legal: Confidentiality, IP assignment
    - Signature: E-signature fields
  
  Validation:
    BR-TR-OFFER-016: PASS
  
  Output:
    PDF generated: OfferLetter_OFFER-2025-00123.pdf
    Ready for e-signature
```

**Related Requirements**:
- FR-TR-OFFER-006

**Related Entities**:
- OfferPackage
- OfferLetter

---

### BR-TR-OFFER-017: E-signature Integration

**Priority**: HIGH

**Description**:
Integrate with e-signature platform (DocuSign, Adobe Sign, etc.) to enable legally binding electronic signatures.

**Conditions**:
```
IF offer letter ready
THEN send for e-signature
```

**Rules**:
1. Integration with e-signature provider (DocuSign/Adobe Sign)
2. Candidate signs electronically via email link
3. Signature legally binding per ESIGN Act/eIDAS
4. Complete audit trail maintained
5. Signed document stored securely in system
6. Real-time notifications on signature events
7. Certificate of completion generated

**Exceptions**:
- Paper offers: manual signature process for special cases
- Countries without e-signature laws: wet signature required

**Error Messages**:
- `ERR_OFFER_017`: "E-signature integration failed: {reason}."
- `WARN_OFFER_017`: "E-signature provider unavailable, retry in {minutes} minutes."

**Examples**:
```yaml
Example: DocuSign Integration
  Input:
    offer_letter: OfferLetter_OFFER-2025-00123.pdf
    candidate_email: jane.smith@email.com
    candidate_name: Jane Smith
    expiration_days: 7
  
  DocuSign Envelope:
    envelope_id: ENV-ABC123
    recipients:
      - name: Jane Smith
        email: jane.smith@email.com
        role: SIGNER
        signing_order: 1
    documents:
      - OfferLetter_OFFER-2025-00123.pdf
    expiration: 2025-12-22
  
  Workflow:
    1. Upload PDF to DocuSign
    2. Create envelope with signing fields
    3. Send email to candidate
    4. Candidate receives email with "Review Document" link
    5. Candidate reviews and signs
    6. System receives webhook notification
    7. Download signed PDF
    8. Update offer status: ACCEPTED
  
  Validation:
    BR-TR-OFFER-017: PASS
  
  Output:
    E-signature sent
    Tracking: ENV-ABC123
```

**Related Requirements**:
- FR-TR-OFFER-006

**Related Entities**:
- OfferLetter
- OfferAcceptance

---

### BR-TR-OFFER-018: Offer Delivery to Candidate

**Priority**: HIGH

**Description**:
Deliver offer letter to candidate via secure channel with authentication and tracking.

**Conditions**:
```
IF offer letter generated
THEN deliver to candidate
```

**Rules**:
1. Delivery methods:
   - Email with secure link (primary)
   - Candidate portal access
   - In-person delivery (special cases)
2. Candidate authentication required before access
3. Delivery confirmation tracked
4. Expiration date clearly stated in all communications
5. Contact information provided for questions
6. Mobile-friendly viewing

**Exceptions**:
- None

**Error Messages**:
- `ERR_OFFER_018`: "Offer delivery failed: {reason}."
- `WARN_OFFER_018`: "Candidate has not viewed offer after {days} days."

**Examples**:
```yaml
Example: Email Delivery with Secure Link
  Input:
    offer_id: OFFER-2025-00123
    candidate_email: jane.smith@email.com
    candidate_name: Jane Smith
    expiration_date: "2025-12-22"
  
  Email Content:
    To: jane.smith@email.com
    Subject: "Job Offer - Senior Software Engineer at VNG Corporation"
    
    Body:
      "Dear Jane,
      
      Congratulations! We are pleased to extend an offer for the position
      of Senior Software Engineer.
      
      Please review your offer letter by clicking the secure link below:
      https://offers.vng.com.vn/view/OFFER-2025-00123?token=ABC123XYZ
      
      This offer expires on December 22, 2025.
      
      If you have any questions, please contact:
      Sarah Johnson, Hiring Manager
      sarah.johnson@vng.com.vn
      +84 28 1234 5678
      
      We look forward to welcoming you to our team!"
  
  Tracking:
    delivery_timestamp: "2025-12-15 10:00:00"
    delivery_status: SENT
    first_view: null (pending)
    view_count: 0
  
  Validation:
    BR-TR-OFFER-018: PASS
  
  Output:
    Offer delivered via email
    Secure link active
    Tracking enabled
```

**Related Requirements**:
- FR-TR-OFFER-006

**Related Entities**:
- OfferLetter
- OfferDelivery

---

### BR-TR-OFFER-019: Candidate Authentication

**Priority**: MEDIUM

**Description**:
Authenticate candidate identity before allowing access to offer letter to prevent unauthorized viewing.

**Conditions**:
```
IF candidate accessing offer
THEN verify identity
```

**Rules**:
1. Authentication methods:
   - Email verification (click link in email)
   - SMS code (one-time password)
   - Candidate portal login
2. Unique access link per candidate (non-transferable)
3. Link expires after first use or time limit (7 days)
4. Track all access attempts (successful and failed)
5. Prevent unauthorized access and sharing
6. Multi-factor authentication for sensitive offers

**Exceptions**:
- In-person delivery: no authentication needed
- Internal transfers: SSO authentication

**Error Messages**:
- `ERR_OFFER_019`: "Candidate authentication failed."
- `WARN_OFFER_019`: "Multiple failed authentication attempts detected."

**Examples**:
```yaml
Example: Email Verification Authentication
  Input:
    offer_id: OFFER-2025-00123
    candidate_email: jane.smith@email.com
    access_token: ABC123XYZ (unique)
  
  Authentication Flow:
    1. Candidate clicks link in email
    2. System validates token:
       - Token exists: ✅
       - Token not expired: ✅
       - Token not already used: ✅
    3. Grant access to offer letter
    4. Mark token as used
    5. Log access event
  
  Access Log:
    timestamp: "2025-12-15 14:30:00"
    ip_address: "192.168.1.100"
    device: "iPhone 14, iOS 17"
    location: "Hanoi, Vietnam"
    status: SUCCESS
  
  Validation:
    BR-TR-OFFER-019: PASS
  
  Output:
    Authentication successful
    Offer letter displayed
```

**Related Requirements**:
- FR-TR-OFFER-006

**Related Entities**:
- OfferLetter
- CandidateAuth

---

### BR-TR-OFFER-020: E-signature Validation

**Priority**: HIGH

**Description**:
Validate e-signature meets legal requirements for enforceability and compliance.

**Conditions**:
```
IF candidate signs electronically
THEN validate signature legality
```

**Rules**:
1. Signature timestamp recorded with timezone
2. IP address logged for audit trail
3. Device information captured (browser, OS)
4. Explicit consent to e-sign confirmed
5. Signature certificate generated by provider
6. Meets ESIGN Act (US) / eIDAS (EU) requirements
7. Tamper-evident seal applied to document

**Exceptions**:
- None (legal compliance mandatory)

**Error Messages**:
- `ERR_OFFER_020`: "E-signature validation failed: {reason}."
- `WARN_OFFER_020`: "E-signature from suspicious location: {location}."

**Examples**:
```yaml
Example: DocuSign Signature Validation
  Input:
    envelope_id: ENV-ABC123
    signer: Jane Smith
    signature_timestamp: "2025-12-15 15:45:00 UTC+7"
  
  Validation Data Captured:
    signer_info:
      name: Jane Smith
      email: jane.smith@email.com
      consent: "I agree to use electronic signature" (✅ confirmed)
    
    signature_metadata:
      timestamp: "2025-12-15 15:45:00 UTC+7"
      ip_address: "192.168.1.100"
      location: "Hanoi, Vietnam"
      device: "Chrome 120, Windows 11"
    
    certificate:
      provider: DocuSign
      certificate_id: CERT-XYZ789
      hash: SHA-256:abc123...
      tamper_seal: VALID
  
  Legal Compliance:
    ✅ ESIGN Act compliant (US)
    ✅ eIDAS compliant (EU)
    ✅ Audit trail complete
    ✅ Document integrity verified
  
  Validation:
    BR-TR-OFFER-020: PASS
  
  Output:
    E-signature legally valid
    Certificate: CERT-XYZ789
```

**Related Requirements**:
- FR-TR-OFFER-006

**Related Entities**:
- OfferAcceptance
- SignatureValidation

---

### BR-TR-OFFER-021: Offer Viewing Tracking

**Priority**: LOW

**Description**:
Track when and how candidates view offer letters for engagement analytics.

**Conditions**:
```
IF candidate opens offer
THEN log viewing event
```

**Rules**:
1. Track first view timestamp (important milestone)
2. Track total number of views
3. Track time spent viewing (engagement metric)
4. Alert hiring manager on first view
5. Analytics for candidate engagement patterns
6. Privacy-compliant tracking (no excessive monitoring)

**Exceptions**:
- None

**Error Messages**:
- None (tracking is passive)

**Examples**:
```yaml
Example: Offer Viewing Analytics
  Input:
    offer_id: OFFER-2025-00123
    candidate: Jane Smith
  
  Viewing Log:
    first_view:
      timestamp: "2025-12-15 14:30:00"
      duration: 8 minutes
      device: "iPhone 14"
    
    subsequent_views:
      - timestamp: "2025-12-16 10:15:00"
        duration: 3 minutes
        device: "MacBook Pro"
      - timestamp: "2025-12-17 09:00:00"
        duration: 2 minutes
        device: "iPhone 14"
    
    summary:
      total_views: 3
      total_time: 13 minutes
      first_view_delay: 4.5 hours (from delivery)
      devices_used: 2
  
  Alerts Sent:
    - To hiring manager: "Jane Smith viewed offer" (on first view)
  
  Analytics Insights:
    - Quick first view (4.5 hours) = High interest ✅
    - Multiple views = Thorough review ✅
    - Long initial view (8 min) = Detailed reading ✅
  
  Validation:
    BR-TR-OFFER-021: PASS
```

**Related Requirements**:
- FR-TR-OFFER-006

**Related Entities**:
- OfferLetter
- ViewingLog

---

### BR-TR-OFFER-022: Reminder Notifications

**Priority**: MEDIUM

**Description**:
Send automated reminders to candidates before offer expiration to encourage timely response.

**Conditions**:
```
IF offer not responded
AND expiration approaching
THEN send reminders
```

**Rules**:
1. Reminder schedule:
   - 7 days before expiration (first reminder)
   - 3 days before expiration (second reminder)
   - 1 day before expiration (final reminder)
2. Notification channels: Email + SMS
3. Include expiration date and action link in all reminders
4. Escalate to hiring manager if no response by expiration
5. Stop reminders immediately after acceptance/decline
6. Customizable reminder templates

**Exceptions**:
- None

**Error Messages**:
- None (reminders are informational)

**Examples**:
```yaml
Example: Reminder Notification Sequence
  Input:
    offer_id: OFFER-2025-00123
    candidate: Jane Smith
    offer_date: "2025-12-15"
    expiration_date: "2025-12-22" (7 days)
  
  Reminder Schedule:
    Reminder 1 (7 days before):
      send_date: "2025-12-15" (same day as offer)
      subject: "Job Offer - Please Review"
      message: "Your offer expires in 7 days (Dec 22). Please review and respond."
      channels: Email
    
    Reminder 2 (3 days before):
      send_date: "2025-12-19"
      subject: "Reminder: Job Offer Expires in 3 Days"
      message: "Your offer expires on Dec 22. We look forward to your response!"
      channels: Email + SMS
    
    Reminder 3 (1 day before):
      send_date: "2025-12-21"
      subject: "⚠️ URGENT: Job Offer Expires Tomorrow"
      message: "Last chance! Your offer expires tomorrow (Dec 22). Please respond today."
      channels: Email + SMS
      cc: Hiring Manager (escalation)
  
  Scenario: Candidate Accepts on Dec 20:
    - Reminders 1 & 2: Sent ✅
    - Reminder 3: Cancelled (offer accepted) ❌
  
  Validation:
    BR-TR-OFFER-022: PASS
```

**Related Requirements**:
- FR-TR-OFFER-006

**Related Entities**:
- OfferPackage
- Notification

---

### BR-TR-OFFER-023: Offer Withdrawal Rules

**Priority**: HIGH

**Description**:
Allow company to withdraw offer before candidate acceptance with proper approvals and notifications.

**Conditions**:
```
IF offer needs withdrawal
THEN follow withdrawal process
```

**Rules**:
1. Withdrawal reason required (documented)
2. Approval required from:
   - Hiring manager
   - HR Director
   - Legal (if potential risk)
3. Candidate notified immediately via phone + email
4. Offer status changed to: WITHDRAWN
5. Cannot withdraw after candidate acceptance (legal contract)
6. Legal review required for risk assessment
7. Withdrawal logged in audit trail

**Exceptions**:
- Post-acceptance withdrawal: requires legal process and potential settlement
- Background check failures: immediate withdrawal allowed

**Error Messages**:
- `ERR_OFFER_023`: "Cannot withdraw accepted offer."
- `WARN_OFFER_023`: "Offer withdrawal requires legal review."

**Examples**:
```yaml
Example: Offer Withdrawal Due to Budget Freeze
  Input:
    offer_id: OFFER-2025-00123
    candidate: John Doe
    offer_status: PENDING (not yet accepted)
    withdrawal_reason: "Company-wide hiring freeze announced"
  
  Approval Workflow:
    1. Hiring Manager (Sarah Johnson): APPROVED
    2. HR Director (Tom Wilson): APPROVED
    3. Legal Review: LOW RISK (offer not accepted)
  
  Notification to Candidate:
    method: Phone call + Email
    message:
      "Dear John,
      
      We regret to inform you that due to an unexpected company-wide
      hiring freeze, we must withdraw the offer for the Senior Engineer
      position.
      
      This decision was not based on your qualifications, which remain
      excellent. We will keep your information on file and reach out
      when the freeze is lifted.
      
      We sincerely apologize for any inconvenience."
  
  System Actions:
    1. Update offer status: WITHDRAWN
    2. Log withdrawal in audit trail
    3. Close position requisition
    4. Archive offer documents
  
  Validation:
    BR-TR-OFFER-023: PASS
  
  Output:
    Offer withdrawn
    Candidate notified
    Audit trail updated
```

**Related Requirements**:
- FR-TR-OFFER-006

**Related Entities**:
- OfferPackage
- OfferWithdrawal

---

## Category: Offer Acceptance & Reporting

### BR-TR-OFFER-024: Offer Acceptance Validation

**Priority**: HIGH

**Description**:
Validate offer acceptance and capture required information.

**Conditions**:
```
IF candidate accepts offer
THEN validate:
  - Offer not expired
  - E-signature valid
  - Acceptance within expiration
```

**Rules**:
1. Acceptance must be before expiration date
2. E-signature required (legally binding)
3. Acceptance timestamp recorded
4. Offer status changed to ACCEPTED
5. Automatic notifications sent:
   - Hiring manager
   - HR
   - Recruiting
6. Trigger onboarding workflow

**Exceptions**:
- Verbal acceptance: requires written confirmation

**Error Messages**:
- `ERR_OFFER_024`: "Cannot accept expired offer."

**Related Requirements**:
- FR-TR-OFFER-005

**Related Entities**:
- OfferPackage

---

### BR-TR-OFFER-025: Offer Decline Handling

**Priority**: HIGH

**Description**:
Handle offer declines professionally and capture feedback for continuous improvement.

**Conditions**:
```
IF candidate declines offer
THEN process decline and capture reason
```

**Rules**:
1. Decline reason required (dropdown + free text)
2. Decline timestamp recorded
3. Offer status changed to: DECLINED
4. Automatic notifications sent to:
   - Hiring manager
   - HR team
   - Recruiting team
5. Position status: Close or restart search
6. Send thank you message to candidate
7. Maintain relationship for future opportunities

**Exceptions**:
- None

**Error Messages**:
- `ERR_OFFER_025`: "Decline reason required."

**Examples**:
```yaml
Example: Candidate Declines Due to Competing Offer
  Input:
    offer_id: OFFER-2025-00123
    candidate: Jane Smith
    decline_reason_category: COMPETING_OFFER
    decline_reason_text: "Accepted offer from Google with better compensation"
    decline_timestamp: "2025-12-20 10:00:00"
  
  System Actions:
    1. Update offer status: DECLINED
    2. Log decline reason
    3. Send notifications:
       - To hiring manager: "Jane Smith declined offer"
       - To HR: Decline reason captured
    4. Send thank you email to candidate:
       "Dear Jane, Thank you for considering our offer.
        We wish you success in your new role.
        Please keep us in mind for future opportunities."
  
  Position Action:
    - Reopen position for new candidates
    - Update job posting
  
  Validation:
    BR-TR-OFFER-025: PASS
```

**Related Requirements**:
- FR-TR-OFFER-005

**Related Entities**:
- OfferPackage
- DeclineReason

---

### BR-TR-OFFER-026: Decline Reason Capture

**Priority**: MEDIUM

**Description**:
Capture detailed structured decline reasons for analytics and process improvement.

**Conditions**:
```
IF candidate declines
THEN capture structured decline reason
```

**Rules**:
1. Decline categories:
   - Compensation (salary, benefits)
   - Location (remote, commute)
   - Role (responsibilities, level)
   - Culture (company fit)
   - Timing (start date, urgency)
   - Competing offer (better opportunity)
   - Personal (family, health)
2. Allow multiple reasons selection
3. Optional free-text explanation (encouraged)
4. Competing offer details if applicable:
   - Company name (optional)
   - Compensation comparison
5. Aggregate data for analytics and trends

**Exceptions**:
- None

**Error Messages**:
- None (decline reason is required by BR-OFFER-025)

**Examples**:
```yaml
Example: Multi-Reason Decline Analysis
  Input:
    offer_id: OFFER-2025-00123
    candidate: Jane Smith
    decline_reasons:
      - category: COMPENSATION
        weight: PRIMARY
        details: "Base salary 20% lower than competing offer"
      - category: LOCATION
        weight: SECONDARY
        details: "Prefer fully remote, this role is hybrid"
    competing_offer:
      company: "Google"
      base_salary: 150M VND (vs our 125M VND)
      remote: FULL_REMOTE
  
  Analytics Aggregation:
    Q4 2025 Decline Reasons:
      - Compensation: 45% (most common)
      - Location: 25%
      - Competing offer: 20%
      - Role: 10%
  
  Insights:
    - Need to review compensation benchmarks
    - Consider more flexible remote policy
  
  Validation:
    BR-TR-OFFER-026: PASS
```

**Related Requirements**:
- FR-TR-OFFER-005

**Related Entities**:
- DeclineReason
- OfferAnalytics

---

### BR-TR-OFFER-027: Counter-Offer Management

**Priority**: MEDIUM

**Description**: Manage counter-offer negotiations with candidates.

**Conditions**: `IF candidate requests changes THEN initiate counter-offer process`

**Rules**: 1. Candidate can request changes before accepting/declining 2. Changes tracked as counter-offer 3. Hiring manager reviews counter-offer 4. Approval required for changes 5. Max 2 counter-offer rounds 6. New offer version generated if approved

**Exceptions**: None

**Error Messages**: `ERR_OFFER_027`: "Maximum counter-offers (2) reached."

**Related Requirements**: FR-TR-OFFER-005 | **Related Entities**: OfferPackage, CounterOffer

---

### BR-TR-OFFER-028: Onboarding Integration

**Priority**: HIGH

**Description**: Integrate accepted offers with onboarding system.

**Conditions**: `IF offer accepted THEN trigger onboarding workflow`

**Rules**: 1. Create employee record in Core module 2. Generate employee ID 3. Trigger onboarding checklist 4. Send welcome email 5. Assign onboarding buddy 6. Schedule first day activities 7. Provision IT access

**Exceptions**: None

**Error Messages**: `ERR_OFFER_028`: "Onboarding integration failed: {reason}."

**Related Requirements**: FR-TR-OFFER-005 | **Related Entities**: OfferAcceptance, Core.Employee

---

### BR-TR-OFFER-029: Offer Analytics Reporting

**Priority**: MEDIUM

**Description**: Generate analytics reports on offer activity.

**Conditions**: `IF reporting period ends THEN generate offer analytics`

**Rules**: 1. Metrics: Total offers, Acceptance rate, Decline rate, Time-to-offer, Time-to-accept, Counter-offer rate 2. Breakdown by: Department, Level, Location, Source 3. Trend analysis 4. Benchmarking 5. Monthly/quarterly reports

**Exceptions**: None

**Error Messages**: None

**Related Requirements**: FR-TR-OFFER-012 | **Related Entities**: OfferPackage, OfferAnalytics

---

### BR-TR-OFFER-030: Time-to-Offer Metrics

**Priority**: LOW

**Description**: Track time from candidate selection to offer extended.

**Conditions**: `IF offer extended THEN calculate time-to-offer`

**Rules**: 1. Start: Candidate selected 2. End: Offer sent 3. Track approval time 4. Track preparation time 5. Identify bottlenecks 6. Target: <5 business days

**Exceptions**: None

**Error Messages**: None

**Related Requirements**: FR-TR-OFFER-012 | **Related Entities**: OfferPackage, OfferMetrics

---

### BR-TR-OFFER-031: Acceptance Rate Tracking

**Priority**: MEDIUM

**Description**: Track offer acceptance rates for analysis.

**Conditions**: `IF offer finalized THEN update acceptance rate metrics`

**Rules**: 1. Calculate: Accepted / (Accepted + Declined) 2. Track by: Department, Level, Source, Recruiter 3. Identify trends 4. Target: >80% acceptance rate 5. Alert if below threshold

**Exceptions**: Withdrawn offers: excluded from rate

**Error Messages**: None

**Related Requirements**: FR-TR-OFFER-012 | **Related Entities**: OfferAnalytics, AcceptanceRate

---

### BR-TR-OFFER-032: Offer Comparison Reporting

**Priority**: LOW

**Description**: Compare offers across candidates, positions, and time periods.

**Conditions**: `IF comparison requested THEN generate comparison report`

**Rules**: 1. Compare: Base salary, Total comp, Benefits, Sign-on bonus 2. Normalize by: Level, Location, Department 3. Identify outliers 4. Ensure pay equity 5. Competitive positioning

**Exceptions**: None

**Error Messages**: None

**Related Requirements**: FR-TR-OFFER-012 | **Related Entities**: OfferPackage, ComparisonReport

---

### BR-TR-OFFER-033: Competitive Analysis

**Priority**: MEDIUM

**Description**: Analyze competitive offers and market positioning.

**Conditions**: `IF competitive data available THEN analyze market position`

**Rules**: 1. Track competing offers (from declines) 2. Compare to market data 3. Identify gaps 4. Adjust offer strategy 5. Quarterly competitive review

**Exceptions**: None

**Error Messages**: None

**Related Requirements**: FR-TR-OFFER-012 | **Related Entities**: DeclineReason, CompetitiveAnalysis

---

### BR-TR-OFFER-034: Offer Audit Trail

**Priority**: HIGH

**Description**: Maintain comprehensive audit trail for all offer activities.

**Conditions**: `IF offer activity occurs THEN log to audit trail`

**Rules**: 1. Log: Creation, Approvals, Revisions, Delivery, Acceptance/Decline, Withdrawal 2. Audit record: User, Timestamp, Action, Before/After values, IP address 3. Immutable records 4. Retention: 7 years 5. Searchable and reportable

**Exceptions**: None

**Error Messages**: `ERR_OFFER_034`: "Audit log write failed: {reason}."

**Related Requirements**: FR-TR-OFFER-012 | **Related Entities**: AuditLog, OfferPackage

---

## Summary: Offer Management Rules

**Total Rules**: 34  
**Priority Breakdown**:
- HIGH: 22 rules (65%)
- MEDIUM: 12 rules (35%)
- LOW: 0 rules

**Categories**:
1. Offer Package Creation (12 rules) - FULL DETAIL ✓
2. Offer Approval & E-signature (11 rules) - SUMMARY FORMAT
3. Offer Acceptance & Reporting (11 rules) - SUMMARY FORMAT

**Key Highlights**:
- Comprehensive offer package configuration
- Multi-component compensation (base, variable, equity, benefits)
- Total compensation calculation
- Multi-level approval workflows
- E-signature integration
- Onboarding workflow trigger
- Analytics and reporting

**Note**: Batch 1 (12 rules) completed with full detail. Batches 2-3 (22 rules) completed with summary format for efficiency while maintaining comprehensive coverage.

---

**Status**: ✅ Offer Management Rules Complete (34/34)

**Progress**: 232/~300 rules (77%)

**Completed Sub-Modules**: 5/11
1. Core Compensation (51 rules) ✓
2. Variable Pay (50 rules) ✓
3. Benefits (66 rules) ✓
4. Recognition (31 rules) ✓
5. Offer Management (34 rules) ✓

**Next Sub-Module**: TR Statement (22 rules)


---

