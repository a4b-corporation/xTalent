$schema: "https://xtalent.io/schemas/action/v3"
$id: "xtalent:core:org-structure:create-business-unit"

action: CreateBusinessUnit
module: CO
submodule: org-structure
version: "1.0"

inputs:
  code: {type: string, required: true}
  name: {type: string, required: true}
  type_id: {type: uuid, required: true}
  parent_id: {type: uuid, required: false}
  path: {type: string, required: true}
  legal_entity_code: {type: string, required: false}
  manager_employee_id: {type: uuid, required: false}
  effective_start_date: {type: date, required: true}

outputs:
  business_unit_id: {type: uuid}

preconditions:
  - condition: "code unique"
    check: "NOT EXISTS(SELECT 1 FROM business_unit WHERE code = :code AND is_current_flag = true)"
  - condition: "manager is active employee"
    check: "manager_employee_id IS NULL OR EXISTS(SELECT 1 FROM employee WHERE id = :manager_employee_id AND status_code = 'ACTIVE')"

effects:
  database:
    - operation: INSERT
      table: org_bu.unit
      returns: [id]
  events:
    - event: BusinessUnitCreated

authorization:
  required_roles: [HR_ADMIN, ORG_ADMIN]

api:
  rest:
    method: POST
    path: "/api/v1/business-units"
    status_code: 201

metadata:
  created_at: "2025-12-25"
