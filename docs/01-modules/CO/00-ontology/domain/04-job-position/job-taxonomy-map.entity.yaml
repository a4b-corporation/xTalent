$schema: "https://xtalent.io/schemas/entity/v3"
$id: "xtalent:core:job-position:job-taxonomy-map"

entity: JobTaxonomyMap
classification: ENTITY
module: CO
submodule: job-position
version: "1.0"

definition: |
  Mapping between jobs and taxonomy nodes for multi-dimensional job classification.

description: |
  JobTaxonomyMap links jobs to taxonomy nodes enabling:
  - Multi-dimensional classification (family, group, track)
  - Multiple taxonomy assignments per job
  - Temporal tracking of taxonomy changes
  - Cross-tree taxonomy alignment
  
  A job can belong to multiple taxonomy nodes:
  - Job Family: "Engineering"
  - Job Group: "Software Development"
  - Career Track: "Technical Track"
  - Skill Cluster: "Backend Development"
  
  Used for:
  - Job classification and categorization
  - Talent marketplace matching
  - Career path definition
  - Reporting and analytics
  - Compensation benchmarking

purpose: |
  - Link jobs to taxonomy classifications
  - Enable multi-dimensional job analysis
  - Support talent marketplace
  - Facilitate reporting

parent_aggregate: Job

mixins:
  - HasEffectiveDates

attributes:
  job_id:
    type: uuid
    required: true
    primary_key: true
    foreign_key: job.id
    description: "Job ID"
    
  taxonomy_id:
    type: uuid
    required: true
    primary_key: true
    foreign_key: job_taxonomy.id
    description: "Taxonomy node ID"
    
  effective_start_date:
    type: date
    required: true
    primary_key: true
    description: "Effective start date"

relationships:
  job:
    target: Job
    cardinality: N:1
    required: true
    on_delete: CASCADE
    
  taxonomy:
    target: JobTaxonomy
    cardinality: N:1
    required: true
    on_delete: RESTRICT

validation_rules:
  - rule: "unique_job_taxonomy_mapping"
    expression: "UNIQUE(job_id, taxonomy_id, effective_start_date)"
    severity: ERROR

indexes:
  - name: idx_job_taxonomy_map_pk
    columns: [job_id, taxonomy_id, effective_start_date]
    unique: true
  - name: idx_taxonomy_lookup
    columns: [taxonomy_id]
    note: "For taxonomy-based job search"

examples:
  - name: "Job Family Mapping"
    data:
      job_id: "job-software-eng"
      taxonomy_id: "taxonomy-eng-family"
      effective_start_date: "2020-01-01"
      is_current_flag: true
      
  - name: "Career Track Mapping"
    data:
      job_id: "job-software-eng"
      taxonomy_id: "taxonomy-tech-track"
      effective_start_date: "2020-01-01"
      is_current_flag: true

references:
  database_design: "../../../03-design/1.core.v4.dbml#jobpos.job_taxonomy_map"

metadata:
  created_at: "2025-12-25"
  dbml_source: "jobpos.job_taxonomy_map (lines 1007-1015)"
  notes: |
    - Enables multi-dimensional job classification
    - One job can have multiple taxonomy assignments
    - SCD2 for temporal tracking
