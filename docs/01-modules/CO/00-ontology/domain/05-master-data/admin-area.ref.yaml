---
$schema: "https://xtalent.io/schemas/entity/v3"
$id: "xtalent:co:master-data:admin-area"

module: CO
submodule: master-data
version: "1.0.0"

entity: AdminArea
classification: REFERENCE_DATA

definition: |
  Hierarchical administrative areas (Province/State, District, Ward) for
  geographic organization and address management.

purpose: |
  Provide standardized geographic hierarchy for addresses, tax jurisdictions,
  and location-based reporting. Supports closure table pattern for efficient
  hierarchy queries.

attributes:
  id:
    type: uuid
    required: true
    primary_key: true
    
  country_code:
    type: string
    required: true
    length: 2
    foreign_key: common.country.code_alpha2
    
  code:
    type: string
    required: true
    max_length: 50
    description: "Area code (unique within country)"
    
  name:
    type: string
    required: true
    max_length: 255
    
  name_local:
    type: string
    required: false
    max_length: 255
    
  level:
    type: string
    required: true
    max_length: 20
    description: "Administrative level"
    allowed_values: [COUNTRY, PROVINCE, DISTRICT, WARD]
    
  parent_id:
    type: uuid
    required: false
    foreign_key: geo.admin_area.id
    description: "Parent area in hierarchy"
    
  metadata:
    type: jsonb
    required: false
    description: "Extended attributes (postal_code_pattern, tax_code, etc.)"
    
  effective_start_date:
    type: date
    required: true
    
  effective_end_date:
    type: date
    required: false
    
  is_current_flag:
    type: boolean
    required: true
    default: true

mixins:
  - EffectiveDated

relationships:
  country:
    target: Country
    target_ref: "xtalent:co:master-data:country"
    cardinality: N:1
    required: true
    
  parent:
    target: AdminArea
    target_ref: "xtalent:co:master-data:admin-area"
    cardinality: N:1
    required: false
    description: "Parent administrative area"

derived_attributes:
  full_path:
    type: string
    formula: "Recursive query to build full path from root to this area"
    description: "Full hierarchical path (e.g., 'Vietnam > Ho Chi Minh City > District 1 > Ward 1')"

indexes:
  - name: idx_admin_area_country_code
    columns: [country_code, code]
    unique: true
  - name: idx_admin_area_parent
    columns: [parent_id]
  - name: idx_admin_area_level
    columns: [level, country_code]

security:
  data_classification: PUBLIC
  access_control:
    read: [ALL_USERS]
    write: [SYSTEM_ADMIN]

metadata:
  tags: [master-data, geographic, hierarchy, address]
  owner: "Platform Team"
  last_updated: "2025-12-25"
  status: complete
  note: "Supports closure table pattern for efficient hierarchy queries"
